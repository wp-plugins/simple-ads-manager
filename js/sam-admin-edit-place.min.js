var sam=sam||{};(function(n){var t,i=samEditorOptions.media;sam.media=t={buttonId:"#banner-media",adUrl:"#patch_img",adImgId:"#patch_img_id",adName:"#title",adDesc:"#description",init:function(){n(this.buttonId).on("click",this.openMediaDialog)},openMediaDialog:function(n){if(n.preventDefault(),this._frame){this._frame.open();return}var r=wp.media.model.Attachment;this._frame=t.frame=wp.media({title:i.title,button:{text:i.button},multiple:!1,library:{type:"image"}});this._frame.on("ready",function(){});this._frame.state("library").on("select",function(){var n=this.get("selection").single();t.handleMediaAttachment(n)});this._frame.open()},handleMediaAttachment:function(t){var i=t.toJSON();n(this.adUrl).val(i.url);n(this.adImgId).val(i.id);""==n(this.adName).val()&&""!=i.title&&n(this.adName).val(i.title);""==n(this.adDesc).val()&&""!=i.caption&&n(this.adDesc).val(i.caption);""==n(this.adAlt).val()&&""!=i.alt&&n(this.adAlt).val(i.alt)}};n(document).ready(function(){var v=n("#editor_mode").val(),w,r=n("#rc-psi"),u=n("#rc-psc"),f=n("#rc-psd"),y=n("#title"),h=n("#place_id").val(),b=n("#upload-file-button"),c=n("#uploading"),k=n("#uploading-help"),p=n("#load_img"),e,o,l=0,d=n("#ads-grid"),a=samEditorOptions.samStatsUrl,s=samEditorOptions.labels,i;return e=samEditorOptions.places,e.pointer="places",t.init(),y.tooltip({track:!0}),i=samEditorOptions.options,w=new AjaxUpload(b,{action:ajaxurl,name:"uploadfile",data:{action:"upload_ad_image"},onSubmit:function(n,t){if(!(t&&/^(jpg|png|jpeg|gif|swf)$/.test(t)))return c.text(i.status),!1;p.show();c.text(i.uploading)},onComplete:function(t,r){c.text("");p.hide();n('<div id="files"><\/div>').appendTo(k);r=="success"?(n("#files").text(i.file+" "+t+" "+i.uploaded).addClass("updated").delay(3e3).fadeOut(1e3,function(){n(this).remove()}),v=="item"?n("#ad_img").val(i.url+t):v=="place"&&n("#patch_img").val(i.url+t)):n("#files").text(t+" "+r).addClass("error").delay(3e3).fadeOut(1e3,function(){n(this).remove()})}}),n.post(a,{action:"load_stats",id:h,sm:l}).done(function(t){var i={label:s.hits,data:t.hits},r={label:s.clicks,data:t.clicks};o=[i,r];n("#total_hits").text(t.total.hits);n("#total_clicks").text(t.total.clicks);n.plot("#graph",o,{series:{lines:{show:!0},points:{show:!0}},xaxis:{mode:"categories",tickLength:0},legend:{backgroundColor:"rgb(235, 233, 233)"},grid:{backgroundColor:{colors:["#FFFFFF","#DDDDDD"]},borderWidth:1,borderColor:"#DFDFDF"}})}),n("#tabs").tabs({activate:function(t,i){var r=i.newPanel[0].id;r=="tabs-3"&&n.plot("#graph",o,{series:{lines:{show:!0},points:{show:!0}},xaxis:{mode:"categories",tickLength:0},legend:{backgroundColor:"rgb(235, 233, 233)"},grid:{backgroundColor:{colors:["#FFFFFF","#DDDDDD"]},borderWidth:1,borderColor:"#DFDFDF"}})}}),n("#image_tools").tabs(),n.post(a,{action:"load_ads",id:h,sm:0}).done(function(n){var t=n.records;d.w2grid({name:"ads",show:{selectColumn:!1},multiSelect:!1,columns:samEditorOptions.columns,records:t})}),n("#add-file-button").click(function(){var t=i.url+n("select#files_list option:selected").val();return n("#patch_img").val(t),!1}),n("#patch_source_image").click(function(){r.is(":hidden")&&r.show("blind",{direction:"vertical"},500);u.is(":visible")&&u.hide("blind",{direction:"vertical"},500);f.is(":visible")&&f.hide("blind",{direction:"vertical"},500)}),n("#patch_source_code").click(function(){r.is(":visible")&&r.hide("blind",{direction:"vertical"},500);u.is(":hidden")&&u.show("blind",{direction:"vertical"},500);f.is(":visible")&&f.hide("blind",{direction:"vertical"},500)}),n("#patch_source_dfp").click(function(){r.is(":visible")&&r.hide("blind",{direction:"vertical"},500);u.is(":visible")&&u.hide("blind",{direction:"vertical"},500);f.is(":hidden")&&f.show("blind",{direction:"vertical"},500)}),(e.enabled||""==y.val())&&n("#title").pointer({content:"<h3>"+e.title+"<\/h3><p>"+e.content+"<\/p>",position:"top",close:function(){n.ajax({url:ajaxurl,data:{action:"close_pointer",pointer:e.pointer},async:!0})}}).pointer("open"),n("#stats_month").change(function(){l=n(this).val();n.post(a,{action:"load_stats",id:h,sm:l}).done(function(t){var i={label:s.hits,data:t.hits},r={label:s.clicks,data:t.clicks};o=[i,r];n("#total_hits").text(t.total.hits);n("#total_clicks").text(t.total.clicks);n.plot("#graph",o,{series:{lines:{show:!0},points:{show:!0}},xaxis:{mode:"categories",tickLength:0},legend:{backgroundColor:"rgb(235, 233, 233)"},grid:{backgroundColor:{colors:["#FFFFFF","#DDDDDD"]},borderWidth:1,borderColor:"#DFDFDF"}})})}),!1})})(jQuery)