var w2ui=w2ui||{},w2obj=w2obj||{},w2utils=function(n){function nt(n){var t=/^[-]?[0-9]+$/;return t.test(n)}function tt(n){var t=new RegExp(w2utils.settings.float);return t.test(n)}function d(n){var t=new RegExp(w2utils.settings.currency);return t.test(n)}function w(n){var t=/^[a-fA-F0-9]+$/;return t.test(n)}function b(n){var t=/^[a-zA-Z0-9_-]+$/;return t.test(n)}function k(n){var t=/^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return t.test(n)}function et(n,t,i){if(!n)return!1;t||(t=w2utils.settings.date_format);var r=n.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/"),o=t.replace(/-/g,"/").replace(/\./g,"/").toLowerCase(),s="Invalid Date",u,f,e;return(o=="mm/dd/yyyy"&&(u=r[0],f=r[1],e=r[2]),o=="m/d/yyyy"&&(u=r[0],f=r[1],e=r[2]),o=="dd/mm/yyyy"&&(u=r[1],f=r[0],e=r[2]),o=="d/m/yyyy"&&(u=r[1],f=r[0],e=r[2]),o=="yyyy/dd/mm"&&(u=r[2],f=r[1],e=r[0]),o=="yyyy/d/m"&&(u=r[2],f=r[1],e=r[0]),o=="yyyy/mm/dd"&&(u=r[1],f=r[2],e=r[0]),o=="yyyy/m/d"&&(u=r[1],f=r[2],e=r[0]),s=new Date(u+"/"+f+"/"+e),typeof u=="undefined")?!1:s=="Invalid Date"?!1:s.getMonth()+1!=u||s.getDate()!=f||s.getFullYear()!=e?!1:i===!0?s:!0}function ot(t){var r,i;return String(t)=="undefined"?!1:(t=t.toUpperCase(),r=t.indexOf("PM")>=0||t.indexOf("AM")>=0?12:23,t=n.trim(t.replace("AM","")),t=n.trim(t.replace("PM","")),i=t.split(":"),i.length!=2)?!1:i[0]==""||parseInt(i[0])<0||parseInt(i[0])>r||!this.isInt(i[0])?!1:i[1]==""||parseInt(i[1])<0||parseInt(i[1])>59||!this.isInt(i[1])?!1:!0}function st(n){var f,i;if(n==""||typeof n=="undefined"||n==null||(w2utils.isInt(n)&&(n=Number(n)),f=new Date(n),w2utils.isInt(n)&&(f=new Date(Number(n))),i=String(n).split("-"),i.length==3&&(f=new Date(i[0],Number(i[1])-1,i[2])),i=String(n).split("/"),i.length==3&&(f=new Date(i[2],Number(i[0])-1,i[1])),f=="Invalid Time"))return"";var e=new Date,t=(e.getTime()-f.getTime())/1e3,r="",u="";return t<60?(r=Math.floor(t),u="sec",t<0&&(r=0,u="sec")):t<3600?(r=Math.floor(t/60),u="min"):t<86400?(r=Math.floor(t/3600),u="hour"):t<2592e3?(r=Math.floor(t/86400),u="day"):t<31104e3?(r=Math.floor(t/259200)/10,u="month"):t>=31104e3&&(r=Math.floor(t/3110400)/10,u="year"),r+" "+u+(r>1?"s":"")}function ft(n){var o=w2utils.settings.shortmonths,t,i,f,r;if(n==""||typeof n=="undefined"||n==null||(w2utils.isInt(n)&&(n=Number(n)),t=new Date(n),w2utils.isInt(n)&&(t=new Date(Number(n))),i=String(n).split("-"),i.length==3&&(t=new Date(i[0],Number(i[1])-1,i[2])),i=String(n).split("/"),i.length==3&&(t=new Date(i[2],Number(i[0])-1,i[1])),t=="Invalid Date"))return"";f=new Date,r=new Date,r.setTime(r.getTime()-864e5);var u=o[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear(),h=o[f.getMonth()]+" "+f.getDate()+", "+f.getFullYear(),c=o[r.getMonth()]+" "+r.getDate()+", "+r.getFullYear(),l=t.getHours()-(t.getHours()>12?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+" "+(t.getHours()>=12?"pm":"am"),s=t.getHours()-(t.getHours()>12?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+" "+(t.getHours()>=12?"pm":"am"),e=u;return u==h&&(e=l),u==c&&(e=w2utils.lang("Yesterday")),'<span title="'+u+" "+s+'">'+e+"</span>"}function it(n){if(!w2utils.isFloat(n)||n=="")return"";if(n=parseFloat(n),n==0)return 0;var i=["Bt","KB","MB","GB","TB"],t=parseInt(Math.floor(Math.log(n)/Math.log(1024)));return(Math.floor(n/Math.pow(1024,t)*10)/10).toFixed(t==0?0:1)+" "+i[t]}function rt(n){var t="";return(w2utils.isFloat(n)||w2utils.isInt(n)||w2utils.isMoney(n))&&(t=String(n).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")),t}function ut(n,t){var s=w2utils.settings.shortmonths,o=w2utils.settings.fullmonths,r,i;if((typeof t=="undefined"&&(t=this.settings.date_format),typeof n=="undefined"||n==""||n==null)||(r=new Date(n),w2utils.isInt(n)&&(r=new Date(Number(n))),i=String(n).split("-"),i.length==3&&(r=new Date(i[0],Number(i[1])-1,i[2])),i=String(n).split("/"),i.length==3&&(r=new Date(i[2],Number(i[0])-1,i[1])),r=="Invalid Date"))return"";var f=r.getFullYear(),u=r.getMonth(),e=r.getDate();return t.toLowerCase().replace("month",w2utils.settings.fullmonths[u]).replace("mon",w2utils.settings.shortmonths[u]).replace(/yyyy/g,f).replace(/yyy/g,f).replace(/yy/g,String(f).substr(2)).replace(/(^|[^a-z$])y/g,"$1"+f).replace(/mm/g,(u+1<10?"0":"")+(u+1)).replace(/dd/g,(e<10?"0":"")+e).replace(/(^|[^a-z$])m/g,"$1"+(u+1)).replace(/(^|[^a-z$])d/g,"$1"+e)}function e(n,t){var h=w2utils.settings.shortmonths,s=w2utils.settings.fullmonths,i;if((typeof t=="undefined"&&(t=this.settings.time_format),typeof n=="undefined"||n==""||n==null)||(i=new Date(n),w2utils.isInt(n)&&(i=new Date(Number(n))),i=="Invalid Date"))return"";var e="am",u=i.getHours(),o=i.getHours(),r=i.getMinutes(),f=i.getSeconds();return r<10&&(r="0"+r),f<10&&(f="0"+f),(t.indexOf("am")!=-1||t.indexOf("pm")!=-1)&&(u>=12&&(e="pm"),u>12&&(u=u-12)),t.toLowerCase().replace("am",e).replace("pm",e).replace("hh",u).replace("h24",o).replace("mm",r).replace("mi",r).replace("ss",f).replace(/(^|[^a-z$])h/g,"$1"+u).replace(/(^|[^a-z$])m/g,"$1"+r).replace(/(^|[^a-z$])s/g,"$1"+f)}function o(n,t){var i;return i=typeof t!="string"?[this.settings.date_format,this.settings.time_format]:t.split("|"),this.formatDate(n,i[0])+" "+this.formatTime(n,i[1])}function s(t){if(t==null)return t;switch(typeof t){case"string":t=n.trim(String(t).replace(/(<([^>]+)>)/ig,""));break;case"object":for(var i in t)t[i]=this.stripTags(t[i])}return t}function f(n){if(n==null)return n;switch(typeof n){case"string":n=String(n).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case"object":for(var t in n)n[t]=this.encodeTags(n[t])}return n}function i(n){return typeof n=="undefined"||n==""||n==null?"":String(n).replace(/([;&,\.\+\*\~'`:"\!\^#$%@\[\]\(\)=<>\|\/? {}\\])/g,"\\$1")}function r(n){function l(n){for(var n=String(n).replace(/\r\n/g,"\n"),i="",t,r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i}var e="",s,f,u,h,c,o,r,i=0,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(n=l(n);i<n.length;)s=n.charCodeAt(i++),f=n.charCodeAt(i++),u=n.charCodeAt(i++),h=s>>2,c=(s&3)<<4|f>>4,o=(f&15)<<2|u>>6,r=u&63,isNaN(f)?o=r=64:isNaN(u)&&(r=64),e=e+t.charAt(h)+t.charAt(c)+t.charAt(o)+t.charAt(r);return e}function u(n){function l(n){for(var u="",t=0,i=0,f=0,r=0;t<n.length;)i=n.charCodeAt(t),i<128?(u+=String.fromCharCode(i),t++):i>191&&i<224?(r=n.charCodeAt(t+1),u+=String.fromCharCode((i&31)<<6|r&63),t+=2):(r=n.charCodeAt(t+1),c3=n.charCodeAt(t+2),u+=String.fromCharCode((i&15)<<12|(r&63)<<6|c3&63),t+=3);return u}var t="",s,o,c,h,f,r,e,i=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<n.length;)h=u.indexOf(n.charAt(i++)),f=u.indexOf(n.charAt(i++)),r=u.indexOf(n.charAt(i++)),e=u.indexOf(n.charAt(i++)),s=h<<2|f>>4,o=(f&15)<<4|r>>2,c=(r&3)<<6|e,t=t+String.fromCharCode(s),r!=64&&(t=t+String.fromCharCode(o)),e!=64&&(t=t+String.fromCharCode(c));return t=l(t)}function v(t,i,r,u){function f(n,t,i){var r=!!window.webkitURL;return r||typeof i=="undefined"||(t=i),";"+n+": "+t+"; -webkit-"+n+": "+t+"; -moz-"+n+": "+t+"; -ms-"+n+": "+t+"; -o-"+n+": "+t+";"}var o=n(t).width(),s=n(t).height(),e=.5;if(!t||!i){console.log("ERROR: Cannot do transition when one of the divs is null");return}t.parentNode.style.cssText+=f("perspective","700px")+"; overflow: hidden;",t.style.cssText+="; position: absolute; z-index: 1019; "+f("backface-visibility","hidden"),i.style.cssText+="; position: absolute; z-index: 1020; "+f("backface-visibility","hidden");switch(r){case"slide-left":t.style.cssText+="overflow: hidden; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)"),i.style.cssText+="overflow: hidden; "+f("transform","translate3d("+o+"px, 0, 0)","translate("+o+"px, 0)"),n(i).show(),window.setTimeout(function(){i.style.cssText+=f("transition",e+"s")+";"+f("transform","translate3d(0, 0, 0)","translate(0, 0)"),t.style.cssText+=f("transition",e+"s")+";"+f("transform","translate3d(-"+o+"px, 0, 0)","translate(-"+o+"px, 0)")},1);break;case"slide-right":t.style.cssText+="overflow: hidden; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)"),i.style.cssText+="overflow: hidden; "+f("transform","translate3d(-"+o+"px, 0, 0)","translate(-"+o+"px, 0)"),n(i).show(),window.setTimeout(function(){i.style.cssText+=f("transition",e+"s")+"; "+f("transform","translate3d(0px, 0, 0)","translate(0px, 0)"),t.style.cssText+=f("transition",e+"s")+"; "+f("transform","translate3d("+o+"px, 0, 0)","translate("+o+"px, 0)")},1);break;case"slide-down":t.style.cssText+="overflow: hidden; z-index: 1; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)"),i.style.cssText+="overflow: hidden; z-index: 0; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)"),n(i).show(),window.setTimeout(function(){i.style.cssText+=f("transition",e+"s")+"; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)"),t.style.cssText+=f("transition",e+"s")+"; "+f("transform","translate3d(0, "+s+"px, 0)","translate(0, "+s+"px)")},1);break;case"slide-up":t.style.cssText+="overflow: hidden; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)"),i.style.cssText+="overflow: hidden; "+f("transform","translate3d(0, "+s+"px, 0)","translate(0, "+s+"px)"),n(i).show(),window.setTimeout(function(){i.style.cssText+=f("transition",e+"s")+"; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)"),t.style.cssText+=f("transition",e+"s")+"; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)")},1);break;case"flip-left":t.style.cssText+="overflow: hidden; "+f("-transform","rotateY(0deg)"),i.style.cssText+="overflow: hidden; "+f("transform","rotateY(-180deg)"),n(i).show(),window.setTimeout(function(){i.style.cssText+=f("transition",e+"s")+"; "+f("transform","rotateY(0deg)"),t.style.cssText+=f("transition",e+"s")+"; "+f("transform","rotateY(180deg)")},1);break;case"flip-right":t.style.cssText+="overflow: hidden; "+f("transform","rotateY(0deg)"),i.style.cssText+="overflow: hidden; "+f("transform","rotateY(180deg)"),n(i).show(),window.setTimeout(function(){i.style.cssText+=f("transition",e+"s")+"; "+f("transform","rotateY(0deg)"),t.style.cssText+=f("transition",e+"s")+"; "+f("transform","rotateY(-180deg)")},1);break;case"flip-down":t.style.cssText+="overflow: hidden; "+f("transform","rotateX(0deg)"),i.style.cssText+="overflow: hidden; "+f("transform","rotateX(180deg)"),n(i).show(),window.setTimeout(function(){i.style.cssText+=f("transition",e+"s")+"; "+f("transform","rotateX(0deg)"),t.style.cssText+=f("transition",e+"s")+"; "+f("transform","rotateX(-180deg)")},1);break;case"flip-up":t.style.cssText+="overflow: hidden; "+f("transform","rotateX(0deg)"),i.style.cssText+="overflow: hidden; "+f("transform","rotateX(-180deg)"),n(i).show(),window.setTimeout(function(){i.style.cssText+=f("transition",e+"s")+"; "+f("transform","rotateX(0deg)"),t.style.cssText+=f("transition",e+"s")+"; "+f("transform","rotateX(180deg)")},1);break;case"pop-in":t.style.cssText+="overflow: hidden; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)"),i.style.cssText+="overflow: hidden; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; "+f("transform","scale(.8)")+"; opacity: 0;",n(i).show(),window.setTimeout(function(){i.style.cssText+=f("transition",e+"s")+"; "+f("transform","scale(1)")+"; opacity: 1;",t.style.cssText+=f("transition",e+"s")+";"},1);break;case"pop-out":t.style.cssText+="overflow: hidden; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; "+f("transform","scale(1)")+"; opacity: 1;",i.style.cssText+="overflow: hidden; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; opacity: 0;",n(i).show(),window.setTimeout(function(){i.style.cssText+=f("transition",e+"s")+"; opacity: 1;",t.style.cssText+=f("transition",e+"s")+"; "+f("transform","scale(1.7)")+"; opacity: 0;"},1);break;default:t.style.cssText+="overflow: hidden; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)"),i.style.cssText+="overflow: hidden; "+f("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; opacity: 0;",n(i).show(),window.setTimeout(function(){i.style.cssText+=f("transition",e+"s")+"; opacity: 1;",t.style.cssText+=f("transition",e+"s")},1)}setTimeout(function(){r=="slide-down"&&(n(t).css("z-index","1019"),n(i).css("z-index","1020")),i&&n(i).css({opacity:"1","-webkit-transition":"","-moz-transition":"","-ms-transition":"","-o-transition":"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"","-webkit-backface-visibility":"","-moz-backface-visibility":"","-ms-backface-visibility":"","-o-backface-visibility":""}),t&&(n(t).css({opacity:"1","-webkit-transition":"","-moz-transition":"","-ms-transition":"","-o-transition":"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"","-webkit-backface-visibility":"","-moz-backface-visibility":"","-ms-backface-visibility":"","-o-backface-visibility":""}),t.parentNode&&n(t.parentNode).css({"-webkit-perspective":"","-moz-perspective":"","-ms-perspective":"","-o-perspective":""})),typeof u=="function"&&u()},e*1e3)}function y(t,i,r){i||i==0||(i=""),w2utils.unlock(t),n(t).find(">:first-child").before('<div class="w2ui-lock"></div><div class="w2ui-lock-msg"></div>'),setTimeout(function(){var f=n(t).find(".w2ui-lock"),u=n(t).find(".w2ui-lock-msg");f.data("old_opacity",f.css("opacity")).css("opacity","0").show(),u.data("old_opacity",u.css("opacity")).css("opacity","0").show(),setTimeout(function(){var f=n(t).find(".w2ui-lock"),u=n(t).find(".w2ui-lock-msg"),o=(n(t).width()-w2utils.getSize(u,"width"))/2,e=(n(t).height()*.9-w2utils.getSize(u,"height"))/2;f.css({opacity:f.data("old_opacity"),left:"0px",top:"0px",width:"100%",height:"100%"}),i||u.css({"background-color":"transparent",border:"0px"}),r===!0&&(i='<div class="w2ui-spinner" '+(i?"":'style="width: 30px; height: 30px"')+"></div>"+i),u.html(i).css({opacity:u.data("old_opacity"),left:o+"px",top:e+"px"})},10)},10),n().w2tag()}function p(t){n(t).find(".w2ui-lock").remove(),n(t).find(".w2ui-lock-msg").remove()}function a(t,i){var f={left:parseInt(n(t).css("border-left-width"))||0,right:parseInt(n(t).css("border-right-width"))||0,top:parseInt(n(t).css("border-top-width"))||0,bottom:parseInt(n(t).css("border-bottom-width"))||0},u={left:parseInt(n(t).css("margin-left"))||0,right:parseInt(n(t).css("margin-right"))||0,top:parseInt(n(t).css("margin-top"))||0,bottom:parseInt(n(t).css("margin-bottom"))||0},r={left:parseInt(n(t).css("padding-left"))||0,right:parseInt(n(t).css("padding-right"))||0,top:parseInt(n(t).css("padding-top"))||0,bottom:parseInt(n(t).css("padding-bottom"))||0};switch(i){case"top":return f.top+u.top+r.top;case"bottom":return f.bottom+u.bottom+r.bottom;case"left":return f.left+u.left+r.left;case"right":return f.right+u.right+r.right;case"width":return f.left+f.right+u.left+u.right+r.left+r.right+parseInt(n(t).width());case"height":return f.top+f.bottom+u.top+u.bottom+r.top+r.bottom+parseInt(n(t).height());case"+width":return f.left+f.right+u.left+u.right+r.left+r.right;case"+height":return f.top+f.bottom+u.top+u.bottom+r.top+r.bottom}return 0}function h(n){var t=this.settings.phrases[n];return typeof t=="undefined"?n:t}function c(t){t||(t="en-us"),t.length==5&&(t="locale/"+t+".json"),n.ajax({url:t,type:"GET",dataType:"JSON",async:!1,cache:!1,success:function(t){w2utils.settings=n.extend(!0,w2utils.settings,t)},error:function(){console.log("ERROR: Cannot load locale "+t)}})}function l(){if(t.scrollBarSize)return t.scrollBarSize;var i='<div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">\t<div style="height: 120px">1</div></div>';return n("body").append(i),t.scrollBarSize=100-n("#_scrollbar_width > div").width(),n("#_scrollbar_width").remove(),String(navigator.userAgent).indexOf("MSIE")>=0&&(t.scrollBarSize=t.scrollBarSize/2),t.scrollBarSize}var t={};return{settings:{locale:"en-us",date_format:"m/d/yyyy",date_display:"Mon d, yyyy",time_format:"hh:mi pm",currency:"^[$€£¥]?[-]?[0-9]*[.]?[0-9]+$",currencySymbol:"$",float:"^[-]?[0-9]*[.]?[0-9]+$",shortmonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullmonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortdays:["M","T","W","T","F","S","S"],fulldays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],RESTfull:!1,phrases:{}},isInt:nt,isFloat:tt,isMoney:d,isHex:w,isAlphaNumeric:b,isEmail:k,isDate:et,isTime:ot,age:st,date:ft,size:it,formatNumber:rt,formatDate:ut,formatTime:e,formatDateTime:o,stripTags:s,encodeTags:f,escapeId:i,base64encode:r,base64decode:u,transition:v,lock:y,unlock:p,lang:h,locale:c,getSize:a,scrollBarSize:l}}(jQuery),w2popup,w2alert,w2confirm;w2utils.event={on:function(n,t){if(jQuery.isPlainObject(n)||(n={type:n}),n=jQuery.extend({type:null,execute:"before",target:null,onComplete:null},n),typeof n.type=="undefined"){console.log("ERROR: You must specify event type when calling .on() method of "+this.name);return}if(typeof t=="undefined"){console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name);return}this.handlers.push({event:n,handler:t})},off:function(n,t){var r,u,i;if(jQuery.isPlainObject(n)||(n={type:n}),n=jQuery.extend({},{type:null,execute:"before",target:null,onComplete:null},n),typeof n.type=="undefined"){console.log("ERROR: You must specify event type when calling .off() method of "+this.name);return}typeof t=="undefined"&&(t=null),r=[];for(u in this.handlers)i=this.handlers[u],(i.event.type==n.type||n.type=="*")&&(i.event.target==n.target||n.target==null)&&(i.handler==t||t==null)||r.push(i);this.handlers=r},trigger:function(n){var n=jQuery.extend({type:null,phase:"before",target:null,isStopped:!1,isCancelled:!1},n,{preventDefault:function(){this.isCancelled=!0},stopPropagation:function(){this.isStopped=!0}}),e,t,r,i,f;for(typeof n.target=="undefined"&&(n.target=null),e=this.handlers.length-1;e>=0;e--)if(t=this.handlers[e],(t.event.type==n.type||t.event.type=="*")&&(t.event.target==n.target||t.event.target==null)&&(t.event.execute==n.phase||t.event.execute=="*"||t.event.phase=="*")&&(n=jQuery.extend({},t.event,n),r=[],i=RegExp(/\((.*?)\)/).exec(t.handler),i&&(r=i[1].split(/\s*,\s*/)),r.length==2?t.handler.call(this,n.target,n):t.handler.call(this,n),n.isStopped===!0||n.stop===!0))return n;if(f="on"+n.type.substr(0,1).toUpperCase()+n.type.substr(1),n.phase=="before"&&typeof this[f]=="function"){var u=this[f],r=[],i=RegExp(/\((.*?)\)/).exec(u);if(i&&(r=i[1].split(/\s*,\s*/)),r.length==2?u.call(this,n.target,n):u.call(this,n),n.isStopped===!0||n.stop===!0)return n}if(typeof n.object!="undefined"&&n.object!=null&&n.phase=="before"&&typeof n.object[f]=="function"){var u=n.object[f],r=[],i=RegExp(/\((.*?)\)/).exec(u);if(i&&(r=i[1].split(/\s*,\s*/)),r.length==2?u.call(this,n.target,n):u.call(this,n),n.isStopped===!0||n.stop===!0)return n}return n.phase=="after"&&n.onComplete!=null&&n.onComplete.call(this,n),n}},w2utils.keyboard=function(n){function f(){jQuery(document).on("keydown",e);jQuery(document).on("mousedown",o)}function e(n){var i=n.target.tagName;jQuery.inArray(i,["INPUT","SELECT","TEXTAREA"])==-1&&jQuery(n.target).prop("contenteditable")!="true"&&t&&w2ui[t]&&typeof w2ui[t].keydown=="function"&&w2ui[t].keydown.call(w2ui[t],n)}function o(n){var r=n.target.tagName,i=jQuery(n.target).parents(".w2ui-reset");i.length>0&&(t=i.attr("name"))}function i(n){if(typeof n=="undefined")return t;t=n}function r(){t=null}function u(){}var t=null;return n.active=i,n.clear=r,n.register=u,f(),n}({}),function(n){n.fn.w2render=function(t){n(this).length>0&&(typeof t=="string"&&w2ui[t]&&w2ui[t].render(n(this)[0]),typeof t=="object"&&t.render(n(this)[0]))},n.fn.w2destroy=function(n){!n&&this.length>0&&(n=this.attr("name")),typeof n=="string"&&w2ui[n]&&w2ui[n].destroy(),typeof n=="object"&&n.destroy()},n.fn.w2marker=function(t){return t==""||typeof t=="undefined"?n(this).each(function(n,t){t.innerHTML=t.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>(.*)\<\/span\>/ig,"$1")}):n(this).each(function(n,i){var f,r,u;typeof t=="string"&&(t=[t]),i.innerHTML=i.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>(.*)\<\/span\>/ig,"$1");for(f in t)r=t[f],typeof r!="string"&&(r=String(r)),r=r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;"),u=new RegExp(r+"(?!([^<]+)?>)","gi"),i.innerHTML=i.innerHTML.replace(u,function(n){return'<span class="w2ui-marker">'+n+"</span>"})})},n.fn.w2tag=function(t,i){if(n.isPlainObject(i)||(i={}),n.isPlainObject(i.css)||(i.css={}),typeof i["class"]=="undefined"&&(i["class"]=""),n(this).length==0){n(".w2ui-tag").each(function(t,i){var r=n(i).data("options");typeof r=="undefined"&&(r={}),n(n(i).data("taged-el")).removeClass(r["class"]),clearInterval(n(i).data("timer")),n(i).remove()});return}return n(this).each(function(r,u){var h=u.id,f=w2utils.escapeId(u.id),s,o;if(t==""||t==null||typeof t=="undefined")n("#w2ui-tag-"+f).css("opacity",0),setTimeout(function(){clearInterval(n("#w2ui-tag-"+f).data("timer")),n("#w2ui-tag-"+f).remove()},300);else{clearInterval(n("#w2ui-tag-"+f).data("timer")),n("#w2ui-tag-"+f).remove(),n("body").append('<div id="w2ui-tag-'+h+'" class="w2ui-tag '+(n(u).parents(".w2ui-popup").length>0?"w2ui-tag-popup":"")+'" \tstyle=""></div>'),s=setInterval(function(){if(n(u).length==0||n(u).offset().left==0&&n(u).offset().top==0){clearInterval(n("#w2ui-tag-"+f).data("timer")),e();return}n("#w2ui-tag-"+f).data("position")!=n(u).offset().left+u.offsetWidth+"x"+n(u).offset().top&&n("#w2ui-tag-"+f).css({"-webkit-transition":".2s","-moz-transition":".2s","-ms-transition":".2s","-o-transition":".2s",left:n(u).offset().left+u.offsetWidth+"px",top:n(u).offset().top+"px"}).data("position",n(u).offset().left+u.offsetWidth+"x"+n(u).offset().top)},100),setTimeout(function(){n(u).offset()&&(n("#w2ui-tag-"+f).css({opacity:"1",left:n(u).offset().left+u.offsetWidth+"px",top:n(u).offset().top+"px"}).html('<div style="margin-top: -2px 0px 0px -2px; white-space: nowrap;"> <div class="w2ui-tag-body">'+t+"</div> </div>").data("text",t).data("taged-el",u).data("options",i).data("position",n(u).offset().left+u.offsetWidth+"x"+n(u).offset().top).data("timer",s),n(u).off("keypress",e).on("keypress",e).off("change",e).on("change",e).css(i.css).addClass(i["class"]),typeof i.onShow=="function"&&i.onShow())},1),o="",n(u).length>0&&(o=n(u)[0].style.cssText);function e(){n("#w2ui-tag-"+f).length<=0||(clearInterval(n("#w2ui-tag-"+f).data("timer")),n("#w2ui-tag-"+f).remove(),n(u).off("keypress",e).removeClass(i["class"]),n(u).length>0&&(n(u)[0].style.cssText=o),typeof i.onHide=="function"&&i.onHide())}}})},n.fn.w2overlay=function(t,i){function e(){var t;(typeof i.onHide=="function"&&(t=i.onHide()),t!==!1)&&(n("#w2ui-overlay").remove(),n(document).off("click",e))}function o(){n(document).on("click",e);if(n("#w2ui-overlay > div").length>0){var u=n("#w2ui-overlay > div").height(),r=n("#w2ui-overlay> div").width(),t=window.innerHeight-n("#w2ui-overlay > div").offset().top-7;u>t&&n("#w2ui-overlay> div").height(t).width(r+w2utils.scrollBarSize()).css({"overflow-y":"auto"}),r=n("#w2ui-overlay> div").width(),t=window.innerWidth-n("#w2ui-overlay > div").offset().left-7,r>t&&n("#w2ui-overlay> div").width(t).css({"overflow-x":"auto"}),typeof i.onShow=="function"&&i.onShow()}}var u,f,r;if(n.isPlainObject(i)||(i={}),n.isPlainObject(i.css)||(i.css={}),this.length==0||t==""||typeof t=="undefined")return e(),n(this);n("#w2ui-overlay").length>0&&n(document).click(),n("body").append('<div id="w2ui-overlay" class="w2ui-reset w2ui-overlay '+(n(this).parents(".w2ui-popup").length>0?"w2ui-overlay-popup":"")+'">\t<div></div></div>'),u=this,r=n("#w2ui-overlay div"),r.css(i.css).html(t),typeof i["class"]!="undefined"&&r.addClass(i["class"]),typeof i.top=="undefined"&&(i.top=0),typeof i.left=="undefined"&&(i.left=0),typeof i.width=="undefined"&&(i.width=100),typeof i.height=="undefined"&&(i.height=0),f=r.css("background-color"),r=n("#w2ui-overlay"),typeof f!="undefined"&&f!="rgba(0, 0, 0, 0)"&&f!="transparent"&&r.css("background-color",f);r.css({display:"none",left:n(u).offset().left+i.left+"px",top:n(u).offset().top+w2utils.getSize(n(u),"height")+3+i.top+"px","min-width":i.width?i.width:"auto","min-height":i.height?i.height:"auto"}).fadeIn("fast").data("position",n(u).offset().left+"x"+(n(u).offset().top+u.offsetHeight)).on("click",function(n){n.stopPropagation?n.stopPropagation():n.cancelBubble=!0});return setTimeout(o,0),n(this)},n.fn.w2menu=function(t,i){function r(){for(var f='<table cellspacing="0" cellpadding="0" class="w2ui-drop-menu">',n,i,u,r=0;r<t.length;r++)n=t[r],typeof n=="string"?(i=n.split("|"),n={id:i[0],text:i[0],img:null,icon:null},i[1]&&(n.text=i[1]),i[2]&&(n.img=i[2]),i[3]&&(n.icon=i[3])):(typeof n.text!="undefined"&&typeof n.id=="undefined"&&(n.id=n.text),typeof n.text=="undefined"&&typeof n.id!="undefined"&&(n.text=n.id),typeof n.caption!="undefined"&&(n.text=n.caption),typeof n.img=="undefined"&&(n.img=null),typeof n.icon=="undefined"&&(n.icon=null)),u="<td>&nbsp;</td>",n.img&&(u='<td><div class="w2ui-tb-image w2ui-icon '+n.img+'"></div></td>'),n.icon&&(u='<td align="center"><div class="w2ui-tb-image"><span class="'+n.icon+'"></span></div></td>'),f+="<tr onmouseover=\"$(this).addClass('w2ui-selected');\" onmouseout=\"$(this).removeClass('w2ui-selected');\" \t\tonclick=\"$(document).click(); $.fn.w2menuHandler(event, '"+r+"');\">"+u+"\t<td>"+n.text+"</td></tr>";return f+="</table>"}return(typeof i.select=="undefined"&&typeof i.onSelect=="function"&&(i.select=i.onSelect),typeof i.select!="function")?(console.log("ERROR: options.select is required to be a function, not "+typeof i.select+" in $().w2menu(menu, options)"),n(this)):n.isArray(t)?(n.fn.w2menuHandler=function(n,r){i.select(t[r],n,r)},n(this).w2overlay(r(),i)):(console.log("ERROR: first parameter should be an array of objects or strings in $().w2menu(menu, options)"),n(this))}}(jQuery),function($){var w2grid=function(n){this.name=null,this.box=null,this.header="",this.url="",this.columns=[],this.columnGroups=[],this.records=[],this.summary=[],this.searches=[],this.searchData=[],this.sortData=[],this.postData={},this.toolbar={},this.show={header:!1,toolbar:!1,footer:!1,columnHeaders:!0,lineNumbers:!1,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!0,toolbarSearch:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!0,recordTitles:!0},this.autoLoad=!0,this.fixedBody=!0,this.recordHeight=24,this.keyboard=!0,this.selectType="row",this.multiSearch=!0,this.multiSelect=!0,this.multiSort=!0,this.markSearchResults=!0,this.total=0,this.buffered=0,this.limit=100,this.offset=0,this.style="",this.ranges=[],this.onAdd=null,this.onEdit=null,this.onRequest=null,this.onLoad=null,this.onDelete=null,this.onDeleted=null,this.onSave=null,this.onSaved=null,this.onSelect=null,this.onUnselect=null,this.onClick=null,this.onDblClick=null,this.onColumnClick=null,this.onColumnResize=null,this.onSort=null,this.onSearch=null,this.onChange=null,this.onExpand=null,this.onCollapse=null,this.onError=null,this.onKeydown=null,this.onToolbar=null,this.onColumnOnOff=null,this.onCopy=null,this.onPaste=null,this.onSelectionExtend=null,this.onEditField=null,this.onRender=null,this.onRefresh=null,this.onReload=null,this.onResize=null,this.onDestroy=null,this.last={field:"all",caption:w2utils.lang("All Fields"),logic:"OR",search:"",searchIds:[],multi:!1,scrollTop:0,scrollLeft:0,selected:[],sortData:null,sortCount:0,xhr:null,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null},this.isIOS=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1||navigator.userAgent.toLowerCase().indexOf("ipod")!=-1||navigator.userAgent.toLowerCase().indexOf("ipad")!=-1?!0:!1,$.extend(!0,this,w2obj.grid,n)};$.fn.w2grid=function(n){var i,u,a,r,e,o,s;if(typeof n!="object"&&n){if(w2ui[$(this).attr("name")])return s=w2ui[$(this).attr("name")],s[n].apply(s,Array.prototype.slice.call(arguments,1)),this;console.log("ERROR: Method "+n+" does not exist on jQuery.w2grid")}else{if(!n||typeof n.name=="undefined"){console.log('ERROR: The parameter "name" is required but not supplied in $().w2grid().');return}if(typeof w2ui[n.name]!="undefined"){console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+n.name+").");return}if(!w2utils.isAlphaNumeric(n.name)){console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). ');return}var h=n.columns,l=n.columnGroups,f=n.records,c=n.searches,y=n.searchData,v=n.sortData,w=n.postData,p=n.toolbar,t=new w2grid(n);$.extend(t,{postData:{},records:[],columns:[],searches:[],toolbar:{},sortData:[],searchData:[],handlers:[]}),t.onExpand!=null&&(t.show.expandColumn=!0),$.extend(!0,t.toolbar,p);for(i in h)t.columns[i]=$.extend(!0,{},h[i]);for(i in l)t.columnGroups[i]=$.extend(!0,{},l[i]);for(i in c)t.searches[i]=$.extend(!0,{},c[i]);for(i in y)t.searchData[i]=$.extend(!0,{},y[i]);for(i in v)t.sortData[i]=$.extend(!0,{},v[i]);t.postData=$.extend(!0,{},w);for(u in f){if(f[u].recid==null||typeof f[u].recid=="undefined"){console.log("ERROR: Cannot add records without recid. (obj: "+t.name+")");return}t.records[u]=$.extend(!0,{},f[u])}t.records.length>0&&(t.buffered=t.records.length);for(a in t.columns)(r=t.columns[a],typeof r.searchable!="undefined"&&t.getSearch(r.field)==null)&&(e=r.searchable,o="",r.searchable===!0&&(e="text",o='size="20"'),t.addSearch({field:r.field,caption:r.caption,type:e,attr:o}));return t.initToolbar(),$(this).length!=0&&t.render($(this)[0]),w2ui[t.name]=t,t}},w2grid.prototype={msgDelete:w2utils.lang("Are you sure you want to delete selected records?"),msgNotJSON:w2utils.lang("Returned data is not in valid JSON format."),msgRefresh:w2utils.lang("Refreshing..."),buttons:{reload:{type:"button",id:"reload",img:"icon-reload",hint:w2utils.lang("Reload data in the list")},columns:{type:"drop",id:"column-on-off",img:"icon-columns",hint:w2utils.lang("Show/hide columns"),arrow:!1,html:""},search:{type:"html",id:"search",html:'<div class="w2ui-icon icon-search-down w2ui-search-down" title="'+w2utils.lang("Select Search Field")+"\" onclick=\"var obj = w2ui[$(this).parents('div.w2ui-grid').attr('name')]; obj.searchShowFields(this);\"></div>"},"search-go":{type:"check",id:"search-advanced",caption:w2utils.lang("Search..."),hint:w2utils.lang("Open Search Fields")},add:{type:"button",id:"add",caption:w2utils.lang("Add New"),hint:w2utils.lang("Add new record"),img:"icon-add"},edit:{type:"button",id:"edit",caption:w2utils.lang("Edit"),hint:w2utils.lang("Edit selected record"),img:"icon-edit",disabled:!0},"delete":{type:"button",id:"delete",caption:w2utils.lang("Delete"),hint:w2utils.lang("Delete selected records"),img:"icon-delete",disabled:!0},save:{type:"button",id:"save",caption:w2utils.lang("Save"),hint:w2utils.lang("Save changed records"),img:"icon-save"}},add:function(n){var i,t,r;$.isArray(n)||(n=[n]),i=0;for(t in n){if(n[t].recid==null||typeof n[t].recid=="undefined"){console.log("ERROR: Cannot add record without recid. (obj: "+this.name+")");continue}this.records.push(n[t]),i++}return this.buffered=this.records.length,r=typeof this.url!="object"?this.url:this.url.get,r||(this.localSort(),this.localSearch()),this.refresh(),i},find:function(n,t){var f,i,u,r,e;for((typeof n=="undefined"||n==null)&&(n={}),f=[],i=0;i<this.records.length;i++){u=!0;for(r in n)e=this.records[i][r],String(r).indexOf(".")!=-1&&(e=this.parseField(this.records[i],r)),n[r]!=e&&(u=!1);u&&t!==!0&&f.push(this.records[i]),u&&t===!0&&f.push(i)}return f},set:function(n,t,i){var e,r,u,s,o,f;if(typeof n=="object"&&(i=t,t=n,n=null),n==null){for(e in this.records)$.extend(!0,this.records[e],t);i!==!0&&this.refresh()}else{if(r=this.get(n,!0),r==null)return!1;if($.extend(!0,this.records[r],t),i!==!0&&(u=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(n)),u.length!=0)){if(s=u.attr("line"),o=typeof this.url!="object"?this.url:this.url.get,this.searchData.length>0&&!o)for(f in this.last.searchIds)this.last.searchIds[f]==r&&(r=f);$(u).replaceWith(this.getRecordHTML(r,s))}}return!0},get:function(n,t){for(var i=0;i<this.records.length;i++)if(this.records[i].recid==n)return t===!0?i:this.records[i];return null},remove:function(){for(var r=0,n,i,t=0;t<arguments.length;t++)for(n=this.records.length-1;n>=0;n--)this.records[n].recid==arguments[t]&&(this.records.splice(n,1),r++);return i=typeof this.url!="object"?this.url:this.url.get,i||(this.buffered=this.records.length,this.localSort(),this.localSearch()),this.refresh(),r},addColumn:function(n,t){var r=0,i;arguments.length==1?(t=n,n=this.columns.length):(typeof n=="string"&&(n=this.getColumn(n,!0)),n===null&&(n=this.columns.length)),$.isArray(t)||(t=[t]);for(i in t)this.columns.splice(n,0,t[i]),n++,r++;return this.initColumnOnOff(),this.refresh(),r},removeColumn:function(){for(var i=0,n,t=0;t<arguments.length;t++)for(n=this.columns.length-1;n>=0;n--)this.columns[n].field==arguments[t]&&(this.columns.splice(n,1),i++);return this.initColumnOnOff(),this.refresh(),i},getColumn:function(n,t){for(var i=0;i<this.columns.length;i++)if(this.columns[i].field==n)return t===!0?i:this.columns[i];return null},toggleColumn:function(){for(var i=0,n,t=0;t<arguments.length;t++)for(n=this.columns.length-1;n>=0;n--)this.columns[n].field==arguments[t]&&(this.columns[n].hidden=!this.columns[n].hidden,i++);return this.refresh(),i},showColumn:function(){for(var i=0,n,t=0;t<arguments.length;t++)for(n=this.columns.length-1;n>=0;n--)this.columns[n].field==arguments[t]&&this.columns[n].hidden!==!1&&(this.columns[n].hidden=!1,i++);return this.refresh(),i},hideColumn:function(){for(var i=0,n,t=0;t<arguments.length;t++)for(n=this.columns.length-1;n>=0;n--)this.columns[n].field==arguments[t]&&this.columns[n].hidden!==!0&&(this.columns[n].hidden=!0,i++);return this.refresh(),i},addSearch:function(n,t){var r=0,i;arguments.length==1?(t=n,n=this.searches.length):(typeof n=="string"&&(n=this.getSearch(n,!0)),n===null&&(n=this.searches.length)),$.isArray(t)||(t=[t]);for(i in t)this.searches.splice(n,0,t[i]),n++,r++;return this.searchClose(),r},removeSearch:function(){for(var i=0,n,t=0;t<arguments.length;t++)for(n=this.searches.length-1;n>=0;n--)this.searches[n].field==arguments[t]&&(this.searches.splice(n,1),i++);return this.searchClose(),i},getSearch:function(n,t){for(var i=0;i<this.searches.length;i++)if(this.searches[i].field==n)return t===!0?i:this.searches[i];return null},toggleSearch:function(){for(var i=0,n,t=0;t<arguments.length;t++)for(n=this.searches.length-1;n>=0;n--)this.searches[n].field==arguments[t]&&(this.searches[n].hidden=!this.searches[n].hidden,i++);return this.searchClose(),i},showSearch:function(){for(var i=0,n,t=0;t<arguments.length;t++)for(n=this.searches.length-1;n>=0;n--)this.searches[n].field==arguments[t]&&this.searches[n].hidden!==!1&&(this.searches[n].hidden=!1,i++);return this.searchClose(),i},hideSearch:function(){for(var i=0,n,t=0;t<arguments.length;t++)for(n=this.searches.length-1;n>=0;n--)this.searches[n].field==arguments[t]&&this.searches[n].hidden!==!0&&(this.searches[n].hidden=!0,i++);return this.searchClose(),i},getSearchData:function(n){for(var t in this.searchData)if(this.searchData[t].field==n)return this.searchData[t];return null},localSort:function(n){var r=typeof this.url!="object"?this.url:this.url.get,i,t;if(r){console.log("ERROR: grid.localSort can only be used on local data source, grid.url should be empty.");return}if(!$.isEmptyObject(this.sortData))return i=+new Date,t=this,this.records.sort(function(n,i){var e=0,f,r,u;for(f in t.sortData)if(r=n[t.sortData[f].field],u=i[t.sortData[f].field],String(t.sortData[f].field).indexOf(".")!=-1&&(r=t.parseField(n,t.sortData[f].field),u=t.parseField(i,t.sortData[f].field)),typeof r=="string"&&(r=$.trim(r.toLowerCase())),typeof u=="string"&&(u=$.trim(u.toLowerCase())),r>u&&(e=t.sortData[f].direction=="asc"?1:-1),r<u&&(e=t.sortData[f].direction=="asc"?-1:1),typeof r!="object"&&typeof u=="object"&&(e=-1),typeof u!="object"&&typeof r=="object"&&(e=1),e!=0)break;return e}),i=+new Date-i,n!==!0&&setTimeout(function(){t.status("Sorting took "+i/1e3+" sec")},10),i},localSearch:function(n){var a=typeof this.url!="object"?this.url:this.url.get,h,c,l,s,u,v,i,t,f,r,o,e;if(a){console.log("ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.");return}if(h=+new Date,c=this,this.total=this.records.length,this.last.searchIds=[],this.searchData.length>0&&!a){this.total=0;for(l in this.records){s=this.records[l],u=0;for(v in this.searchData)if(i=this.searchData[v],t=this.getSearch(i.field),i!=null){t==null&&(t={field:i.field,type:i.type}),f=String(c.parseField(s,t.field)).toLowerCase(),typeof i.value!="undefined"&&($.isArray(i.value)?(r=i.value[0],e=i.value[1]):r=String(i.value).toLowerCase());switch(i.operator){case"is":s[t.field]==i.value&&u++,t.type=="date"&&(o=new Date(Number(f)),f=+new Date(o.getFullYear(),o.getMonth(),o.getDate()),r=Number(r),e=Number(f)+864e5,r>=f&&r<=e&&u++);break;case"between":t.type=="int"&&parseInt(s[t.field])>=parseInt(r)&&parseInt(s[t.field])<=parseInt(e)&&u++,t.type=="float"&&parseFloat(s[t.field])>=parseFloat(r)&&parseFloat(s[t.field])<=parseFloat(e)&&u++,t.type=="date"&&(o=new Date(Number(e)),e=+new Date(o.getFullYear(),o.getMonth(),o.getDate()),e=Number(e)+864e5,f>=r&&f<e&&u++);break;case"in":i.value.indexOf(f)!==-1&&u++;break;case"begins with":f.indexOf(r)==0&&u++;break;case"contains":f.indexOf(r)>=0&&u++;break;case"ends with":f.indexOf(r)==f.length-r.length&&u++}}(this.last.logic=="OR"&&u!=0||this.last.logic=="AND"&&u==this.searchData.length)&&this.last.searchIds.push(parseInt(l))}this.total=this.last.searchIds.length}return this.buffered=this.total,h=+new Date-h,n!==!0&&setTimeout(function(){c.status("Search took "+h/1e3+" sec")},10),h},getRangeData:function(n,t){var o=this.get(n[0].recid,!0),c=this.get(n[1].recid,!0),s=n[0].column,h=n[1].column,r=[],u,f,i,e;if(s==h)for(u=o;u<=c;u++)f=this.records[u],e=f[this.columns[s].field]||null,t!==!0?r.push(e):r.push({data:e,column:s,index:u,record:f});else if(o==c)for(f=this.records[o],i=s;i<=h;i++)e=f[this.columns[i].field]||null,t!==!0?r.push(e):r.push({data:e,column:i,index:o,record:f});else for(u=o;u<=c;u++)for(f=this.records[u],r.push([]),i=s;i<=h;i++)e=f[this.columns[i].field],t!==!0?r[r.length-1].push(e):r[r.length-1].push({data:e,column:i,index:u,record:f});return r},addRange:function(n){var o=0,t,u,e,f,s;if(this.selectType=="row")return o;$.isArray(n)||(n=[n]);for(t in n){if(typeof n[t]!="object"&&(n[t]={name:"selection"}),n[t].name=="selection"){if(this.show.selectionBorder===!1)continue;if(u=this.getSelection(),u.length==0){this.removeRange(n[t].name);continue}else var i=u[0],r=u[u.length-1],c=$("#grid_"+this.name+"_rec_"+i.recid+" td[col="+i.column+"]"),h=$("#grid_"+this.name+"_rec_"+r.recid+" td[col="+r.column+"]")}else var i=n[t].range[0],r=n[t].range[1],c=$("#grid_"+this.name+"_rec_"+i.recid+" td[col="+i.column+"]"),h=$("#grid_"+this.name+"_rec_"+r.recid+" td[col="+r.column+"]");if(i){e={name:n[t].name,range:[{recid:i.recid,column:i.column},{recid:r.recid,column:r.column}],style:n[t].style||""},f=!1;for(s in this.ranges)if(this.ranges[s].name==n[t].name){f=t;break}f!==!1?this.ranges[f]=e:this.ranges.push(e),o++}}return this.refreshRanges(),o},removeRange:function(){for(var r=0,i,n,t=0;t<arguments.length;t++)for(i=arguments[t],$("#grid_"+this.name+"_"+i).remove(),n=this.ranges.length-1;n>=0;n--)this.ranges[n].name==i&&(this.ranges.splice(n,1),r++);return r},refreshRanges:function(){function l(t){var i=n.getSelection();n.last.move={type:"expand",x:t.screenX,y:t.screenY,divX:0,divY:0,recid:i[0].recid,column:i[0].column,originalRange:[{recid:i[0].recid,column:i[0].column},{recid:i[i.length-1].recid,column:i[i.length-1].column}],newRange:[{recid:i[0].recid,column:i[0].column},{recid:i[i.length-1].recid,column:i[i.length-1].column}]};$(document).off("mousemove",f).on("mousemove",f);$(document).off("mouseup",e).on("mouseup",e)}function f(t){var r=n.last.move,e,o,u,f;if(r&&r.type=="expand"&&(r.divX=t.screenX-r.x,r.divY=t.screenY-r.y,u=t.originalEvent.target,u.tagName!="TD"&&(u=$(u).parents("td")[0]),typeof $(u).attr("col")!="undefined"&&(o=parseInt($(u).attr("col"))),u=$(u).parents("tr")[0],e=$(u).attr("recid"),r.newRange[1].recid!=e||r.newRange[1].column!=o)){if(f=$.extend({},r.newRange),r.newRange=[{recid:r.recid,column:r.column},{recid:e,column:o}],i=n.trigger($.extend(i,{originalRange:r.originalRange,newRange:r.newRange})),i.isCancelled===!0){r.newRange=f,i.newRange=f;return}n.removeRange("grid-selection-expand"),n.addRange({name:"grid-selection-expand",range:i.newRange,style:"background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);"})}}function e(){n.removeRange("grid-selection-expand"),delete n.last.move,$(document).off("mousemove",f),$(document).off("mouseup",e),n.trigger($.extend(i,{phase:"after"}))}var n=this,a=+new Date,o=$("#grid_"+this.name+"_records"),c,i;for(c in this.ranges){var t=this.ranges[c],h=t.range[0],s=t.range[1],r=$("#grid_"+this.name+"_rec_"+h.recid+" td[col="+h.column+"]"),u=$("#grid_"+this.name+"_rec_"+s.recid+" td[col="+s.column+"]");$("#grid_"+this.name+"_"+t.name).length==0?o.append('<div id="grid_'+this.name+"_"+t.name+'" class="w2ui-selection" style="'+t.style+'">'+(t.name=="selection"?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"):$("#grid_"+this.name+"_"+t.name).attr("style",t.style),r.length>0&&u.length>0&&$("#grid_"+this.name+"_"+t.name).css({left:r.position().left-1+o.scrollLeft()+"px",top:r.position().top-1+o.scrollTop()+"px",width:u.position().left-r.position().left+u.width()+3+"px",height:u.position().top-r.position().top+u.height()+3+"px"})}$(this.box).find("#grid_"+this.name+"_resizer").off("mousedown").on("mousedown",l);return i={phase:"before",type:"selectionExtend",target:n.name,originalRange:null,newRange:null},+new Date-a},select:function(){for(var s=0,r,o,e,f,u,i=0;i<arguments.length;i++){var t=typeof arguments[i]=="object"?arguments[i].recid:arguments[i],n=this.get(t),h=this.get(t,!0);if(n!=null){if(this.selectType=="row"){if(n.selected===!0)continue;if(u=this.trigger({phase:"before",type:"select",target:this.name,recid:t}),u.isCancelled===!0)continue;n.selected=!0,$("#grid_"+this.name+"_rec_"+w2utils.escapeId(t)).addClass("w2ui-selected").data("selected","yes"),$("#grid_"+this.name+"_cell_"+h+"_select_check").prop("checked",!0),s++}else{if(r=arguments[i].column,!w2utils.isInt(r)){o=[];for(e in this.columns)this.columns[e].hidden||o.push({recid:t,column:parseInt(e)});return this.select.apply(this,o)}if(f=n.selectedColumns,$.isArray(f)&&f.indexOf(r)!=-1)continue;if(u=this.trigger({phase:"before",type:"select",target:this.name,recid:t,column:r}),u.isCancelled===!0)continue;$.isArray(f)||(n.selectedColumns=[]),n.selected=!0,n.selectedColumns.push(r),n.selectedColumns.sort(function(n,t){return n-t}),$("#grid_"+this.name+"_rec_"+w2utils.escapeId(t)+" > td[col="+r+"]").addClass("w2ui-selected"),s++,n.selected&&($("#grid_"+this.name+"_rec_"+w2utils.escapeId(t)).data("selected","yes"),$("#grid_"+this.name+"_cell_"+h+"_select_check").prop("checked",!0))}this.trigger($.extend(u,{phase:"after"}))}}return $("#grid_"+this.name+"_check_all").prop("checked",!0),$("#grid_"+this.name+"_records").find(".grid_select_check[type=checkbox]").length!=0&&$("#grid_"+this.name+"_records").find(".grid_select_check[type=checkbox]").length==$("#grid_"+this.name+"_records").find(".grid_select_check[type=checkbox]:checked").length?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),s},unselect:function(){for(var s=0,f,i,h,o,r,e,t=0;t<arguments.length;t++){var u=typeof arguments[t]=="object"?arguments[t].recid:arguments[t],n=this.get(u),c=this.get(n.recid,!0);if(n!=null){if(this.selectType=="row"){if(n.selected!==!0)continue;if(e=this.trigger({phase:"before",type:"unselect",target:this.name,recid:u}),e.isCancelled===!0)continue;n.selected=!1,f=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(n.recid)),f.removeClass("w2ui-selected").removeData("selected"),f.length!=0&&(f[0].style.cssText="height: "+this.recordHeight+"px; "+f.attr("custom_style")),$("#grid_"+this.name+"_cell_"+c+"_select_check").prop("checked",!1),s++}else{if(i=arguments[t].column,!w2utils.isInt(i)){h=[];for(o in this.columns)this.columns[o].hidden||h.push({recid:u,column:parseInt(o)});return this.unselect.apply(this,h)}if(r=n.selectedColumns,!$.isArray(r)||r.indexOf(i)==-1)continue;if(e=this.trigger({phase:"before",type:"unselect",target:this.name,recid:u,column:i}),e.isCancelled===!0)continue;r.splice(r.indexOf(i),1),$("#grid_"+this.name+"_rec_"+w2utils.escapeId(u)+" > td[col="+i+"]").removeClass("w2ui-selected"),s++,r.length==0&&(n.selected=!1,$("#grid_"+this.name+"_rec_"+w2utils.escapeId(u)).removeData("selected"),$("#grid_"+this.name+"_cell_"+c+"_select_check").prop("checked",!1))}this.trigger($.extend(e,{phase:"after"}))}}return $("#grid_"+this.name+"_check_all").prop("checked",!0),$("#grid_"+this.name+"_records").find(".grid_select_check[type=checkbox]").length!=0&&$("#grid_"+this.name+"_records").find(".grid_select_check[type=checkbox]").length==$("#grid_"+this.name+"_records").find(".grid_select_check[type=checkbox]:checked").length?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),s},selectAll:function(){var r,n,u,f,t,i;if(this.multiSelect!==!1&&(r=this.trigger({phase:"before",type:"select",target:this.name,all:!0}),r.isCancelled!==!0)){n=[];for(u in this.columns)n.push(parseInt(u));if(f=typeof this.url!="object"?this.url:this.url.get,f)this.selectType=="row"?this.set({selected:!0}):this.set({selected:!0,selectedColumns:n.slice()}),this.refresh();else if(this.searchData.length==0)this.set({selected:!0}),this.selectType=="row"?this.set({selected:!0}):this.set({selected:!0,selectedColumns:n.slice()});else{for(t=0;t<this.last.searchIds.length;t++)this.records[this.last.searchIds[t]].selected=!0,this.selectType!="row"&&(this.records[this.last.searchIds[t]].selectedColumns=n.slice());this.refresh()}i=this.getSelection(),i.length==1?this.toolbar.enable("edit"):this.toolbar.disable("edit"),i.length>=1?this.toolbar.enable("delete"):this.toolbar.disable("delete"),this.addRange("selection"),this.trigger($.extend(r,{phase:"after"}))}},selectNone:function(){var f=this.trigger({phase:"before",type:"unselect",target:this.name,all:!0}),r,n,t,i,u;if(f.isCancelled!==!0){this.last.selected=[];for(r in this.records)if(n=this.records[r],n.selected===!0&&(n.selected=!1,t=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(n.recid)),t.removeClass("w2ui-selected").removeData("selected"),$("#grid_"+this.name+"_cell_"+r+"_select_check").prop("checked",!1),this.selectType!="row")){i=n.selectedColumns;for(u in i)t.find(" > td[col="+i[u]+"]").removeClass("w2ui-selected");n.selectedColumns=[]}this.toolbar.disable("edit","delete"),this.removeRange("selection"),this.trigger($.extend(f,{phase:"after"}))}},getSelection:function(n){var t,i,r,u,f;if(this.selectType=="row"){t=this.find({selected:!0},!0),i=[];for(r in t)n===!0?i.push(t[r]):i.push(this.records[t[r]].recid);return i}t=this.find({selected:!0},!0),i=[];for(r in t){u=this.records[t[r]];for(f in u.selectedColumns)i.push({recid:u.recid,index:parseInt(t[r]),column:u.selectedColumns[f]})}return i},search:function(n,t){var it=this,nt=typeof this.url!="object"?this.url:this.url.get,u=[],v=this.last.multi,a=this.last.logic,g=this.last.field,p=this.last.search,f,d,h,s,c,r,o,k,b,i,y;if(arguments.length==0){p="";for(f in this.searches){var i=this.searches[f],l=$("#grid_"+this.name+"_operator_"+f).val(),e=$("#grid_"+this.name+"_field_"+f).val(),w=$("#grid_"+this.name+"_field2_"+f).val();if(e!=""&&e!=null||typeof w!="undefined"&&w!=""){r={field:i.field,type:i.type,operator:l},l=="between"?$.extend(r,{value:[e,w]}):l=="in"?$.extend(r,{value:e.split(",")}):$.extend(r,{value:e});try{i.type=="date"&&l=="between"&&(r.value[0]=w2utils.isDate(e,w2utils.settings.date_format,!0).getTime(),r.value[1]=w2utils.isDate(w,w2utils.settings.date_format,!0).getTime()),i.type=="date"&&l=="is"&&(r.value=w2utils.isDate(e,w2utils.settings.date_format,!0).getTime())}catch(tt){}u.push(r)}}u.length>0&&!nt?(v=!0,a="AND"):(v=!0,a="AND")}if(typeof n=="string"&&(g=n,p=t,v=!1,a="OR",typeof t!="undefined"))if(n.toLowerCase()=="all")if(this.searches.length>0)for(f in this.searches)i=this.searches[f],(i.type=="text"||i.type=="int"&&w2utils.isInt(t)||i.type=="float"&&w2utils.isFloat(t)||i.type=="money"&&w2utils.isMoney(t)||i.type=="hex"&&w2utils.isHex(t)||i.type=="date"&&w2utils.isDate(t)||i.type=="alphaNumeric"&&w2utils.isAlphaNumeric(t))&&(r={field:i.field,type:i.type,operator:i.type=="text"?"contains":"is",value:t},u.push(r)),i.type=="int"&&String(t).indexOf("-")!=-1&&(c=String(t).split("-"),r={field:i.field,type:i.type,operator:"between",value:[c[0],c[1]]},u.push(r));else for(d in this.columns)r={field:this.columns[d].field,type:"text",operator:"contains",value:t},u.push(r);else if(i=this.getSearch(n),i==null&&(i={field:n,type:"text"}),i.field==n&&(this.last.caption=i.caption),t!=""){if(h="contains",s=t,w2utils.isInt(t)&&(h="is",s=t),i.type=="int"&&t!=""&&(String(t).indexOf("-")!=-1&&(r=t.split("-"),r.length==2&&(h="between",s=[parseInt(r[0]),parseInt(r[1])])),String(t).indexOf(",")!=-1)){r=t.split(","),h="in",s=[];for(c in r)s.push(r[c])}r={field:i.field,type:i.type,operator:h,value:s},u.push(r)}if($.isArray(n)){o="AND",typeof t=="string"&&(o=t.toUpperCase(),o!="OR"&&o!="AND"&&(o="AND")),p="",v=!0,a=o;for(k in n)b=n[k],i=this.getSearch(b.field),i==null&&(i={type:"text",operator:"contains"}),u.push($.extend(!0,{},i,b))}(y=this.trigger({phase:"before",type:"search",target:this.name,searchData:u,searchField:n?n:"multi",searchValue:t?t:"multi"}),y.isCancelled!==!0)&&(this.searchData=y.searchData,this.last.field=g,this.last.search=p,this.last.multi=v,this.last.logic=a,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selected=[],this.searchClose(),this.set({expanded:!1}),nt?(this.last.xhr_offset=0,this.reload()):(this.localSearch(),this.refresh()),this.trigger($.extend(y,{phase:"after"})))},searchOpen:function(){if(this.box&&this.searches.length!=0){var n=this;$("#tb_"+this.name+"_toolbar_item_search-advanced").w2overlay(this.getSearchesHTML(),{left:-10,"class":"w2ui-grid-searches",onShow:function(){n.last.logic=="OR"&&(n.searchData=[]),n.initSearches(),$("#w2ui-overlay .w2ui-grid-searches").data("grid-name",n.name);var t=$("#w2ui-overlay .w2ui-grid-searches *[rel=search]");t.length>0&&t[0].focus()}})}},searchClose:function(){this.box&&this.searches.length!=0&&(this.toolbar&&this.toolbar.uncheck("search-advanced"),$("#w2ui-overlay .w2ui-grid-searches").length>0&&$().w2overlay())},searchShowFields:function(n){var r,i,t;for(typeof n=="undefined"&&(n=$("#grid_"+this.name+"_search_all")),r='<div class="w2ui-select-field"><table>',i=-1;i<this.searches.length;i++){if(t=this.searches[i],i==-1){if(!this.multiSearch)continue;t={type:"text",field:"all",caption:w2utils.lang("All Fields")}}else if(this.searches[i].hidden===!0)continue;r+="<tr \t"+(this.isIOS?"onTouchStart":"onClick")+"=\"var obj = w2ui['"+this.name+"']; \t\tif ('"+t.type+"' == 'list' || '"+t.type+"' == 'enum') {\t\t\tobj.last.search = '';\t\t\tobj.last.item = '';\t\t\t$('#grid_"+this.name+"_search_all').val('')\t\t}\t\tif (obj.last.search != '') { \t\t\tobj.search('"+t.field+"', obj.last.search); \t\t} else { \t\t\tobj.last.field = '"+t.field+"'; \t\t\tobj.last.caption = '"+t.caption+"'; \t\t}\t\t$('#grid_"+this.name+"_search_all').attr('placeholder', '"+t.caption+'\');\t\t$().w2overlay();"><td><input type="checkbox" tabIndex="-1" '+(t.field==this.last.field?"checked":"disabled")+"></td><td>"+t.caption+"</td></tr>"}r+="</table></div>",$(n).w2overlay(r,{left:-15,top:7})},searchReset:function(n){var t=this.trigger({phase:"before",type:"search",target:this.name,searchData:[]});t.isCancelled!==!0&&(this.searchData=[],this.last.search="",this.last.logic="OR",this.last.multi&&(this.multiSearch?(this.last.field="all",this.last.caption=w2utils.lang("All Fields")):(this.last.field=this.searches[0].field,this.last.caption=this.searches[0].caption)),this.last.multi=!1,this.last.xhr_offset=0,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selected=[],this.searchClose(),n||this.reload(),this.trigger($.extend(t,{phase:"after"})))},clear:function(n){this.offset=0,this.total=0,this.buffered=0,this.records=[],this.summary=[],this.last.scrollTop=0,this.last.scrollLeft=0,this.last.range_start=null,this.last.range_end=null,this.last.xhr_offset=0,n||this.refresh()},reset:function(n){this.offset=0,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selected=[],this.last.range_start=null,this.last.range_end=null,this.last.xhr_offset=0,this.searchReset(n),this.last.sortData!=null&&(this.sortData=this.last.sortData),this.set({selected:!1,expanded:!1},!0),n||this.refresh()},skip:function(n){var t=typeof this.url!="object"?this.url:this.url.get;t?(this.offset=parseInt(n),(this.offset<0||!w2utils.isInt(this.offset))&&(this.offset=0),this.offset>this.total&&(this.offset=this.total-this.limit),this.records=[],this.buffered=0,this.last.xhr_offset=0,this.last.pull_more=!0,this.last.scrollTop=0,this.last.scrollLeft=0,$("#grid_"+this.name+"_records").prop("scrollTop",0),this.initColumnOnOff(),this.reload()):console.log("ERROR: grid.skip() can only be called when you have remote data source.")},load:function(n,t){if(typeof n=="undefined"){console.log('ERROR: You need to provide url argument when calling .load() method of "'+this.name+'" object.');return}this.request("get-records",{},n,t)},reload:function(n){var t=typeof this.url!="object"?this.url:this.url.get;t?(this.last.xhr_offset>0&&this.last.xhr_offset<this.buffered&&(this.last.xhr_offset=this.buffered),this.request("get-records",{},null,n)):(this.localSearch(),this.refresh(),typeof n=="function"&&n())},request:function(n,t,i,r){var u,f,o,e,i;if(typeof t=="undefined"&&(t={}),(typeof i=="undefined"||i==""||i==null)&&(i=this.url),i!=""&&i!=null){if(u={},w2utils.isInt(this.offset)||(this.offset=0),w2utils.isInt(this.last.xhr_offset)||(this.last.xhr_offset=0),u.cmd=n,u.name=this.name,u.limit=this.limit,u.offset=parseInt(this.offset)+this.last.xhr_offset,u.selected=this.getSelection(),u.search=this.searchData,u["search-logic"]=this.last.logic,u.sort=this.sortData.length!=0?this.sortData:"",$.extend(u,this.postData),$.extend(u,t),n=="get-records"){if(f=this.trigger({phase:"before",type:"request",target:this.name,url:i,postData:u}),f.isCancelled===!0)return typeof r=="function"&&r(),!1}else f={url:this.url,postData:u};if(o=this,this.lock(this.msgRefresh,!0),this.last.xhr)try{this.last.xhr.abort()}catch(s){}e="GET",i=typeof f.url!="object"?f.url:f.url.get,u.cmd=="save-records"&&(typeof f.url=="object"&&(i=f.url.save),e="PUT"),u.cmd=="delete-records"&&(typeof f.url=="object"&&(i=f.url.remove),e="DELETE"),w2utils.settings.RESTfull||(e="POST"),this.last.xhr_cmd=u.cmd,this.last.xhr_start=+new Date,this.last.xhr=$.ajax({type:e,url:i,data:String($.param(f.postData,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"),dataType:"text",complete:function(t,i){o.requestComplete(i,n,r)}}),n=="get-records"&&this.trigger($.extend(f,{phase:"after"}))}},requestComplete:function(status,cmd,callBack){var obj=this,event_name,eventData,responseText,data,records,r,url;if(this.unlock(),setTimeout(function(){obj.status(w2utils.lang("Server Response")+" "+(+new Date-obj.last.xhr_start)/1e3+" "+w2utils.lang("sec"))},10),this.last.pull_more=!1,this.last.pull_refresh=!0,event_name="load",this.last.xhr_cmd=="save-records"&&(event_name="saved"),this.last.xhr_cmd=="delete-records"&&(event_name="deleted"),eventData=this.trigger({phase:"before",target:this.name,type:event_name,xhr:this.last.xhr,status:status}),eventData.isCancelled===!0)return typeof callBack=="function"&&callBack(),!1;if(responseText=this.last.xhr.responseText,status!="error"){if(typeof responseText!="undefined"&&responseText!=""){if(typeof responseText=="object")data=responseText;else try{eval("data = "+responseText)}catch(e){}if(typeof data=="undefined"&&(data={status:"error",message:this.msgNotJSON,responseText:responseText}),data.status=="error")obj.error(data.message);else{if(cmd=="get-records")if(this.last.xhr_offset==0)this.records=[],this.summary=[],delete data.status,$.extend(!0,this,data),this.buffered=this.records.length;else{records=data.records,delete data.records,delete data.status,$.extend(!0,this,data);for(r in records)this.records.push(records[r]);this.buffered=this.records.length}if(cmd=="delete-records"){this.reload();return}}}}else obj.error("AJAX Error. See console for more details.");url=typeof this.url!="object"?this.url:this.url.get,url||(this.localSort(),this.localSearch()),this.total=parseInt(this.total),this.trigger($.extend(eventData,{phase:"after"})),this.last.xhr_offset==0?this.refresh():this.scroll(),typeof callBack=="function"&&callBack()},error:function(n){var i=this,t=this.trigger({target:this.name,type:"error",message:n,xhr:this.last.xhr});if(t.isCancelled===!0)return typeof callBack=="function"&&callBack(),!1;setTimeout(function(){w2alert(n,"Error")},1),this.trigger($.extend(t,{phase:"after"}))},getChanges:function(){var i=[],t=this.find({changed:!0}),n;for(n in t)i.push($.extend(!0,{recid:t[n].recid},t[n].changes));return i},mergeChanges:function(){var changed=this.getChanges(),c,record,s;for(c in changed){record=this.get(changed[c].recid);for(s in changed[c])if(s!="recid"){try{eval("record."+s+" = changed[c][s]")}catch(e){}delete record.changed,delete record.changes}}$(this.box).find(".w2ui-editable input").removeClass("changed"),this.refresh()},save:function(){var i=this,r=this.getChanges(),n=this.trigger({phase:"before",target:this.name,type:"save",changed:r}),t;if(n.isCancelled===!0)return!1;t=typeof this.url!="object"?this.url:this.url.save,t?this.request("save-records",{changed:n.changed},null,function(){i.trigger($.extend(n,{phase:"after"}))}):(this.mergeChanges(),this.trigger($.extend(n,{phase:"after"})))},editField:function(n,t,i,r){var u=this,s=u.get(n,!0),f=u.records[s],e=u.columns[t],o=e.editable,l,a,c,h,v;if(f&&e&&o&&(l=u.trigger({phase:"before",type:"editField",target:u.name,recid:n,column:t,value:i,index:s,originalEvent:r}),l.isCancelled!==!0)){i=l.value,this.selectNone(),this.select({recid:n,column:t}),a=$("#grid_"+u.name+"_rec_"+w2utils.escapeId(n)),c=a.find("[col="+t+"] > div"),o.type=="enum"&&console.log("ERROR: Grid's inline editing does not support enum field type."),(o.type=="list"||o.type=="select")&&console.log("ERROR: Grid's inline editing does not support list/select field type."),typeof o.inTag=="undefined"&&(o.inTag=""),typeof o.outTag=="undefined"&&(o.outTag=""),typeof o.style=="undefined"&&(o.style=""),typeof o.items=="undefined"&&(o.items=[]),h=f.changed&&f.changes[e.field]?w2utils.stripTags(f.changes[e.field]):w2utils.stripTags(f[e.field]),(h==null||typeof h=="undefined")&&(h=""),typeof i!="undefined"&&i!=null&&(h=i),v=typeof e.style!="undefined"?e.style+";":"",$.inArray(e.render,["number","int","float","money","percent"])!=-1&&(v+="text-align: right;"),c.addClass("w2ui-editable").html('<input id="grid_'+u.name+"_edit_"+n+"_"+t+'" value="'+h+'" type="text"  \tstyle="outline: none; '+v+o.style+'" field="'+e.field+'" recid="'+n+'" column="'+t+'" '+o.inTag+">"+o.outTag);c.find("input").w2field(o.type).on("blur",function(){if(u.parseField(f,e.field)!=this.value){var r=u.trigger({phase:"before",type:"change",target:u.name,input_id:this.id,recid:n,column:t,value_new:this.value,value_previous:f.changes?f.changes[e.field]:u.parseField(f,e.field),value_original:u.parseField(f,e.field)});r.isCancelled===!0||(f.changed=!0,f.changes=f.changes||{},f.changes[e.field]=r.value_new,u.trigger($.extend(r,{phase:"after"})))}else f.changes&&delete f.changes[e.field],$.isEmptyObject(f.changes)&&delete f.changes;$(a).replaceWith(u.getRecordHTML(s,a.attr("line")))}).on("keydown",function(i){function a(n){var t=n+1;return u.columns.length==t?n:u.columns[t].hidden?a(t):t}function v(n){var t=n-1;return t<0?n:u.columns[t].hidden?v(t):t}function c(n){var t=n+1;return u.records.length==t?n:t}function l(n){var t=n-1;return t<0?n:t}var o=!1,r,h;switch(i.keyCode){case 9:o=!0,r=i.shiftKey?v(t):a(t),r!=t&&(this.blur(),setTimeout(function(){u.selectType!="row"?(u.selectNone(),u.select({recid:n,column:r})):u.editField(n,r,null,i)},1));break;case 13:o=!0,r=i.shiftKey?l(s):c(s),r!=s&&(this.blur(),setTimeout(function(){u.selectType!="row"?(u.selectNone(),u.select({recid:u.records[r].recid,column:t})):u.editField(u.records[r].recid,t,null,i)},1));break;case 38:o=!0,r=l(s),r!=s&&(this.blur(),setTimeout(function(){u.selectType!="row"?(u.selectNone(),u.select({recid:u.records[r].recid,column:t})):u.editField(u.records[r].recid,t,null,i)},1));break;case 40:o=!0,r=c(s),r!=s&&(this.blur(),setTimeout(function(){u.selectType!="row"?(u.selectNone(),u.select({recid:u.records[r].recid,column:t})):u.editField(u.records[r].recid,t,null,i)},1));break;case 27:h=f.changed&&f.changes[e.field]?f.changes[e.field]:u.parseField(f,e.field),this.value=typeof h!="undefined"?h:"",this.blur(),setTimeout(function(){u.select({recid:n,column:t})},1)}o&&i.preventDefault&&i.preventDefault()});typeof i=="undefined"||i==null?c.find("input").focus():c.find("input").val("").focus().val(i),u.trigger($.extend(l,{phase:"after"}))}},"delete":function(n){var o=this,f=this.trigger({phase:"before",target:this.name,type:"delete",force:n}),t,e,u,r,i;if(f.isCancelled===!0)return!1;if(n=f.force,t=this.getSelection(),t.length!=0){if(this.msgDelete!=""&&!n){w2confirm(o.msgDelete,w2utils.lang("Delete Confirmation"),function(n){n=="Yes"&&w2ui[o.name].delete(!0)});return}if(e=typeof this.url!="object"?this.url:this.url.remove,e)this.request("delete-records");else if(typeof t[0]!="object")this.remove.apply(this,t);else{for(u in t)r=this.columns[t[u].column].field,i=this.get(t[u].recid,!0),i!=null&&r!="recid"&&(this.records[i][r]="",this.records[i].changed&&(this.records[i].changes[r]=""));this.refresh()}this.trigger($.extend(f,{phase:"after"}))}},click:function(n,t){var g=+new Date,i=null,b,c,nt,f,r,p,y,a,h,s,v,u,tt,e,k,o;if(typeof n=="object"&&(i=n.column,n=n.recid),w2utils.isInt(n)&&(n=parseInt(n)),typeof t=="undefined"&&(t={}),g-parseInt(this.last.click_time)<250&&t.type=="click"){this.dblClick(n,t);return}if(this.last.click_time=g,i==null&&t.target&&(u=t.target,u.tagName!="TD"&&(u=$(u).parents("td")[0]),typeof $(u).attr("col")!="undefined"&&(i=parseInt($(u).attr("col")))),b=this.trigger({phase:"before",target:this.name,type:"click",recid:n,column:i,originalEvent:t}),b.isCancelled===!0)return!1;c=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(n)).parents("tr"),c.length>0&&String(c.attr("id")).indexOf("expanded_row")!=-1&&(nt=c.parents(".w2ui-grid").attr("name"),w2ui[nt].selectNone(),c.parents(".w2ui-grid").find(".w2ui-expanded-row .w2ui-grid").each(function(n,t){var i=$(t).attr("name");w2ui[i]&&w2ui[i].selectNone()})),$(this.box).find(".w2ui-expanded-row .w2ui-grid").each(function(n,t){var i=$(t).attr("name");w2ui[i]&&w2ui[i].selectNone()}),f=this,r=this.getSelection(),$("#grid_"+this.name+"_check_all").prop("checked",!1);var d=this.get(n,!0),l=this.records[d],w=[];if(f.last.sel_ind=d,f.last.sel_col=i,f.last.sel_recid=n,f.last.sel_type="click",t.shiftKey&&r.length>0){if(r[0].recid)for(h=this.get(r[0].recid,!0),s=this.get(n,!0),i>r[0].column?(p=r[0].column,y=i):(p=i,y=r[0].column),a=p;a<=y;a++)w.push(a);else h=this.get(r[0],!0),s=this.get(n,!0);for(v=[],h>s&&(u=h,h=s,s=u),tt=typeof this.url!="object"?this.url:this.url.get,e=h;e<=s;e++)if(!(this.searchData.length>0)||tt||$.inArray(e,this.last.searchIds)!=-1)if(this.selectType=="row")v.push(this.records[e].recid);else for(k in w)v.push({recid:this.records[e].recid,column:w[k]});this.select.apply(this,v)}else(t.ctrlKey||t.shiftKey||t.metaKey)&&this.multiSelect||this.showSelectColumn?(o=l.selected,this.selectType!="row"&&$.inArray(i,l.selectedColumns)==-1&&(o=!1),o===!0?this.unselect({recid:n,column:i}):this.select({recid:l.recid,column:i}),setTimeout(function(){window.getSelection&&window.getSelection().removeAllRanges()},10)):(o=l.selected,this.selectType!="row"&&$.inArray(i,l.selectedColumns)==-1&&(o=!1),r.length>300?this.selectNone():this.unselect.apply(this,r),o===!0?this.unselect({recid:n,column:i}):this.select({recid:n,column:i}));this.status(),f.last.selected=this.getSelection(),f.initResize(),this.trigger($.extend(b,{phase:"after"}))},columnClick:function(n,t){var i=this.trigger({phase:"before",type:"columnClick",target:this.name,field:n,originalEvent:t});if(i.isCancelled===!0)return!1;this.sort(n,null,t&&(t.ctrlKey||t.metaKey)?!0:!1),this.trigger($.extend(i,{phase:"after"}))},keydown:function(n){function st(n){if(n+1<t.records.length&&t.last.searchIds.length==0||t.last.searchIds.length>0&&n<t.last.searchIds[t.last.searchIds.length-1]){if(n++,t.last.searchIds.length>0)for(;;){if($.inArray(n,t.last.searchIds)!=-1||n>t.records.length)break;n++}return n}return null}function ht(n){if(n>0&&t.last.searchIds.length==0||t.last.searchIds.length>0&&n>t.last.searchIds[0]){if(n--,t.last.searchIds.length>0)for(;;){if($.inArray(n,t.last.searchIds)!=-1||n<0)break;n--}return n}return null}function et(n){var i=n+1;return t.columns.length==i?n:t.columns[i].hidden?findNext(i):i}function ot(n){var i=n-1;return i<0?n:t.columns[i].hidden?findPrev(i):i}function g(){if(t.last.sel_type!="click")return!1;if(t.selectType!="row"){if(t.last.sel_type="key",i.length>1){for(var n in i)if(i[n].recid==t.last.sel_recid&&i[n].column==t.last.sel_col){i.splice(n,1);break}return t.unselect.apply(t,i),!0}return!1}return(t.last.sel_type="key",i.length>1)?(i.splice(i.indexOf(t.records[t.last.sel_ind].recid),1),t.unselect.apply(t,i),!0):!1}var t=this,it,b,i,c,y,d,a,v,h,l,f,o,rt,e,u;if(t.keyboard===!0){if(it=t.trigger({phase:"before",type:"keydown",target:t.name,originalEvent:n}),it.isCancelled===!0)return!1;if(i=t.getSelection(),i.length!=0){var ct=$("#grid_"+t.name+"_records"),f=i[0],r=[],ft=i[i.length-1];if(typeof f=="object"){for(f=i[0].recid,r=[],b=0;;){if(!i[b]||i[b].recid!=f)break;r.push(i[b].column),b++}ft=i[i.length-1].recid}var p=t.get(f,!0),w=t.get(ft,!0),ut=t.get(f),k=$("#grid_"+t.name+"_rec_"+w2utils.escapeId(t.records[p].recid)),s=!1;switch(n.keyCode){case 8:case 46:t.delete(),s=!0,n.stopPropagation();break;case 27:i=t.getSelection(),t.selectNone(),i.length>0&&(typeof i[0]=="object"?t.select({recid:i[0].recid,column:i[0].column}):t.select(i[0])),s=!0;break;case 13:case 32:r.length==0&&r.push(0),t.editField(f,r[0],null,n),s=!0;break;case 65:if(!n.metaKey&&!n.ctrlKey)break;t.selectAll(),s=!0;break;case 70:if(!n.metaKey&&!n.ctrlKey)break;$("#grid_"+t.name+"_search_all").focus(),s=!0;break;case 13:if(this.selectType=="row"){if(k.length<=0||t.show.expandColumn!==!0)break;t.toggle(f,n),s=!0}else r.length==0&&r.push(0),t.editField(f,r[0],null,n),s=!0;break;case 37:if(l=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(t.records[p].recid)).parents("tr"),l.length>0&&String(l.attr("id")).indexOf("expanded_row")!=-1){f=l.prev().attr("recid"),o=l.parents(".w2ui-grid").attr("name"),t.selectNone(),w2utils.keyboard.active(o),w2ui[o].set(f,{expanded:!1}),w2ui[o].collapse(f),w2ui[o].click(f),s=!0;break}if(this.selectType=="row"){if(k.length<=0||ut.expanded!==!0)break;t.set(f,{expanded:!1},!0),t.collapse(f,n)}else if(c=ot(r[0]),c!=r[0])if(n.shiftKey){if(g())return;var u=[],tt=[],nt=[];if(r.indexOf(this.last.sel_col)==0&&r.length>1)for(e in i)u.indexOf(i[e].recid)==-1&&u.push(i[e].recid),nt.push({recid:i[e].recid,column:r[r.length-1]});else for(e in i)u.indexOf(i[e].recid)==-1&&u.push(i[e].recid),tt.push({recid:i[e].recid,column:c});t.unselect.apply(t,nt),t.select.apply(t,tt)}else t.click({recid:f,column:c},n);else if(!n.shiftKey)for(h=1;h<i.length;h++)t.unselect(i[h]);s=!0;break;case 9:case 39:if(this.selectType=="row"){if(k.length<=0||ut.expanded===!0||t.show.expandColumn!==!0)break;t.expand(f,n)}else if(a=et(r[r.length-1]),a!=r[r.length-1])if(n.shiftKey&&n.keyCode==39){if(g())return;var u=[],tt=[],nt=[];if(r.indexOf(this.last.sel_col)==r.length-1&&r.length>1)for(e in i)u.indexOf(i[e].recid)==-1&&u.push(i[e].recid),nt.push({recid:i[e].recid,column:r[0]});else for(e in i)u.indexOf(i[e].recid)==-1&&u.push(i[e].recid),tt.push({recid:i[e].recid,column:a});t.unselect.apply(t,nt),t.select.apply(t,tt)}else t.click({recid:f,column:a},n);else if(!n.shiftKey)for(h=0;h<i.length-1;h++)t.unselect(i[h]);s=!0;break;case 38:if(k.length<=0)break;if(c=ht(p),c!=null){if(t.records[c].expanded&&(y=$("#grid_"+t.name+"_rec_"+w2utils.escapeId(t.records[c].recid)+"_expanded_row").find(".w2ui-grid"),y.length>0&&w2ui[y.attr("name")])){t.selectNone(),o=y.attr("name"),d=w2ui[o].records,w2utils.keyboard.active(o),w2ui[o].click(d[d.length-1].recid),s=!0;break}if(n.shiftKey){if(g())return;if(t.selectType=="row")t.last.sel_ind>c&&t.last.sel_ind!=w?t.unselect(t.records[w].recid):t.select(t.records[c].recid);else if(t.last.sel_ind>c&&t.last.sel_ind!=w){c=w,u=[];for(v in r)u.push({recid:t.records[c].recid,column:r[v]});t.unselect.apply(t,u)}else{u=[];for(v in r)u.push({recid:t.records[c].recid,column:r[v]});t.select.apply(t,u)}}else t.selectNone(),t.click({recid:t.records[c].recid,column:r[0]},n);t.scrollIntoView(c),n.preventDefault&&n.preventDefault()}else{if(!n.shiftKey)for(h=1;h<i.length;h++)t.unselect(i[h]);if(l=$("#grid_"+t.name+"_rec_"+w2utils.escapeId(t.records[p].recid)).parents("tr"),l.length>0&&String(l.attr("id")).indexOf("expanded_row")!=-1){f=l.prev().attr("recid"),o=l.parents(".w2ui-grid").attr("name"),t.selectNone(),w2utils.keyboard.active(o),w2ui[o].click(f),s=!0;break}}break;case 40:if(k.length<=0)break;if(t.records[w].expanded&&(y=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(t.records[w].recid)+"_expanded_row").find(".w2ui-grid"),y.length>0&&w2ui[y.attr("name")])){t.selectNone(),o=y.attr("name"),d=w2ui[o].records,w2utils.keyboard.active(o),w2ui[o].click(d[0].recid),s=!0;break}if(a=st(w),a!=null){if(n.shiftKey){if(g())return;if(t.selectType=="row")this.last.sel_ind<a&&this.last.sel_ind!=p?t.unselect(t.records[p].recid):t.select(t.records[a].recid);else if(this.last.sel_ind<a&&this.last.sel_ind!=p){a=p,u=[];for(v in r)u.push({recid:t.records[a].recid,column:r[v]});t.unselect.apply(t,u)}else{u=[];for(v in r)u.push({recid:t.records[a].recid,column:r[v]});t.select.apply(t,u)}}else t.selectNone(),t.click({recid:t.records[a].recid,column:r[0]},n);t.scrollIntoView(a),s=!0}else{if(!n.shiftKey)for(h=0;h<i.length-1;h++)t.unselect(i[h]);if(l=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(t.records[w].recid)).parents("tr"),l.length>0&&String(l.attr("id")).indexOf("expanded_row")!=-1){f=l.next().attr("recid"),o=l.parents(".w2ui-grid").attr("name"),t.selectNone(),w2utils.keyboard.active(o),w2ui[o].click(f),s=!0;break}}break;case 86:(n.ctrlKey||n.metaKey)&&($("body").append('<textarea id="_tmp_copy_data" style="position: absolute; top: -100px; height: 1px;"></textarea>'),$("#_tmp_copy_data").focus(),setTimeout(function(){t.paste($("#_tmp_copy_data").val()),$("#_tmp_copy_data").remove()},50));break;case 88:(n.ctrlKey||n.metaKey)&&setTimeout(function(){t.delete(!0)},100);case 67:(n.ctrlKey||n.metaKey)&&(rt=t.copy(),$("body").append('<textarea id="_tmp_copy_data" style="position: absolute; top: -100px; height: 1px;">'+rt+"</textarea>"),$("#_tmp_copy_data").focus().select(),setTimeout(function(){$("#_tmp_copy_data").remove()},50))}for(u=[187,189],e=48;e<=90;e++)u.push(e);u.indexOf(n.keyCode)==-1||n.ctrlKey||n.metaKey||s||(r.length==0&&r.push(0),u=String.fromCharCode(n.keyCode),n.keyCode==187&&(u="="),n.keyCode==189&&(u="-"),n.shiftKey||(u=u.toLowerCase()),t.editField(f,r[0],u,n),s=!0),s&&n.preventDefault&&n.preventDefault(),t.trigger($.extend(it,{phase:"after"}))}}},scrollIntoView:function(n){var f,t,r,i,u;if(typeof n=="undefined"){if(f=this.getSelection(),f.length==0)return;n=this.get(f[0],!0)}(t=$("#grid_"+this.name+"_records"),t.length!=0)&&((r=this.last.searchIds.length,t.height()>this.recordHeight*(r>0?r:this.records.length))||(r>0&&(n=this.last.searchIds.indexOf(n)),i=Math.floor(t[0].scrollTop/this.recordHeight),u=i+Math.floor(t.height()/this.recordHeight),n==i&&t.animate({scrollTop:t.scrollTop()-t.height()/1.3}),n==u&&t.animate({scrollTop:t.scrollTop()+t.height()/1.3}),(n<i||n>u)&&t.animate({scrollTop:(n-1)*this.recordHeight})))},dblClick:function(n,t){var i,r,f,u;if(window.getSelection&&window.getSelection().removeAllRanges(),i=null,typeof n=="object"&&(i=n.column,n=n.recid),typeof t=="undefined"&&(t={}),i==null&&t.target&&(r=t.target,r.tagName!="TD"&&(r=$(r).parents("td")[0]),i=parseInt($(r).attr("col"))),f=this.trigger({phase:"before",target:this.name,type:"dblClick",recid:n,column:i,originalEvent:t}),f.isCancelled===!0)return!1;this.selectNone(),u=this.columns[i],u&&$.isPlainObject(u.editable)?this.editField(n,i,null,t):(this.select({recid:n,column:i}),this.last.selected=this.getSelection()),this.trigger($.extend(f,{phase:"after"}))},toggle:function(n){var t=this.get(n);return t.expanded===!0?this.collapse(n):this.expand(n)},expand:function(n){function u(){var r=$("#grid_"+i.name+"_rec_"+t+"_expanded"),u=$("#grid_"+i.name+"_rec_"+t+"_expanded_row .w2ui-expanded1 > div");r.height()<5||(r.css("opacity",1),u.show().css("opacity",1),$("#grid_"+i.name+"_cell_"+i.get(n,!0)+"_expand div").html("-"))}var e=this.get(n),i=this,t=w2utils.escapeId(n),o,f,r;return $("#grid_"+this.name+"_rec_"+t+"_expanded_row").length>0?!1:e.expanded=="none"?!1:(o=1+(this.show.selectColumn?1:0),f="",$("#grid_"+this.name+"_rec_"+t).after('<tr id="grid_'+this.name+"_rec_"+t+'_expanded_row" class="w2ui-expanded-row '+f+'">'+(this.show.lineNumbers?'<td class="w2ui-col-number"></td>':"")+'\t<td class="w2ui-grid-data w2ui-expanded1" colspan="'+o+'"><div style="display: none"></div></td>\t<td colspan="100" class="w2ui-expanded2">\t\t<div id="grid_'+this.name+"_rec_"+t+'_expanded" style="opacity: 0"></div>\t</td></tr>'),r=this.trigger({phase:"before",type:"expand",target:this.name,recid:n,box_id:"grid_"+this.name+"_rec_"+t+"_expanded",ready:u}),r.isCancelled===!0)?($("#grid_"+this.name+"_rec_"+t+"_expanded_row").remove(),!1):($("#grid_"+this.name+"_rec_"+t).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_rec_"+t+"_expanded_row").show(),$("#grid_"+this.name+"_cell_"+this.get(n,!0)+"_expand div").html('<div class="w2ui-spinner" style="width: 16px; height: 16px; margin: -2px 2px;"></div>'),e.expanded=!0,setTimeout(u,300),this.trigger($.extend(r,{phase:"after"})),this.resizeRecords(),!0)},collapse:function(n){var u=this.get(n),i=this,t=w2utils.escapeId(n),r;return $("#grid_"+this.name+"_rec_"+t+"_expanded_row").length==0?!1:(r=this.trigger({phase:"before",type:"collapse",target:this.name,recid:n,box_id:"grid_"+this.name+"_rec_"+t+"_expanded"}),r.isCancelled===!0)?!1:($("#grid_"+this.name+"_rec_"+t).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_rec_"+t+"_expanded").css("opacity",0),$("#grid_"+this.name+"_cell_"+this.get(n,!0)+"_expand div").html("+"),setTimeout(function(){$("#grid_"+i.name+"_rec_"+t+"_expanded").height("0px"),setTimeout(function(){$("#grid_"+i.name+"_rec_"+t+"_expanded_row").remove(),delete u.expanded,i.trigger($.extend(r,{phase:"after"})),i.resizeRecords()},300)},200),!0)},sort:function(n,t,i){var f=this.trigger({phase:"before",type:"sort",target:this.name,field:n,direction:t,multiField:i}),r,u,e;if(f.isCancelled===!0)return!1;if(typeof n!="undefined"){r=this.sortData.length;for(u in this.sortData)if(this.sortData[u].field==n){r=u;break}if(typeof t=="undefined"||t==null)if(typeof this.sortData[r]=="undefined")t="asc";else switch(String(this.sortData[r].direction)){case"asc":t="desc";break;case"desc":t="asc";break;default:t="asc"}this.multiSort===!1&&(this.sortData=[],r=0),i!=!0&&(this.sortData=[],r=0),typeof this.sortData[r]=="undefined"&&(this.sortData[r]={}),this.sortData[r].field=n,this.sortData[r].direction=t}else this.sortData=[];e=typeof this.url!="object"?this.url:this.url.get,e?(this.trigger($.extend(f,{phase:"after"})),this.last.xhr_offset=0,this.reload()):(this.localSort(),this.searchData.length>0&&this.localSearch(!0),this.trigger($.extend(f,{phase:"after"})),this.refresh())},copy:function(){var t=this.getSelection(),n,c,i,f,r,o,e;if(t.length==0)return"";if(n="",typeof t[0]=="object"){var s=t[0].column,h=t[0].column,u=[];for(i in t)t[i].column<s&&(s=t[i].column),t[i].column>h&&(h=t[i].column),u.indexOf(t[i].index)==-1&&u.push(t[i].index);u.sort();for(c in u){for(f=u[c],r=s;r<=h;r++)(o=this.columns[r],o.hidden!==!0)&&(n+=w2utils.stripTags(this.getCellHTML(f,r))+"\t");n=n.substr(0,n.length-1),n+="\n"}}else for(i in t){f=this.get(t[i],!0);for(r in this.columns)(o=this.columns[r],o.hidden!==!0)&&(n+=w2utils.stripTags(this.getCellHTML(f,r))+"\t");n=n.substr(0,n.length-1),n+="\n"}return(n=n.substr(0,n.length-1),e=this.trigger({phase:"before",type:"copy",target:this.name,text:n}),e.isCancelled===!0)?"":(n=e.text,this.trigger($.extend(e,{phase:"after"})),n)},paste:function(n){var e=this.getSelection(),o=this.get(e[0].recid,!0),u=e[0].column,i=this.trigger({phase:"before",type:"paste",target:this.name,text:n,index:o,column:u}),s,n,a,l,c,h;if(i.isCancelled!==!0){if(n=i.text,this.selectType=="row"||e.length==0){console.log("ERROR: You can paste only if grid.selectType = 'cell' and when at least one cell selected."),this.trigger($.extend(i,{phase:"after"}));return}s=[],n=n.split("\n");for(a in n){var v=n[a].split("\t"),r=0,t=this.records[o],f=[];for(l in v)this.columns[u+r]&&(c=this.columns[u+r].field,t.changed=!0,t.changes=t.changes||{},t.changes[c]=v[l],f.push(u+r),r++);for(h in f)s.push({recid:t.recid,column:f[h]});o++}this.selectNone(),this.select.apply(this,s),this.refresh(),this.trigger($.extend(i,{phase:"after"}))}},resize:function(){var t=this,i=+new Date,n;if(window.getSelection&&window.getSelection().removeAllRanges(),this.box&&$(this.box).attr("name")==this.name)return($(this.box).find("> div").css("width",$(this.box).width()).css("height",$(this.box).height()),n=this.trigger({phase:"before",type:"resize",target:this.name}),n.isCancelled===!0)?!1:(t.resizeBoxes(),t.resizeRecords(),this.trigger($.extend(n,{phase:"after"})),+new Date-i)},refresh:function(){var n=this,h=+new Date,c=typeof this.url!="object"?this.url:this.url.get,o,u,t,r,f,i,e,s;if(this.total<=0&&!c&&this.searchData.length==0&&(this.total=this.records.length,this.buffered=this.total),window.getSelection&&window.getSelection().removeAllRanges(),this.toolbar.disable("edit","delete"),this.box){if(o=this.trigger({phase:"before",target:this.name,type:"refresh"}),o.isCancelled===!0)return!1;this.show.header?$("#grid_"+this.name+"_header").html(this.header+"&nbsp;").show():$("#grid_"+this.name+"_header").hide(),this.show.toolbar?this.toolbar&&this.toolbar.get("column-on-off")&&this.toolbar.get("column-on-off").checked||($("#grid_"+this.name+"_toolbar").show(),typeof this.toolbar=="object"&&(this.toolbar.refresh(),t=$("#grid_"+n.name+"_search_all"),t.val(this.last.search))):$("#grid_"+this.name+"_toolbar").hide(),this.searchClose(),u=$("#grid_"+n.name+"_search_all"),this.searches.length==0&&(this.last.field="all"),!this.multiSearch&&this.last.field=="all"&&this.searches.length>0&&(this.last.field=this.searches[0].field,this.last.caption=this.searches[0].caption);for(i in this.searches)this.searches[i].field==this.last.field&&(this.last.caption=this.searches[i].caption);if(this.last.multi?u.attr("placeholder","["+w2utils.lang("Multiple Fields")+"]"):u.attr("placeholder",this.last.caption),this._focus_when_refreshed===!0&&(clearTimeout(n._focus_timer),n._focus_timer=setTimeout(function(){u.length>0&&u[0].focus(),delete n._focus_when_refreshed,delete n._focus_timer},600)),t=this.find({summary:!0},!0),t.length>0){for(r in t)this.summary.push(this.records[t[r]]);for(r=t.length-1;r>=0;r--)this.records.splice(t[r],1);this.total=this.total-t.length,this.buffered=this.buffered-t.length}if(f="",f+='<div id="grid_'+this.name+'_records" class="w2ui-grid-records"\tonscroll="var obj = w2ui[\''+this.name+"']; \t\tobj.last.scrollTop = this.scrollTop; \t\tobj.last.scrollLeft = this.scrollLeft; \t\t$('#grid_"+this.name+"_columns')[0].scrollLeft = this.scrollLeft;\t\t$('#grid_"+this.name+"_summary')[0].scrollLeft = this.scrollLeft;\t\tobj.scroll(event);\">"+this.getRecordsHTML()+'</div><div id="grid_'+this.name+'_columns" class="w2ui-grid-columns">\t<table>'+this.getColumnsHTML()+"</table></div>",$("#grid_"+this.name+"_body").html(f),this.summary.length>0?$("#grid_"+this.name+"_summary").html(this.getSummaryHTML()).show():$("#grid_"+this.name+"_summary").hide(),this.show.footer?$("#grid_"+this.name+"_footer").html(this.getFooterHTML()).show():$("#grid_"+this.name+"_footer").hide(),this.last.selected.length>0)for(i in this.last.selected)this.get(this.last.selected[i])!=null&&this.select(this.get(this.last.selected[i]).recid);this.searchData.length>0?$("#grid_"+this.name+"_searchClear").show():$("#grid_"+this.name+"_searchClear").hide(),$("#grid_"+this.name+"_check_all").prop("checked",!0),$("#grid_"+this.name+"_records").find(".grid_select_check[type=checkbox]").length!=0&&$("#grid_"+this.name+"_records").find(".grid_select_check[type=checkbox]").length==$("#grid_"+this.name+"_records").find(".grid_select_check[type=checkbox]:checked").length?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),e=n.find({expanded:!0},!0);for(s in e)n.records[e[s]].expanded=!1;return setTimeout(function(){var t=$.trim($("#grid_"+n.name+"_search_all").val());t!=""&&$(n.box).find(".w2ui-grid-data > div").w2marker(t)},50),this.trigger($.extend(o,{phase:"after"})),n.resize(),n.addRange("selection"),setTimeout(function(){n.resize(),n.scroll()},1),+new Date-h}},render:function(n){function e(n){if(!t.last.move||t.last.move.type!="expand"){t.last.move={x:n.screenX,y:n.screenY,divX:0,divY:0,recid:$(n.target).parents("tr").attr("recid"),column:n.target.tagName=="TD"?$(n.target).attr("col"):$(n.target).parents("td").attr("col"),type:"select",start:!0};$(document).on("mousemove",r);$(document).on("mouseup",u)}}function r(n){var i,y,o,v,u,s,r,e,f;if(t.last.move&&t.last.move.type=="select"&&(t.last.move.divX=n.screenX-t.last.move.x,t.last.move.divY=n.screenY-t.last.move.y,!(Math.abs(t.last.move.divX)<=1)||!(Math.abs(t.last.move.divY)<=1))&&(t.last.move.start&&t.last.move.recid&&(t.selectNone(),t.last.move.start=!1),i=[],y=n.target.tagName=="TR"?$(n.target).attr("recid"):$(n.target).parents("tr").attr("recid"),typeof y!="undefined")){var h=t.get(t.last.move.recid,!0),l=t.get(y,!0),a=parseInt(t.last.move.column),c=parseInt(n.target.tagName=="TD"?$(n.target).attr("col"):$(n.target).parents("td").attr("col"));if(h>l&&(u=h,h=l,l=u),u="ind1:"+h+",ind2;"+l+",col1:"+a+",col2:"+c,t.last.move.range!=u){for(t.last.move.range=u,o=h;o<=l;o++)if(!(t.last.searchIds.length>0)||t.last.searchIds.indexOf(o)!=-1)if(t.selectType!="row")for(a>c&&(u=a,a=c,c=u),u=[],v=a;v<=c;v++)t.columns[v].hidden||i.push({recid:t.records[o].recid,column:parseInt(v)});else i.push(t.records[o].recid);if(t.selectType!="row"){r=t.getSelection(),u=[];for(e in i){s=!1;for(f in r)i[e].recid==r[f].recid&&i[e].column==r[f].column&&(s=!0);s||u.push({recid:i[e].recid,column:i[e].column})}t.select.apply(t,u),u=[];for(f in r){s=!1;for(e in i)i[e].recid==r[f].recid&&i[e].column==r[f].column&&(s=!0);s||u.push({recid:r[f].recid,column:r[f].column})}t.unselect.apply(t,u)}else if(t.multiSelect){r=t.getSelection();for(e in i)r.indexOf(i[e])==-1&&t.select(i[e]);for(f in r)i.indexOf(r[f])==-1&&t.unselect(r[f])}}}}function u(){t.last.move&&t.last.move.type=="select"&&(delete t.last.move,$(document).off("mousemove",r),$(document).off("mouseup",u))}var t=this,f=+new Date,i;if(window.getSelection&&window.getSelection().removeAllRanges(),typeof n!="undefined"&&n!=null&&($(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),this.box=n),this.box){if(this.last.sortData==null&&(this.last.sortData=this.sortData),i=this.trigger({phase:"before",target:this.name,type:"render",box:n}),i.isCancelled===!0)return!1;$(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid").html('<div>\t<div id="grid_'+this.name+'_header" class="w2ui-grid-header"></div>\t<div id="grid_'+this.name+'_toolbar" class="w2ui-grid-toolbar"></div>\t<div id="grid_'+this.name+'_body" class="w2ui-grid-body"></div>\t<div id="grid_'+this.name+'_summary" class="w2ui-grid-body w2ui-grid-summary"></div>\t<div id="grid_'+this.name+'_footer" class="w2ui-grid-footer"></div></div>'),this.selectType!="row"&&$(this.box).addClass("w2ui-ss"),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),this.initToolbar(),this.toolbar!=null&&this.toolbar.render($("#grid_"+this.name+"_toolbar")[0]),$("#grid_"+this.name+"_footer").html(this.getFooterHTML()),this.refresh(),this.reload();$(this.box).on("mousedown",e);$(this.box).on("selectstart",function(){return!1});if(this.trigger($.extend(i,{phase:"after"})),$(".w2ui-layout").length==0){this.tmp_resize=function(){w2ui[t.name].resize()};$(window).off("resize",this.tmp_resize).on("resize",this.tmp_resize)}return+new Date-f}},destroy:function(){var n=this.trigger({phase:"before",target:this.name,type:"destroy"});if(n.isCancelled===!0)return!1;$(window).off("resize",this.tmp_resize),typeof this.toolbar=="object"&&this.toolbar.destroy&&this.toolbar.destroy(),$(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),delete w2ui[this.name],this.trigger($.extend(n,{phase:"after"}))},initColumnOnOff:function(){var i,n,t,r,u;if(this.show.toolbarColumns){i=this,n='<div class="w2ui-col-on-off"><table>';for(t in this.columns)r=this.columns[t],n+='<tr><td>\t<input id="grid_'+this.name+"_column_"+t+'_check" type="checkbox" tabIndex="-1" '+(r.hidden?"":"checked")+"\t\tonclick=\"w2ui['"+i.name+"'].columnOnOff(this, event, '"+r.field+'\');"></td><td>\t<label for="grid_'+this.name+"_column_"+t+'_check">'+(this.columns[t].caption==""?"- column "+(t+1)+" -":this.columns[t].caption)+"</label></td></tr>";n+='<tr><td colspan="2"><div style="border-top: 1px solid #ddd;"></div></td></tr>',u=typeof this.url!="object"?this.url:this.url.get,u&&(n+='<tr><td colspan="2" style="padding: 0px">\t<div style="cursor: pointer; padding: 2px 8px; cursor: default">\t\t'+w2utils.lang("Skip")+' <input type="text" style="width: 45px" value="'+this.offset+'" \t\t\t\tonchange="w2ui[\''+i.name+"'].columnOnOff(this, event, 'skip', this.value);\"> "+w2utils.lang("Records")+"\t</div></td></tr>"),n+='<tr><td colspan="2" onclick="w2ui[\''+i.name+"'].columnOnOff(this, event, 'line-numbers');\">\t<div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Toggle Line Numbers")+'</div></td></tr><tr><td colspan="2" onclick="w2ui[\''+i.name+"'].columnOnOff(this, event, 'resize');\">\t<div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Reset Column Size")+"</div></td></tr>",n+="</table></div>",this.toolbar.get("column-on-off").html=n}},columnOnOff:function(n,t,i,r){var h=this.trigger({phase:"before",target:this.name,type:"columnOnOff",checkbox:n,field:i,originalEvent:t}),o,s,e,u,f;if(h.isCancelled===!0)return!1;o=this;for(s in this.records)this.records[s].expanded===!0&&(this.records[s].expanded=!1);if(e=!0,i=="line-numbers")this.show.lineNumbers=!this.show.lineNumbers,this.refresh();else if(i=="skip")w2utils.isInt(r)||(r=0),o.skip(r);else if(i=="resize"){for(u in this.columns)typeof this.columns[u].sizeOriginal!="undefined"&&(this.columns[u].size=this.columns[u].sizeOriginal);this.initResize(),this.resize()}else f=this.getColumn(i),f.hidden?($(n).prop("checked",!0),this.showColumn(f.field)):($(n).prop("checked",!1),this.hideColumn(f.field)),e=!1;this.initColumnOnOff(),e&&setTimeout(function(){$().w2overlay(),o.toolbar.uncheck("column-on-off")},100),this.trigger($.extend(h,{phase:"after"}))},initToolbar:function(){var t,i,r,n;if(typeof this.toolbar.render=="undefined"){t=this.toolbar.items,this.toolbar.items=[],this.toolbar=$().w2toolbar($.extend(!0,{},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.show.toolbarReload&&this.toolbar.items.push($.extend(!0,{},this.buttons.reload)),this.show.toolbarColumns&&(this.toolbar.items.push($.extend(!0,{},this.buttons.columns)),this.initColumnOnOff()),(this.show.toolbarReload||this.show.toolbarColumn)&&this.toolbar.items.push({type:"break",id:"break0"}),this.show.toolbarSearch&&(i='<div class="w2ui-toolbar-search"><table cellpadding="0" cellspacing="0"><tr>\t<td>'+this.buttons.search.html+'</td>\t<td>\t\t<input id="grid_'+this.name+'_search_all" class="w2ui-search-all" \t\t\tplaceholder="'+this.last.caption+'" value="'+this.last.search+'"\t\t\tonkeyup="if (event.keyCode == 13) { \t\t\t\tw2ui[\''+this.name+"']._focus_when_refreshed = true; \t\t\t\tw2ui['"+this.name+"'].search(w2ui['"+this.name+'\'].last.field, this.value); \t\t\t}">\t</td>\t<td>\t\t<div title="'+w2utils.lang("Clear Search")+'" class="w2ui-search-clear" id="grid_'+this.name+'_searchClear"  \t\t\t onclick="var obj = w2ui[\''+this.name+"']; obj.searchReset();\" \t\t>&nbsp;&nbsp;</div>\t</td></tr></table></div>",this.toolbar.items.push({type:"html",id:"search",html:i}),this.multiSearch&&this.searches.length>0&&this.toolbar.items.push($.extend(!0,{},this.buttons["search-go"]))),this.show.toolbarSearch&&(this.show.toolbarAdd||this.show.toolbarEdit||this.show.toolbarDelete||this.show.toolbarSave)&&this.toolbar.items.push({type:"break",id:"break1"}),this.show.toolbarAdd&&this.toolbar.items.push($.extend(!0,{},this.buttons.add)),this.show.toolbarEdit&&this.toolbar.items.push($.extend(!0,{},this.buttons.edit)),this.show.toolbarDelete&&this.toolbar.items.push($.extend(!0,{},this.buttons["delete"])),this.show.toolbarSave&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",id:"break2"}),this.toolbar.items.push($.extend(!0,{},this.buttons.save)));for(r in t)this.toolbar.items.push(t[r]);n=this;this.toolbar.on("click",function(t){var i=n.trigger({phase:"before",type:"toolbar",target:t.target,originalEvent:t}),r,s,h,u,f,c,e,o;if(i.isCancelled===!0)return!1;r=t.target;switch(r){case"reload":if(s=n.trigger({phase:"before",type:"reload",target:n.name}),s.isCancelled===!0)return!1;h=typeof n.url!="object"?n.url:n.url.get,h?n.clear(!0):(n.last.scrollTop=0,n.last.scrollLeft=0,n.last.range_start=null,n.last.range_end=null),n.reload(),n.trigger($.extend(s,{phase:"after"}));break;case"column-on-off":for(u in n.columns)n.columns[u].hidden?$("#grid_"+n.name+"_column_"+u+"_check").prop("checked",!1):$("#grid_"+n.name+"_column_"+u+"_check").prop("checked",!0);n.initResize(),n.resize();break;case"search-advanced":if(f=this,c=this.get(r),c.checked)n.searchClose(),setTimeout(function(){f.uncheck(r)},1);else{n.searchOpen(),t.originalEvent.stopPropagation();function l(){f.uncheck(r),$(document).off("click","body",l)}$(document).on("click","body",l)}break;case"add":i=n.trigger({phase:"before",target:n.name,type:"add",recid:null}),n.trigger($.extend(i,{phase:"after"}));break;case"edit":e=n.getSelection(),o=null,e.length==1&&(o=e[0]),i=n.trigger({phase:"before",target:n.name,type:"edit",recid:o}),n.trigger($.extend(i,{phase:"after"}));break;case"delete":n.delete();break;case"save":n.save()}n.trigger($.extend(i,{phase:"after"}))})}return},initSearches:function(){var o=this,t,n,r,e,i,u,f;for(t in this.searches){n=this.searches[t],r=this.getSearchData(n.field);switch(String(n.type).toLowerCase()){case"alphaNumeric":case"text":$("#grid_"+this.name+"_operator_"+t).val("begins with");break;case"int":case"float":case"hex":case"money":case"date":$("#grid_"+this.name+"_field_"+t).w2field("clear").w2field(n.type),$("#grid_"+this.name+"_field2_"+t).w2field("clear").w2field(n.type);break;case"list":e='<option value="">--</option>';for(i in n.items)$.isPlainObject(n.items[i])?(u=n.items[i].id,f=n.items[i].text,typeof u=="undefined"&&typeof n.items[i].value!="undefined"&&(u=n.items[i].value),typeof f=="undefined"&&typeof n.items[i].caption!="undefined"&&(f=n.items[i].caption),u==null&&(u=""),e+='<option value="'+u+'">'+f+"</option>"):e+='<option value="'+n.items[i]+'">'+n.items[i]+"</option>";$("#grid_"+this.name+"_field_"+t).html(e)}r!=null&&($("#grid_"+this.name+"_operator_"+t).val(r.operator).trigger("change"),$.isArray(r.value)?r.operator=="in"?$("#grid_"+this.name+"_field_"+t).val(r.value).trigger("change"):($("#grid_"+this.name+"_field_"+t).val(r.value[0]).trigger("change"),$("#grid_"+this.name+"_field2_"+t).val(r.value[1]).trigger("change")):typeof r.value!="udefined"&&$("#grid_"+this.name+"_field_"+t).val(r.value).trigger("change"))}$("#w2ui-overlay .w2ui-grid-searches *[rel=search]").on("keypress",function(n){n.keyCode==13&&o.search()})},initResize:function(){var n=this;$(this.box).find(".w2ui-resizer").off("click").on("click",function(n){n.stopPropagation?n.stopPropagation():n.cancelBubble=!0,n.preventDefault&&n.preventDefault()}).off("mousedown").on("mousedown",function(t){var r,i,f,u;t||(t=window.event),window.addEventListener||window.document.attachEvent("onselectstart",function(){return!1}),n.resizing=!0,n.last.tmp={x:t.screenX,y:t.screenY,gx:t.screenX,gy:t.screenY,col:parseInt($(this).attr("name"))},t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault();for(r in n.columns)typeof n.columns[r].sizeOriginal=="undefined"&&(n.columns[r].sizeOriginal=n.columns[r].size),n.columns[r].size=n.columns[r].sizeCalculated;i={phase:"before",type:"columnResize",target:n.name,column:n.last.tmp.col,field:n.columns[n.last.tmp.col].field},i=n.trigger($.extend(i,{resizeBy:0,originalEvent:t})),f=function(t){if(n.resizing==!0){if(t||(t=window.event),i=n.trigger($.extend(i,{resizeBy:t.screenX-n.last.tmp.gx,originalEvent:t})),i.isCancelled===!0){i.isCancelled=!1;return}n.last.tmp.x=t.screenX-n.last.tmp.x,n.last.tmp.y=t.screenY-n.last.tmp.y,n.columns[n.last.tmp.col].size=parseInt(n.columns[n.last.tmp.col].size)+n.last.tmp.x+"px",n.resizeRecords(),n.last.tmp.x=t.screenX,n.last.tmp.y=t.screenY}},u=function(t){delete n.resizing,$(document).off("mousemove","body"),$(document).off("mouseup","body"),n.resizeRecords(),n.trigger($.extend(i,{phase:"after",originalEvent:t}))};$(document).on("mousemove","body",f);$(document).on("mouseup","body",u)}).each(function(n,t){var i=$(t).parent();$(t).css({height:"25px","margin-left":i.width()-3+"px"})})},resizeBoxes:function(){var o=$(this.box).find("> div"),n=$("#grid_"+this.name+"_header"),i=$("#grid_"+this.name+"_toolbar"),r=$("#grid_"+this.name+"_summary"),t=$("#grid_"+this.name+"_footer"),u=$("#grid_"+this.name+"_body"),e=$("#grid_"+this.name+"_columns"),f=$("#grid_"+this.name+"_records");this.show.header&&n.css({top:"0px",left:"0px",right:"0px"}),this.show.toolbar&&i.css({top:0+(this.show.header?w2utils.getSize(n,"height"):0)+"px",left:"0px",right:"0px"}),this.show.footer&&t.css({bottom:"0px",left:"0px",right:"0px"}),this.summary.length>0&&r.css({bottom:0+(this.show.footer?w2utils.getSize(t,"height"):0)+"px",left:"0px",right:"0px"}),u.css({top:0+(this.show.header?w2utils.getSize(n,"height"):0)+(this.show.toolbar?w2utils.getSize(i,"height"):0)+"px",bottom:0+(this.show.footer?w2utils.getSize(t,"height"):0)+(this.summary.length>0?w2utils.getSize(r,"height"):0)+"px",left:"0px",right:"0px"})},resizeRecords:function(){var i=this,rt,c,h,d,y,e,s,b,u,t,n;$(this.box).find(".w2ui-empty-record").remove();var g=$(this.box),v=$(this.box).find("> div"),nt=$("#grid_"+this.name+"_header"),tt=$("#grid_"+this.name+"_toolbar"),a=$("#grid_"+this.name+"_summary"),it=$("#grid_"+this.name+"_footer"),l=$("#grid_"+this.name+"_body"),r=$("#grid_"+this.name+"_columns"),f=$("#grid_"+this.name+"_records");if(this.fixedBody?(rt=v.height()-(this.show.header?w2utils.getSize(nt,"height"):0)-(this.show.toolbar?w2utils.getSize(tt,"height"):0)-(a.css("display")!="none"?w2utils.getSize(a,"height"):0)-(this.show.footer?w2utils.getSize(it,"height"):0),l.css("height",rt)):setTimeout(function(){var n=w2utils.getSize(r,"height")+w2utils.getSize($("#grid_"+i.name+"_records table"),"height");i.height=n+w2utils.getSize(v,"+height")+(i.show.header?w2utils.getSize(nt,"height"):0)+(i.show.toolbar?w2utils.getSize(tt,"height"):0)+(a.css("display")!="none"?w2utils.getSize(a,"height"):0)+(i.show.footer?w2utils.getSize(it,"height"):0),v.css("height",i.height),l.css("height",n),g.css("height",w2utils.getSize(v,"height")+w2utils.getSize(g,"+height"))},1),c=!1,h=!1,l.width()<$(f).find(">table").width()&&(c=!0),l.height()-r.height()<$(f).find(">table").height()+(c?w2utils.scrollBarSize():0)&&(h=!0),this.fixedBody||(h=!1,c=!1),c||h?(r.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show(),f.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(r,"height")+"px","-webkit-overflow-scrolling":"touch","overflow-x":c?"auto":"hidden","overflow-y":h?"auto":"hidden"})):(r.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").hide(),f.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(r,"height")+"px",overflow:"hidden"}),f.length>0&&(this.last.scrollTop=0,this.last.scrollLeft=0)),this.show.emptyRecords&&!h&&(d=Math.floor(f.height()/this.recordHeight)+1,this.fixedBody))for(y=this.buffered;y<=d;y++){for(e="",e+='<tr class="'+(y%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style="height: '+this.recordHeight+'px">',this.show.lineNumbers&&(e+='<td class="w2ui-col-number"></td>'),this.show.selectColumn&&(e+='<td class="w2ui-grid-data w2ui-col-select"></td>'),this.show.expandColumn&&(e+='<td class="w2ui-grid-data w2ui-col-expand"></td>'),s=0;!0&&this.columns.length>0;){if(n=this.columns[s],n.hidden)if(s++,typeof this.columns[s]=="undefined")break;else continue;if(e+='<td class="w2ui-grid-data" '+(typeof n.attr!="undefined"?n.attr:"")+' col="'+s+'"></td>',s++,typeof this.columns[s]=="undefined")break}e+='<td class="w2ui-grid-data-last"></td>',e+="</tr>",$("#grid_"+this.name+"_records > table").append(e)}if(l.length>0){var p=parseInt(l.width())-(h?w2utils.scrollBarSize():0)-(this.show.lineNumbers?34:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0),k=p,o=0,w=!1;for(t=0;t<this.columns.length;t++)n=this.columns[t],typeof n.gridMinWidth!="undefined"&&(n.gridMinWidth>k&&n.hidden!==!0&&(n.hidden=!0,w=!0),n.gridMinWidth<k&&n.hidden===!0&&(n.hidden=!1,w=!0));if(w===!0){this.refresh();return}for(t=0;t<this.columns.length;t++)(n=this.columns[t],n.hidden)||(String(n.size).substr(String(n.size).length-2).toLowerCase()=="px"?(p-=parseFloat(n.size),this.columns[t].sizeCalculated=n.size,this.columns[t].sizeType="px"):(o+=parseFloat(n.size),this.columns[t].sizeType="%",delete n.sizeCorrected));if(o!=100&&o>0)for(t=0;t<this.columns.length;t++)(n=this.columns[t],n.hidden)||n.sizeType=="%"&&(n.sizeCorrected=Math.round(parseFloat(n.size)*1e4/o)/100+"%");for(t=0;t<this.columns.length;t++)(n=this.columns[t],n.hidden)||n.sizeType=="%"&&(this.columns[t].sizeCalculated=typeof this.columns[t].sizeCorrected!="undefined"?Math.floor(p*parseFloat(n.sizeCorrected)/100)-1+"px":Math.floor(p*parseFloat(n.size)/100)-1+"px")}for(b=0,t=0;t<this.columns.length;t++)(n=this.columns[t],n.hidden)||(typeof n.min=="undefined"&&(n.min=20),parseInt(n.sizeCalculated)<parseInt(n.min)&&(n.sizeCalculated=n.min+"px"),parseInt(n.sizeCalculated)>parseInt(n.max)&&(n.sizeCalculated=n.max+"px"),b+=parseInt(n.sizeCalculated));if(u=parseInt(k)-parseInt(b),u>0&&o>0)for(t=0;;){if(n=this.columns[t],typeof n=="undefined"){t=0;continue}if(n.hidden||n.sizeType=="px"){t++;continue}if(n.sizeCalculated=parseInt(n.sizeCalculated)+1+"px",u--,u==0)break;t++}else u>0&&r.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show();r.find("> table > tbody > tr:nth-child(1) td").each(function(n,t){var r=$(t).attr("col");typeof r!="undefined"&&i.columns[r]&&$(t).css("width",i.columns[r].sizeCalculated),$(t).hasClass("w2ui-head-last")&&$(t).css("width",w2utils.scrollBarSize()+(u>0&&o==0?u:0)+"px")}),r.find("> table > tbody > tr").length==3&&r.find("> table > tbody > tr:nth-child(1) td").html("").css({height:"0px",border:"0px",padding:"0px",margin:"0px"}),f.find("> table > tbody > tr:nth-child(1) td").each(function(n,t){var r=$(t).attr("col");typeof r!="undefined"&&i.columns[r]&&$(t).css("width",i.columns[r].sizeCalculated),$(t).hasClass("w2ui-grid-data-last")&&$(t).css("width",(u>0&&o==0?u:0)+"px")}),a.find("> table > tbody > tr:nth-child(1) td").each(function(n,t){var r=$(t).attr("col");typeof r!="undefined"&&i.columns[r]&&$(t).css("width",i.columns[r].sizeCalculated),$(t).hasClass("w2ui-grid-data-last")&&$(t).css("width",w2utils.scrollBarSize()+(u>0&&o==0?u:0)+"px")}),this.initResize(),this.refreshRanges(),this.last.scrollTop!=""&&f.length>0&&(r.prop("scrollLeft",this.last.scrollLeft),f.prop("scrollTop",this.last.scrollTop),f.prop("scrollLeft",this.last.scrollLeft))},getSearchesHTML:function(){for(var i='<table cellspacing="0">',f=!1,n,u,r,t=0;t<this.searches.length;t++)if(n=this.searches[t],!n.hidden){u="",f==!1&&(u='<input type="button" value="X" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.searchClose(); }\">",f=!0),typeof n.inTag=="undefined"&&(n.inTag=""),typeof n.outTag=="undefined"&&(n.outTag=""),typeof n.type=="undefined"&&(n.type="text"),n.type=="text"&&(r='<select id="grid_'+this.name+"_operator_"+t+'">\t<option value="is">'+w2utils.lang("is")+'</option>\t<option value="begins with">'+w2utils.lang("begins with")+'</option>\t<option value="contains">'+w2utils.lang("contains")+'</option>\t<option value="ends with">'+w2utils.lang("ends with")+"</option></select>"),(n.type=="int"||n.type=="float"||n.type=="date")&&(r='<select id="grid_'+this.name+"_operator_"+t+'" \tonchange="var range = $(\'#grid_'+this.name+"_range_"+t+"'); range.hide(); \t\t\t  var fld  = $('#grid_"+this.name+"_field_"+t+"'); \t\t\t  var fld2 = fld.parent().find('span input'); \t\t\t  if ($(this).val() == 'in') fld.w2field('clear'); else fld.w2field('clear').w2field('"+n.type+"');\t\t\t  if ($(this).val() == 'between') { range.show(); fld2.w2field('clear').w2field('"+n.type+"'); }\t\t\t  var obj = w2ui['"+this.name+"'];\t\t\t  fld.on('keypress', function (evnt) { if (evnt.keyCode == 13) obj.search(); }); \t\t\t  fld2.on('keypress', function (evnt) { if (evnt.keyCode == 13) obj.search(); }); \t\t\t\">\t<option value=\"is\">"+w2utils.lang("is")+"</option>"+(n.type=="date"?"":'<option value="in">'+w2utils.lang("in")+"</option>")+'\t<option value="between">'+w2utils.lang("between")+"</option></select>"),n.type=="list"&&(r='is <input type="hidden" value="is" id="grid_'+this.name+"_operator_"+t+'">'),i+='<tr>\t<td class="close-btn">'+u+'</td>\t<td class="caption">'+n.caption+'</td>\t<td class="operator">'+r+'</td>\t<td class="value">';switch(n.type){case"alphaNumeric":case"text":i+='<input rel="search" type="text" size="40" id="grid_'+this.name+"_field_"+t+'" name="'+n.field+'" '+n.inTag+">";break;case"int":case"float":case"hex":case"money":case"date":i+='<input rel="search" type="text" size="12" id="grid_'+this.name+"_field_"+t+'" name="'+n.field+'" '+n.inTag+'><span id="grid_'+this.name+"_range_"+t+'" style="display: none">&nbsp;-&nbsp;&nbsp;<input rel="search" type="text" size="12" id="grid_'+this.name+"_field2_"+t+'" name="'+n.field+'" '+n.inTag+"></span>";break;case"list":i+='<select rel="search" id="grid_'+this.name+"_field_"+t+'" name="'+n.field+'" '+n.inTag+"></select>"}i+=n.outTag+"\t</td></tr>"}return i+='<tr>\t<td colspan="4" class="actions">\t\t<div>\t\t<input type="button" onclick="obj = w2ui[\''+this.name+'\']; if (obj) { obj.searchReset(); }" value="'+w2utils.lang("Reset")+'">\t\t<input type="button" onclick="obj = w2ui[\''+this.name+'\']; if (obj) { obj.search(); }" value="'+w2utils.lang("Search")+'">\t\t</div>\t</td></tr></table>'},getColumnsHTML:function(){function r(){var i="<tr>",u,f,t,r,e,o,s;for(n.columnGroups[n.columnGroups.length-1].caption!=""&&n.columnGroups.push({caption:""}),n.show.lineNumbers&&(i+='<td class="w2ui-head w2ui-col-number">\t<div>&nbsp;</div></td>'),n.show.selectColumn&&(i+='<td class="w2ui-head w2ui-col-select">\t<div>&nbsp;</div></td>'),n.show.expandColumn&&(i+='<td class="w2ui-head w2ui-col-expand">\t<div>&nbsp;</div></td>'),u=0,f=0;f<n.columnGroups.length;f++){if(t=n.columnGroups[f],r=n.columns[u],(typeof t.span=="undefined"||t.span!=parseInt(t.span))&&(t.span=1),typeof t.colspan!="undefined"&&(t.span=t.colspan),t.master===!0){e="";for(o in n.sortData)n.sortData[o].field==r.field&&(n.sortData[o].direction=="asc"&&(e="w2ui-sort-down"),n.sortData[o].direction=="desc"&&(e="w2ui-sort-up"));s="",r.resizable==!0&&(s='<div class="w2ui-resizer" name="'+u+'"></div>'),i+='<td class="w2ui-head '+e+'" col="'+u+'" rowspan="2" colspan="'+(t.span+(f==n.columnGroups.length-1?1:0))+'" '+(r.sortable?"onclick=\"w2ui['"+n.name+"'].columnClick('"+r.field+"', event);\"":"")+">"+s+'\t<div class="w2ui-col-group '+e+'">'+(r.caption==""?"&nbsp;":r.caption)+"\t</div></td>"}else i+='<td class="w2ui-head" col="'+u+'" \t\tcolspan="'+(t.span+(f==n.columnGroups.length-1?1:0))+'">\t<div class="w2ui-col-group">'+(t.caption==""?"&nbsp;":t.caption)+"\t</div></td>";u+=t.span}return i+="</tr>"}function t(t){var u="<tr>",f,s,r,i,c,e,o,h;for(n.show.lineNumbers&&(u+='<td class="w2ui-head w2ui-col-number" onclick="w2ui[\''+n.name+"'].columnClick('line-number', event);\">\t<div>#</div></td>"),n.show.selectColumn&&(u+='<td class="w2ui-head w2ui-col-select" \t\tonclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">\t<div>\t\t<input type="checkbox" id="grid_'+n.name+'_check_all" tabIndex="-1"\t\t\tstyle="'+(n.multiSelect==!1?"display: none;":"")+'"\t\t\tonclick="if (this.checked) w2ui[\''+n.name+"'].selectAll(); \t\t\t\t\t else w2ui['"+n.name+"'].selectNone(); \t\t\t\t\t if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">\t</div></td>"),n.show.expandColumn&&(u+='<td class="w2ui-head w2ui-col-expand">\t<div>&nbsp;</div></td>'),f=0,s=0,r=0;r<n.columns.length;r++)if(i=n.columns[r],c={},r==s&&(s=s+(typeof n.columnGroups[f]!="undefined"?parseInt(n.columnGroups[f].span):0),f++),typeof n.columnGroups[f-1]!="undefined"&&(c=n.columnGroups[f-1]),!i.hidden){e="";for(o in n.sortData)n.sortData[o].field==i.field&&(n.sortData[o].direction=="asc"&&(e="w2ui-sort-down"),n.sortData[o].direction=="desc"&&(e="w2ui-sort-up"));(c.master!==!0||t)&&(h="",i.resizable==!0&&(h='<div class="w2ui-resizer" name="'+r+'"></div>'),u+='<td col="'+r+'" class="w2ui-head '+e+'" '+(i.sortable?"onclick=\"w2ui['"+n.name+"'].columnClick('"+i.field+"', event);\"":"")+">"+h+'\t<div class="'+e+'">'+(i.caption==""?"&nbsp;":i.caption)+"\t</div></td>")}return u+='<td class="w2ui-head w2ui-head-last"><div>&nbsp;</div></td>',u+="</tr>"}var n=this,i="";return this.show.columnHeaders&&(i=this.columnGroups.length>0?t(!0)+r()+t(!1):t(!0)),i},getRecordsHTML:function(){var r,i,n,t;for(this.show_extra=this.buffered>300?30:300,r=$("#grid_"+this.name+"_records"),i=Math.floor(r.height()/this.recordHeight)+this.show_extra+1,this.fixedBody||(i=this.buffered),n="<table>"+this.getRecordHTML(-1,0),n+='<tr id="grid_'+this.name+'_rec_top" line="top" style="height: 0px">\t<td colspan="200"></td></tr>',t=0;t<i;t++)n+=this.getRecordHTML(t,t+1);return n+='<tr id="grid_'+this.name+'_rec_bottom" line="bottom" style="height: '+(this.buffered-i)*this.recordHeight+'px">\t<td colspan="200"></td></tr><tr id="grid_'+this.name+'_rec_more" style="display: none">\t<td colspan="200" class="w2ui-load-more"></td></tr></table>',this.last.range_start=0,this.last.range_end=i,n},getSummaryHTML:function(){var t,n;if(this.summary.length!=0){for(t="<table>",n=0;n<this.summary.length;n++)t+=this.getRecordHTML(n,n+1,!0);return t+="</table>"}},scroll:function(){function d(){i.markSearchResults!==!1&&(clearTimeout(i.last.marker_timer),i.last.marker_timer=setTimeout(function(){var n=[],r,t;for(r in i.searchData)t=i.searchData[r],$.inArray(t.value,n)==-1&&n.push(t.value);n.length>0&&$(i.box).find(".w2ui-grid-data > div").w2marker(n)},50))}var nt=+new Date,i=this,t=$("#grid_"+this.name+"_records"),l,v,p,f,e,h,s,y,k,u,o,r,g,a,b,w,c;if(this.records.length!=0&&t.length!=0&&t.height()!=0){if(this.show_extra=this.buffered>300?30:300,t.height()<this.buffered*this.recordHeight&&t.css("overflow-y")=="hidden"){this.total>0&&this.refresh();return}if(l=Math.floor(t[0].scrollTop/this.recordHeight+1),v=Math.floor(t[0].scrollTop/this.recordHeight+1)+Math.round(t.height()/this.recordHeight),l>this.buffered&&(l=this.buffered),v>this.buffered&&(v=this.buffered),p=typeof this.url!="object"?this.url:this.url.get,$("#grid_"+this.name+"_footer .w2ui-footer-right").html(w2utils.formatNumber(this.offset+l)+"-"+w2utils.formatNumber(this.offset+v)+" "+w2utils.lang("of")+" "+w2utils.formatNumber(this.total)+(p?" ("+w2utils.lang("buffered")+" "+w2utils.formatNumber(this.buffered)+(this.offset>0?", skip "+w2utils.formatNumber(this.offset):"")+")":"")),p||this.fixedBody&&!(this.total<=300)){if(f=Math.floor(t[0].scrollTop/this.recordHeight)-this.show_extra,e=f+Math.floor(t.height()/this.recordHeight)+this.show_extra*2+1,f<1&&(f=1),e>this.total&&(e=this.total),h=t.find("#grid_"+this.name+"_rec_top"),s=t.find("#grid_"+this.name+"_rec_bottom"),String(h.next().prop("id")).indexOf("_expanded_row")!=-1&&h.next().remove(),String(s.prev().prop("id")).indexOf("_expanded_row")!=-1&&s.prev().remove(),y=parseInt(h.next().attr("line")),k=parseInt(s.prev().attr("line")),y<f||y==1||this.last.pull_refresh){if(e<=k+this.show_extra-2&&e!=this.total)return;for(this.last.pull_refresh=!1;;){if(u=t.find("#grid_"+this.name+"_rec_top").next(),u.attr("line")=="bottom")break;if(parseInt(u.attr("line"))<f)u.remove();else break}for(u=t.find("#grid_"+this.name+"_rec_bottom").prev(),o=u.attr("line"),o=="top"&&(o=f),r=parseInt(o)+1;r<=e;r++)this.records[r-1]&&(this.records[r-1].expanded===!0&&(this.records[r-1].expanded=!1),s.before(this.getRecordHTML(r-1,r)));d(),setTimeout(function(){i.refreshRanges()},0)}else{if(f>=y-this.show_extra+2&&f>1)return;for(;;){if(u=t.find("#grid_"+this.name+"_rec_bottom").prev(),u.attr("line")=="top")break;if(parseInt(u.attr("line"))>e)u.remove();else break}for(u=t.find("#grid_"+this.name+"_rec_top").next(),o=u.attr("line"),o=="bottom"&&(o=e),r=parseInt(o)-1;r>=f;r--)this.records[r-1]&&(this.records[r-1].expanded===!0&&(this.records[r-1].expanded=!1),h.after(this.getRecordHTML(r-1,r)));d(),setTimeout(function(){i.refreshRanges()},0)}if(g=(f-1)*i.recordHeight,a=(this.buffered-e)*i.recordHeight,a<0&&(a=0),h.css("height",g+"px"),s.css("height",a+"px"),i.last.range_start=f,i.last.range_end=e,b=Math.floor(t[0].scrollTop/this.recordHeight),w=b+Math.floor(t.height()/this.recordHeight),w+10>this.buffered&&this.last.pull_more!==!0&&this.buffered<this.total-this.offset)if(this.autoLoad===!0)this.last.pull_more=!0,this.last.xhr_offset+=this.limit,this.request("get-records");else{if(c=$("#grid_"+this.name+"_rec_more"),c.css("display")=="none")c.show().on("click",function(){$(this).find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>'),i.last.pull_more=!0,i.last.xhr_offset+=i.limit,i.request("get-records")});c.find("td").text().indexOf("Load")==-1&&c.find("td").html("<div>Load "+i.limit+" More...</div>")}this.buffered>=this.total-this.offset&&$("#grid_"+this.name+"_rec_more").hide();return}}},getRecordHTML:function(n,t,i){var r="",c,a,v,o,e,u,f,s,l;if(n==-1){r+='<tr line="0">',this.show.lineNumbers&&(r+='<td class="w2ui-col-number" style="height: 0px;"></td>'),this.show.selectColumn&&(r+='<td class="w2ui-col-select" style="height: 0px;"></td>'),this.show.expandColumn&&(r+='<td class="w2ui-col-expand" style="height: 0px;"></td>');for(c in this.columns)this.columns[c].hidden||(r+='<td class="w2ui-grid-data" col="'+c+'" style="height: 0px;"></td>');return r+='<td class="w2ui-grid-data-last" style="height: 0px;"></td>',r+="</tr>"}if(a=typeof this.url!="object"?this.url:this.url.get,i!==!0)if(this.searchData.length>0&&!a){if(n>=this.last.searchIds.length)return"";n=this.last.searchIds[n],record=this.records[n]}else{if(n>=this.records.length)return"";record=this.records[n]}else{if(n>=this.summary.length)return"";record=this.summary[n]}if(!record)return"";for(v=w2utils.escapeId(record.recid),o=!1,record.selected&&this.selectType=="row"&&(o=!0),r+='<tr id="grid_'+this.name+"_rec_"+record.recid+'" recid="'+record.recid+'" line="'+t+'"  class="'+(t%2==0?"w2ui-even":"w2ui-odd")+(o?" w2ui-selected":"")+(record.expanded===!0?" w2ui-expanded":"")+'" '+(i!==!0?this.isIOS?"\tonclick  = \"w2ui['"+this.name+"'].dblClick('"+record.recid+"', event);\"":"\tonclick\t = \"w2ui['"+this.name+"'].click('"+record.recid+"', event);\"":"")+' style="height: '+this.recordHeight+"px; "+(!o&&record.style?record.style:"")+'" '+(record.style?'custom_style="'+record.style+'"':"")+">",this.show.lineNumbers&&(r+='<td id="grid_'+this.name+"_cell_"+n+'_number" class="w2ui-col-number">'+(i!==!0?"<div>"+t+"</div>":"")+"</td>"),this.show.selectColumn&&(r+='<td id="grid_'+this.name+"_cell_"+n+'_select" class="w2ui-grid-data w2ui-col-select" \t\tonclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">'+(i!==!0?'\t<div>\t\t<input id="grid_'+this.name+"_cell_"+n+'_select_check" class="grid_select_check" type="checkbox" tabIndex="-1"\t\t\t'+(record.selected?'checked="checked"':"")+"\t\t\tonclick=\"var obj = w2ui['"+this.name+"']; \t\t\t\tif (!obj.multiSelect) { obj.selectNone(); }\t\t\t\tif (this.checked) obj.select('"+record.recid+"'); else obj.unselect('"+record.recid+"'); \t\t\t\tif (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">\t</div>":"")+"</td>"),this.show.expandColumn&&(e="",e=record.expanded===!0?"-":"+",record.expanded=="none"&&(e=""),record.expanded=="spinner"&&(e='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),r+='<td id="grid_'+this.name+"_cell_"+n+'_expand" class="w2ui-grid-data w2ui-col-expand">'+(i!==!0?'\t<div ondblclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;" \t\t\tonclick="w2ui[\''+this.name+"'].toggle('"+record.recid+"', event); \t\t\t\tif (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">\t\t"+e+" </div>":"")+"</td>"),u=0;;){if(f=this.columns[u],f.hidden)if(u++,typeof this.columns[u]=="undefined")break;else continue;var y=record.changed&&record.changes[f.field],p=this.getCellHTML(n,u,i),h="";if(typeof f.render=="string"&&(s=f.render.toLowerCase().split(":"),$.inArray(s[0],["number","int","float","money","percent"])!=-1&&(h="text-align: right"),$.inArray(s[0],["date"])!=-1&&(h="text-align: right")),l=!1,record.selected&&$.inArray(u,record.selectedColumns)!=-1&&(l=!0),r+='<td class="w2ui-grid-data'+(l?" w2ui-selected":"")+(y?" w2ui-changed":"")+'" col="'+u+'" \tstyle="'+h+";"+(typeof f.style!="undefined"?f.style:"")+'" '+(typeof f.attr!="undefined"?f.attr:"")+">"+p+"</td>",u++,typeof this.columns[u]=="undefined")break}return r+='<td class="w2ui-grid-data-last"></td>',r+="</tr>"},getCellHTML:function(n,t,i){var f=this.columns[t],e=i!==!0?this.records[n]:this.summary[n],r=this.parseField(e,f.field),c=e.changed&&typeof e.changes[f.field]!="undefined",s;if(c&&(r=e.changes[f.field]),(r==null||typeof r=="undefined")&&(r=""),typeof f.render!="undefined"){if(typeof f.render=="function"&&(r=f.render.call(this,e,n,t),r.length>=4&&r.substr(0,4)!="<div"&&(r="<div>"+r+"</div>")),typeof f.render=="object"&&(r="<div>"+f.render[r]+"</div>"),typeof f.render=="string"){var u=f.render.toLowerCase().split(":"),h="",o="";$.inArray(u[0],["number","int","float","money","percent"])!=-1&&(typeof u[1]!="undefined"&&w2utils.isInt(u[1])||(u[1]=0),u[1]>20&&(u[1]=20),u[1]<0&&(u[1]=0),u[0]=="money"&&(u[1]=2,h=w2utils.settings.currencySymbol),u[0]=="percent"&&(o="%",u[1]!=="0"&&(u[1]=1)),u[0]=="int"&&(u[1]=0),r="<div>"+h+w2utils.formatNumber(Number(r).toFixed(u[1]))+o+"</div>"),u[0]=="date"&&((typeof u[1]=="undefined"||u[1]=="")&&(u[1]=w2utils.settings.date_display),r="<div>"+h+w2utils.formatDate(r,u[1])+o+"</div>"),u[0]=="age"&&(r="<div>"+h+w2utils.age(r)+o+"</div>")}}else this.show.recordTitles?(s=String(r).replace(/"/g,"''"),typeof f.title!="undefined"&&(typeof f.title=="function"&&(s=f.title.call(this,e,n,t)),typeof f.title=="string"&&(s=f.title)),r='<div title="'+s+'">'+r+"</div>"):r="<div>"+r+"</div>";return(r==null||typeof r=="undefined")&&(r=""),r},getFooterHTML:function(){return'<div>\t<div class="w2ui-footer-left"></div>\t<div class="w2ui-footer-right">'+this.buffered+'</div>\t<div class="w2ui-footer-center"></div></div>'},status:function(n){var r,t,i;typeof n!="undefined"?$("#grid_"+this.name+"_footer").find(".w2ui-footer-left").html(n):(r="",t=this.getSelection(),t.length>0&&(r=String(t.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" "+w2utils.lang("selected"),i=t[0],typeof i=="object"&&(i=i.recid+", "+w2utils.lang("Column")+": "+i.column),t.length==1&&(r=w2utils.lang("Record ID")+": "+i+" ")),$("#grid_"+this.name+"_footer .w2ui-footer-left").html(r),t.length==1?this.toolbar.enable("edit"):this.toolbar.disable("edit"),t.length>=1?this.toolbar.enable("delete"):this.toolbar.disable("delete"))},lock:function(n,t){var i=$(this.box).find("> div:first-child");setTimeout(function(){w2utils.lock(i,n,t)},10)},unlock:function(){var n=this.box;setTimeout(function(){w2utils.unlock(n)},25)},parseField:function(n,t){var i="",r,u;try{i=n,r=String(t).split(".");for(u in r)i=i[r[u]]}catch(f){i=""}return i}},$.extend(w2grid.prototype,w2utils.event),w2obj.grid=w2grid}(jQuery),function(n){var t=function(t){this.box=null,this.name=null,this.panels=[],this.tmp={},this.padding=1,this.resizer=4,this.style="",this.onShow=null,this.onHide=null,this.onResizing=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,n.extend(!0,this,w2obj.layout,t)};n.fn.w2layout=function(i){function s(t,i,r){var u=t.get(i);return(u!=null&&typeof r=="undefined"&&(r=u.tabs),u==null||r==null)?!1:(n.isArray(r)&&(r={tabs:r}),n().w2destroy(t.name+"_"+i+"_tabs"),u.tabs=n().w2tabs(n.extend({},r,{owner:t,name:t.name+"_"+i+"_tabs"})),u.show.tabs=!0,!0)}function o(t,i,r){var u=t.get(i);return(u!=null&&typeof r=="undefined"&&(r=u.toolbar),u==null||r==null)?!1:(n.isArray(r)&&(r={items:r}),n().w2destroy(t.name+"_"+i+"_toolbar"),u.toolbar=n().w2toolbar(n.extend({},r,{owner:t,name:t.name+"_"+i+"_toolbar"})),u.show.toolbar=!0,!0)}var f,r,u,e;if(typeof i!="object"&&i){if(w2ui[n(this).attr("name")])return e=w2ui[n(this).attr("name")],e[i].apply(e,Array.prototype.slice.call(arguments,1)),this;console.log("ERROR: Method "+i+" does not exist on jQuery.w2layout")}else{if(!i||typeof i.name=="undefined"){console.log('ERROR: The parameter "name" is required but not supplied in $().w2layout().');return}if(typeof w2ui[i.name]!="undefined"){console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+i.name+").");return}if(!w2utils.isAlphaNumeric(i.name)){console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). ');return}f=i.panels,r=new t(i),n.extend(r,{handlers:[],panels:[]});for(u in f)r.panels[u]=n.extend(!0,{},t.prototype.panel,f[u]),(n.isPlainObject(r.panels[u].tabs)||n.isArray(r.panels[u].tabs))&&s(r,f[u].type),(n.isPlainObject(r.panels[u].toolbar)||n.isArray(r.panels[u].toolbar))&&o(r,f[u].type);for(u in{top:"",left:"",main:"",preview:"",right:"",bottom:""})r.get(u)==null&&(r.panels[u]=n.extend(!0,{},t.prototype.panel,{type:u,hidden:!0,size:50}));return n(this).length>0&&r.render(n(this)[0]),w2ui[r.name]=r,r}},t.prototype={panel:{type:null,size:100,minSize:20,hidden:!1,resizable:!1,overflow:"auto",style:"",content:"",tabs:null,toolbar:null,width:null,height:null,show:{toolbar:!1,tabs:!1},onRefresh:null,onShow:null,onHide:null},html:function(n,t,i){return this.content(n,t,i)},content:function(t,i,r){var s=this,u=this.get(t),o,h,c,e,f;return t=="css"?(n("#layout_"+s.name+"_panel_css").html("<style>"+i+"</style>"),!0):u==null?!1:n("#layout_"+this.name+"_panel2_"+u.type).length>0?!1:(n("#layout_"+this.name+"_panel_"+u.type).scrollTop(0),i==null||typeof i=="undefined")?u.content:i instanceof jQuery?(console.log("ERROR: You can not pass jQuery object to w2layout.content() method"),!1):(o=n("#layout_"+this.name+"_panel_"+t+" > .w2ui-panel-content"),h=n(o).position().top,o.attr("class","w2ui-panel-content"),o.length>0&&typeof u.style!="undefined"&&(o[0].style.cssText=u.style),u.content==""?(u.content=i,u.hidden||this.refresh(t)):(u.content=i,u.hidden||(r!=null&&r!=""&&typeof r!="undefined"?(c="layout_"+this.name+"_panel_"+u.type,e=n("#"+c+" > .w2ui-panel-content"),e.after('<div class="w2ui-panel-content new-panel" style="'+e[0].style.cssText+'"></div>'),f=n("#"+c+" > .w2ui-panel-content.new-panel"),e.css("top",h),f.css("top",h),typeof i=="object"?(i.box=f[0],i.render()):f.html(i),w2utils.transition(e[0],f[0],r,function(){e.remove(),f.removeClass("new-panel"),f.css("overflow",u.overflow),window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){s.resize()},100)})):u.hidden||this.refresh(t))),window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){s.resize()},100),!0)},load:function(t,i,r,u){var f=this;return t=="css"?(n.get(i,function(n,i,r){f.content(t,r.responseText),u&&u()}),!0):this.get(t)!=null?(n.get(i,function(n,i,e){f.content(t,e.responseText,r),u&&u(),window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){f.resize()},100)}),!0):!1},sizeTo:function(t,i){var r=this,u=r.get(t);return u==null?!1:(n(r.box).find(" > div .w2ui-panel").css({"-webkit-transition":".35s","-moz-transition":".35s","-ms-transition":".35s","-o-transition":".35s"}),setTimeout(function(){r.set(t,{size:i})},1),setTimeout(function(){n(r.box).find(" > div .w2ui-panel").css({"-webkit-transition":"0s","-moz-transition":"0s","-ms-transition":"0s","-o-transition":"0s"}),r.resize()},500),!0)},show:function(t,i){var r=this,f=this.trigger({phase:"before",type:"show",target:t,object:this.get(t),immediate:i}),u;return f.isCancelled===!0?!1:(u=r.get(t),u==null)?!1:(u.hidden=!1,i===!0?(n("#layout_"+r.name+"_panel_"+t).css({opacity:"1"}),u.resizabled&&n("#layout_"+r.name+"_resizer_"+t).show(),r.trigger(n.extend(f,{phase:"after"})),r.resize()):(u.resizabled&&n("#layout_"+r.name+"_resizer_"+t).show(),n("#layout_"+r.name+"_panel_"+t).css({opacity:"0"}),n(r.box).find(" > div .w2ui-panel").css({"-webkit-transition":".2s","-moz-transition":".2s","-ms-transition":".2s","-o-transition":".2s"}),setTimeout(function(){r.resize()},1),setTimeout(function(){n("#layout_"+r.name+"_panel_"+t).css({opacity:"1"})},250),setTimeout(function(){n(r.box).find(" > div .w2ui-panel").css({"-webkit-transition":"0s","-moz-transition":"0s","-ms-transition":"0s","-o-transition":"0s"}),r.trigger(n.extend(f,{phase:"after"})),r.resize()},500)),!0)},hide:function(t,i){var r=this,f=this.trigger({phase:"before",type:"hide",target:t,object:this.get(t),immediate:i}),u;return f.isCancelled===!0?!1:(u=r.get(t),u==null)?!1:(u.hidden=!0,i===!0?(n("#layout_"+r.name+"_panel_"+t).css({opacity:"0"}),n("#layout_"+r.name+"_resizer_"+t).hide(),r.trigger(n.extend(f,{phase:"after"})),r.resize()):(n("#layout_"+r.name+"_resizer_"+t).hide(),n(r.box).find(" > div .w2ui-panel").css({"-webkit-transition":".2s","-moz-transition":".2s","-ms-transition":".2s","-o-transition":".2s"}),n("#layout_"+r.name+"_panel_"+t).css({opacity:"0"}),setTimeout(function(){r.resize()},1),setTimeout(function(){n(r.box).find(" > div .w2ui-panel").css({"-webkit-transition":"0s","-moz-transition":"0s","-ms-transition":"0s","-o-transition":"0s"}),r.trigger(n.extend(f,{phase:"after"})),r.resize()},500)),!0)},toggle:function(n,t){var i=this.get(n);return i==null?!1:i.hidden?this.show(n,t):this.hide(n,t)},set:function(t,i){var r=this.get(t,!0);return r==null?!1:(n.extend(this.panels[r],i),this.refresh(t),this.resize(),!0)},get:function(n,t){var r=null,i;for(i in this.panels)if(this.panels[i].type==n)return t===!0?i:this.panels[i];return null},el:function(t){var i=n("#layout_"+this.name+"_panel_"+t+" .w2ui-panel-content");return i.length!=1?null:i[0]},hideToolbar:function(t){var i=this.get(t);i&&(i.show.toolbar=!1,n("#layout_"+this.name+"_panel_"+t+" > .w2ui-panel-toolbar").hide(),this.resize())},showToolbar:function(t){var i=this.get(t);i&&(i.show.toolbar=!0,n("#layout_"+this.name+"_panel_"+t+" > .w2ui-panel-toolbar").show(),this.resize())},toggleToolbar:function(n){var t=this.get(n);t&&(t.show.toolbar?this.hideToolbar(n):this.showToolbar(n))},hideTabs:function(t){var i=this.get(t);i&&(i.show.tabs=!1,n("#layout_"+this.name+"_panel_"+t+" > .w2ui-panel-tabs").hide(),this.resize())},showTabs:function(t){var i=this.get(t);i&&(i.show.tabs=!0,n("#layout_"+this.name+"_panel_"+t+" > .w2ui-panel-tabs").show(),this.resize())},toggleTabs:function(n){var t=this.get(n);t&&(t.show.tabs?this.hideTabs(n):this.showTabs(n))},render:function(t){function a(){i.tmp.events={resize:function(){w2ui[i.name].resize()},resizeStart:c,mousemove:h,mouseup:s};n(window).on("resize",i.tmp.events.resize);n(document).on("mousemove",i.tmp.events.mousemove);n(document).on("mouseup",i.tmp.events.mouseup)}function c(t,r){i.box&&(r||(r=window.event),window.addEventListener||window.document.attachEvent("onselectstart",function(){return!1}),i.tmp.resize={type:t,x:r.screenX,y:r.screenY,div_x:0,div_y:0,value:0},(t=="left"||t=="right")&&(i.tmp.resize.value=parseInt(n("#layout_"+i.name+"_resizer_"+t)[0].style.left)),(t=="top"||t=="preview"||t=="bottom")&&(i.tmp.resize.value=parseInt(n("#layout_"+i.name+"_resizer_"+t)[0].style.top)))}function s(t){var u,f;if(i.box&&(t||(t=window.event),window.addEventListener||window.document.attachEvent("onselectstart",function(){return!1}),typeof i.tmp.resize!="undefined")){if(i.tmp.div_x!=0||i.tmp.resize.div_y!=0){var e=i.get("top"),o=i.get("bottom"),r=i.get(i.tmp.resize.type),h=parseInt(n(i.box).height()),c=parseInt(n(i.box).width()),s=String(r.size);switch(i.tmp.resize.type){case"top":u=parseInt(r.sizeCalculated)+i.tmp.resize.div_y,f=0;break;case"bottom":u=parseInt(r.sizeCalculated)-i.tmp.resize.div_y,f=0;break;case"preview":u=parseInt(r.sizeCalculated)-i.tmp.resize.div_y,f=(e&&!e.hidden?e.sizeCalculated:0)+(o&&!o.hidden?o.sizeCalculated:0);break;case"left":u=parseInt(r.sizeCalculated)+i.tmp.resize.div_x,f=0;break;case"right":u=parseInt(r.sizeCalculated)-i.tmp.resize.div_x,f=0}r.size=s.substr(s.length-1)=="%"?Math.floor(u*100/(r.type=="left"||r.type=="right"?c:h-f)*100)/100+"%":u,i.resize()}n("#layout_"+i.name+"_resizer_"+i.tmp.resize.type).removeClass("active"),delete i.tmp.resize}}function h(t){var f,u,r;if(i.box&&(t||(t=window.event),typeof i.tmp.resize!="undefined")){if(f=i.get(i.tmp.resize.type),u=i.trigger({phase:"before",type:"resizing",target:i.tmp.resize.type,object:f,originalEvent:t}),u.isCancelled===!0)return!1;r=n("#layout_"+i.name+"_resizer_"+i.tmp.resize.type),r.hasClass("active")||r.addClass("active"),i.tmp.resize.div_x=t.screenX-i.tmp.resize.x,i.tmp.resize.div_y=t.screenY-i.tmp.resize.y,i.tmp.resizing=="left"&&i.get("left").minSize-i.tmp.resize.div_x>i.get("left").width&&(i.tmp.resize.div_x=i.get("left").minSize-i.get("left").width),i.tmp.resize.type=="left"&&i.get("main").minSize+i.tmp.resize.div_x>i.get("main").width&&(i.tmp.resize.div_x=i.get("main").width-i.get("main").minSize),i.tmp.resize.type=="right"&&i.get("right").minSize+i.tmp.resize.div_x>i.get("right").width&&(i.tmp.resize.div_x=i.get("right").width-i.get("right").minSize),i.tmp.resize.type=="right"&&i.get("main").minSize-i.tmp.resize.div_x>i.get("main").width&&(i.tmp.resize.div_x=i.get("main").minSize-i.get("main").width),i.tmp.resize.type=="top"&&i.get("top").minSize-i.tmp.resize.div_y>i.get("top").height&&(i.tmp.resize.div_y=i.get("top").minSize-i.get("top").height),i.tmp.resize.type=="top"&&i.get("main").minSize+i.tmp.resize.div_y>i.get("main").height&&(i.tmp.resize.div_y=i.get("main").height-i.get("main").minSize),i.tmp.resize.type=="bottom"&&i.get("bottom").minSize+i.tmp.resize.div_y>i.get("bottom").height&&(i.tmp.resize.div_y=i.get("bottom").height-i.get("bottom").minSize),i.tmp.resize.type=="bottom"&&i.get("main").minSize-i.tmp.resize.div_y>i.get("main").height&&(i.tmp.resize.div_y=i.get("main").minSize-i.get("main").height),i.tmp.resize.type=="preview"&&i.get("preview").minSize+i.tmp.resize.div_y>i.get("preview").height&&(i.tmp.resize.div_y=i.get("preview").height-i.get("preview").minSize),i.tmp.resize.type=="preview"&&i.get("main").minSize-i.tmp.resize.div_y>i.get("main").height&&(i.tmp.resize.div_y=i.get("main").minSize-i.get("main").height);switch(i.tmp.resize.type){case"top":case"preview":case"bottom":i.tmp.resize.div_x=0,r.length>0&&(r[0].style.top=i.tmp.resize.value+i.tmp.resize.div_y+"px");break;case"left":case"right":i.tmp.resize.div_y=0,r.length>0&&(r[0].style.left=i.tmp.resize.value+i.tmp.resize.div_x+"px")}i.trigger(n.extend(u,{phase:"after"}))}}var i=this,o,f,r,u,l,e;if((window.getSelection&&window.getSelection().removeAllRanges(),o=+new Date,f=i.trigger({phase:"before",type:"render",target:i.name,box:t}),f.isCancelled===!0)||(typeof t!="undefined"&&t!=null&&(n(i.box).find("#layout_"+i.name+"_panel_main").length>0&&n(i.box).removeAttr("name").removeClass("w2ui-layout").html(""),i.box=t),!i.box))return!1;n(i.box).attr("name",i.name).addClass("w2ui-layout").html("<div></div>"),n(i.box).length>0&&(n(i.box)[0].style.cssText+=i.style),r=["top","left","main","preview","right","bottom"];for(u in r)l=i.get(r[u]),e='<div id="layout_'+i.name+"_panel_"+r[u]+'" class="w2ui-panel">\t<div class="w2ui-panel-tabs"></div>\t<div class="w2ui-panel-toolbar"></div>\t<div class="w2ui-panel-content"></div></div><div id="layout_'+i.name+"_resizer_"+r[u]+'" class="w2ui-resizer"></div>',n(i.box).find(" > div").append(e);return n(i.box).find(" > div").append('<div id="layout_'+i.name+'_panel_css" style="position: absolute; top: 10000px;"></div'),i.refresh(),i.trigger(n.extend(f,{phase:"after"})),setTimeout(function(){i.resize(),a()},0),+new Date-o},refresh:function(t){var r=this,o,e,f,u,i;if(window.getSelection&&window.getSelection().removeAllRanges(),typeof t=="undefined"&&(t=null),o=+new Date,e=r.trigger({phase:"before",type:"refresh",target:typeof t!="undefined"?t:r.name,object:r.get(t)}),e.isCancelled!==!0){if(t!=null&&typeof t!="undefined"){if(i=r.get(t),i==null)return;f=n("#layout_"+r.name+"_panel_"+t).css({display:i.hidden?"none":"block"}),f=f.find(".w2ui-panel-content"),f.length>0&&(f.css("overflow",i.overflow)[0].style.cssText+=";"+i.style),i.resizable===!0?n("#layout_"+this.name+"_resizer_"+t).show():n("#layout_"+this.name+"_resizer_"+t).hide(),typeof i.content=="object"&&i.content.render?(i.content.box=n("#layout_"+r.name+"_panel_"+i.type+" > .w2ui-panel-content")[0],i.content.render()):n("#layout_"+r.name+"_panel_"+i.type+" > .w2ui-panel-content").html(i.content),u=n(r.box).find("#layout_"+r.name+"_panel_"+i.type+" .w2ui-panel-tabs"),i.show.tabs?u.find("[name="+i.tabs.name+"]").length==0&&i.tabs!=null?u.w2render(i.tabs):i.tabs.refresh():u.html("").removeClass("w2ui-tabs").hide(),u=n(r.box).find("#layout_"+r.name+"_panel_"+i.type+" .w2ui-panel-toolbar"),i.show.toolbar?u.find("[name="+i.toolbar.name+"]").length==0&&i.toolbar!=null?u.w2render(i.toolbar):i.toolbar.refresh():u.html("").removeClass("w2ui-toolbar").hide()}else{if(n("#layout_"+r.name+"_panel_main").length<=0){r.render();return}r.resize();for(i in this.panels)r.refresh(this.panels[i].type)}return r.trigger(n.extend(e,{phase:"after"})),+new Date-o}},resize:function(){var ut,nt,y,h,u,tt,b,a,p;if((window.getSelection&&window.getSelection().removeAllRanges(),!this.box)||(ut=+new Date,nt=this.trigger({phase:"before",type:"resize",target:this.name,panel:this.tmp.resizing}),nt.isCancelled===!0))return!1;this.padding<0&&(this.padding=0),y=parseInt(n(this.box).width()),h=parseInt(n(this.box).height()),n(this.box).find(" > div").css({width:y+"px",height:h+"px"});var p=this,it=this.get("main"),l=this.get("preview"),s=this.get("left"),c=this.get("right"),r=this.get("top"),f=this.get("bottom"),et=!0,ft=l!=null&&l.hidden!=!0?!0:!1,d=s!=null&&s.hidden!=!0?!0:!1,rt=c!=null&&c.hidden!=!0?!0:!1,w=r!=null&&r.hidden!=!0?!0:!1,g=f!=null&&f.hidden!=!0?!0:!1;for(a in{top:"",left:"",right:"",bottom:"",preview:""})u=this.get(a),tt=String(u.size),u&&tt.substr(tt.length-1)=="%"?(b=h,u.type=="preview"&&(b=b-(r&&!r.hidden?r.sizeCalculated:0)-(f&&!f.hidden?f.sizeCalculated:0)),u.sizeCalculated=parseInt((u.type=="left"||u.type=="right"?y:b)*parseFloat(u.size)/100)):u.sizeCalculated=parseInt(u.size),u.sizeCalculated<parseInt(u.minSize)&&(u.sizeCalculated=parseInt(u.minSize));if(r!=null&&r.hidden!=!0){var o=0,e=0,t=y,i=r.sizeCalculated;n("#layout_"+this.name+"_panel_top").css({display:"block",left:o+"px",top:e+"px",width:t+"px",height:i+"px"}).show(),r.width=t,r.height=i,r.resizable&&(e=r.sizeCalculated-(this.padding==0?this.resizer:0),i=this.resizer>this.padding?this.resizer:this.padding,n("#layout_"+this.name+"_resizer_top").show().css({display:"block",left:o+"px",top:e+"px",width:t+"px",height:i+"px",cursor:"ns-resize"}).bind("mousedown",function(n){return w2ui[p.name].tmp.events.resizeStart("top",n),!1}))}else n("#layout_"+this.name+"_panel_top").hide();if(s!=null&&s.hidden!=!0){var o=0,e=0+(w?r.sizeCalculated+this.padding:0),t=s.sizeCalculated,i=h-(w?r.sizeCalculated+this.padding:0)-(g?f.sizeCalculated+this.padding:0),v=n("#layout_"+this.name+"_panel_left");window.navigator.userAgent.indexOf("MSIE")>0&&v.length>0&&v[0].clientHeight<v[0].scrollHeight&&(t+=17),n("#layout_"+this.name+"_panel_left").css({display:"block",left:o+"px",top:e+"px",width:t+"px",height:i+"px"}).show(),s.width=t,s.height=i,s.resizable&&(o=s.sizeCalculated-(this.padding==0?this.resizer:0),t=this.resizer>this.padding?this.resizer:this.padding,n("#layout_"+this.name+"_resizer_left").show().css({display:"block",left:o+"px",top:e+"px",width:t+"px",height:i+"px",cursor:"ew-resize"}).bind("mousedown",function(n){return w2ui[p.name].tmp.events.resizeStart("left",n),!1}))}else n("#layout_"+this.name+"_panel_left").hide(),n("#layout_"+this.name+"_resizer_left").hide();if(c!=null&&c.hidden!=!0){var o=y-c.sizeCalculated,e=0+(w?r.sizeCalculated+this.padding:0),t=c.sizeCalculated,i=h-(w?r.sizeCalculated+this.padding:0)-(g?f.sizeCalculated+this.padding:0);n("#layout_"+this.name+"_panel_right").css({display:"block",left:o+"px",top:e+"px",width:t+"px",height:i+"px"}).show(),c.width=t,c.height=i,c.resizable&&(o=o-this.padding,t=this.resizer>this.padding?this.resizer:this.padding,n("#layout_"+this.name+"_resizer_right").show().css({display:"block",left:o+"px",top:e+"px",width:t+"px",height:i+"px",cursor:"ew-resize"}).bind("mousedown",function(n){return w2ui[p.name].tmp.events.resizeStart("right",n),!1}))}else n("#layout_"+this.name+"_panel_right").hide();if(f!=null&&f.hidden!=!0){var o=0,e=h-f.sizeCalculated,t=y,i=f.sizeCalculated;n("#layout_"+this.name+"_panel_bottom").css({display:"block",left:o+"px",top:e+"px",width:t+"px",height:i+"px"}).show(),f.width=t,f.height=i,f.resizable&&(e=e-(this.padding==0?0:this.padding),i=this.resizer>this.padding?this.resizer:this.padding,n("#layout_"+this.name+"_resizer_bottom").show().css({display:"block",left:o+"px",top:e+"px",width:t+"px",height:i+"px",cursor:"ns-resize"}).bind("mousedown",function(n){return w2ui[p.name].tmp.events.resizeStart("bottom",n),!1}))}else n("#layout_"+this.name+"_panel_bottom").hide();var o=0+(d?s.sizeCalculated+this.padding:0),e=0+(w?r.sizeCalculated+this.padding:0),t=y-(d?s.sizeCalculated+this.padding:0)-(rt?c.sizeCalculated+this.padding:0),i=h-(w?r.sizeCalculated+this.padding:0)-(g?f.sizeCalculated+this.padding:0)-(ft?l.sizeCalculated+this.padding:0),v=n("#layout_"+this.name+"_panel_main");if(window.navigator.userAgent.indexOf("MSIE")>0&&v.length>0&&v[0].clientHeight<v[0].scrollHeight&&(t+=17),n("#layout_"+this.name+"_panel_main").css({display:"block",left:o+"px",top:e+"px",width:t+"px",height:i+"px"}),it.width=t,it.height=i,l!=null&&l.hidden!=!0){var o=0+(d?s.sizeCalculated+this.padding:0),e=h-(g?f.sizeCalculated+this.padding:0)-l.sizeCalculated,t=y-(d?s.sizeCalculated+this.padding:0)-(rt?c.sizeCalculated+this.padding:0),i=l.sizeCalculated,v=n("#layout_"+this.name+"_panel_preview");window.navigator.userAgent.indexOf("MSIE")>0&&v.length>0&&v[0].clientHeight<v[0].scrollHeight&&(t+=17),n("#layout_"+this.name+"_panel_preview").css({display:"block",left:o+"px",top:e+"px",width:t+"px",height:i+"px"}).show(),l.width=t,l.height=i,l.resizable&&(e=e-(this.padding==0?0:this.padding),i=this.resizer>this.padding?this.resizer:this.padding,n("#layout_"+this.name+"_resizer_preview").show().css({display:"block",left:o+"px",top:e+"px",width:t+"px",height:i+"px",cursor:"ns-resize"}).bind("mousedown",function(n){return w2ui[p.name].tmp.events.resizeStart("preview",n),!1}))}else n("#layout_"+this.name+"_panel_preview").hide();for(a in{top:"",left:"",main:"",preview:"",right:"",bottom:""}){var k=this.get(a),u="#layout_"+this.name+"_panel_"+a+" > .w2ui-panel-",h=0;k.show.tabs&&(k.tabs!=null&&w2ui[this.name+"_"+a+"_tabs"]&&w2ui[this.name+"_"+a+"_tabs"].resize(),h+=w2utils.getSize(n(u+"tabs").css({display:"block"}),"height")),k.show.toolbar&&(k.toolbar!=null&&w2ui[this.name+"_"+a+"_toolbar"]&&w2ui[this.name+"_"+a+"_toolbar"].resize(),h+=w2utils.getSize(n(u+"toolbar").css({top:h+"px",display:"block"}),"height")),n(u+"content").css({display:"block"}).css({top:h+"px"})}return p=this,clearTimeout(this._resize_timer),this._resize_timer=setTimeout(function(){var t,i;for(t in w2ui)typeof w2ui[t].resize=="function"&&(w2ui[t].panels=="undefined"&&w2ui[t].resize(),i=n(w2ui[t].box).parents(".w2ui-layout"),i.length>0&&i.attr("name")==p.name&&w2ui[t].resize())},100),this.trigger(n.extend(nt,{phase:"after"})),+new Date-ut},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});return t.isCancelled===!0?!1:typeof w2ui[this.name]=="undefined"?!1:(n(this.box).find("#layout_"+this.name+"_panel_main").length>0&&n(this.box).removeAttr("name").removeClass("w2ui-layout").html(""),delete w2ui[this.name],this.trigger(n.extend(t,{phase:"after"})),this.tmp.events&&this.tmp.events.resize&&n(window).off("resize",this.tmp.events.resize),this.tmp.events&&this.tmp.events.mousemove&&n(document).off("mousemove",this.tmp.events.mousemove),this.tmp.events&&this.tmp.events.mouseup&&n(document).off("mouseup",this.tmp.events.mouseup),!0)},lock:function(t,i,r){if(n.inArray(String(t),["left","right","top","bottom","preview","main"])==-1){console.log("ERROR: First parameter needs to be the a valid panel name.");return}var u="#layout_"+this.name+"_panel_"+t;w2utils.lock(u,i,r)},unlock:function(t){if(n.inArray(String(t),["left","right","top","bottom","preview","main"])==-1){console.log("ERROR: First parameter needs to be the a valid panel name.");return}var i="#layout_"+this.name+"_panel_"+t;w2utils.unlock(i)}},n.extend(t.prototype,w2utils.event),w2obj.layout=t}(jQuery),w2popup={},function(n){n.fn.w2popup=function(t,i){typeof t=="undefined"&&(i={},t="open"),n.isPlainObject(t)&&(i=t,t="open"),t=t.toLowerCase(),t=="load"&&typeof i=="string"&&(i={url:i}),t=="open"&&typeof i.url!="undefined"&&(t="load"),typeof i=="undefined"&&(i={});var r={};return n(this).length>0&&(n(this).find("div[rel=title], div[rel=body], div[rel=buttons]").length>0?(n(this).find("div[rel=title]").length>0&&(r.title=n(this).find("div[rel=title]").html()),n(this).find("div[rel=body]").length>0&&(r.body=n(this).find("div[rel=body]").html(),r.style=n(this).find("div[rel=body]")[0].style.cssText),n(this).find("div[rel=buttons]").length>0&&(r.buttons=n(this).find("div[rel=buttons]").html())):(r.title="&nbsp;",r.body=n(this).html()),parseInt(n(this).css("width"))!=0&&(r.width=parseInt(n(this).css("width"))),parseInt(n(this).css("height"))!=0&&(r.height=parseInt(n(this).css("height")))),w2popup[t](n.extend({},r,i))},w2popup={defaults:{title:"",body:"",buttons:"",style:"",color:"#000",opacity:.4,speed:.3,modal:!1,maximized:!1,keyboard:!0,width:500,height:300,showClose:!0,showMax:!1,transition:null},handlers:[],onOpen:null,onClose:null,onMax:null,onMin:null,onKeydown:null,open:function(t){function w(n){if(n||(n=window.event),window.addEventListener||window.document.attachEvent("onselectstart",function(){return!1}),i.resizing=!0,i.tmp_x=n.screenX,i.tmp_y=n.screenY,n.stopPropagation?n.stopPropagation():n.cancelBubble=!0,n.preventDefault)n.preventDefault();else return!1}function c(t){i.resizing==!0&&(t||(t=window.event),i.tmp_div_x=t.screenX-i.tmp_x,i.tmp_div_y=t.screenY-i.tmp_y,n("#w2ui-popup").css({"-webkit-transition":"none","-webkit-transform":"translate3d("+i.tmp_div_x+"px, "+i.tmp_div_y+"px, 0px)","-moz-transition":"none","-moz-transform":"translate("+i.tmp_div_x+"px, "+i.tmp_div_y+"px)","-ms-transition":"none","-ms-transform":"translate("+i.tmp_div_x+"px, "+i.tmp_div_y+"px)","-o-transition":"none","-o-transform":"translate("+i.tmp_div_x+"px, "+i.tmp_div_y+"px)"}),n("#w2ui-panel").css({"-webkit-transition":"none","-webkit-transform":"translate3d("+i.tmp_div_x+"px, "+i.tmp_div_y+"px, 0px)","-moz-transition":"none","-moz-transform":"translate("+i.tmp_div_x+"px, "+i.tmp_div_y+"px)","-ms-transition":"none","-ms-transform":"translate("+i.tmp_div_x+"px, "+i.tmp_div_y+"px","-o-transition":"none","-o-transform":"translate("+i.tmp_div_x+"px, "+i.tmp_div_y+"px)"}))}function h(t){i.resizing==!0&&(t||(t=window.event),i.tmp_div_x=t.screenX-i.tmp_x,i.tmp_div_y=t.screenY-i.tmp_y,n("#w2ui-popup").css({"-webkit-transition":"none","-webkit-transform":"translate3d(0px, 0px, 0px)","-moz-transition":"none","-moz-transform":"translate(0px, 0px)","-ms-transition":"none","-ms-transform":"translate(0px, 0px)","-o-transition":"none","-o-transform":"translate(0px, 0px)",left:parseInt(n("#w2ui-popup").css("left"))+parseInt(i.tmp_div_x)+"px",top:parseInt(n("#w2ui-popup").css("top"))+parseInt(i.tmp_div_y)+"px"}),n("#w2ui-panel").css({"-webkit-transition":"none","-webkit-transform":"translate3d(0px, 0px, 0px)","-moz-transition":"none","-moz-transform":"translate(0px, 0px)","-ms-transition":"none","-ms-transform":"translate(0px, 0px)","-o-transition":"none","-o-transform":"translate(0px, 0px)",left:parseInt(n("#w2ui-panel").css("left"))+parseInt(i.tmp_div_x)+"px",top:parseInt(n("#w2ui-panel").css("top"))+parseInt(i.tmp_div_y)+"px"}),i.resizing=!1)}var p=this,o=n("#w2ui-popup").data("options"),t=n.extend({},this.defaults,{body:""},o,t),e,f,v,y,r,u,a,l,s,i;if(n("#w2ui-popup").length==0&&(w2popup.handlers=[],w2popup.onMax=null,w2popup.onMin=null,w2popup.onOpen=null,w2popup.onClose=null,w2popup.onKeydown=null),t.onOpen&&(w2popup.onOpen=t.onOpen),t.onClose&&(w2popup.onClose=t.onClose),t.onMax&&(w2popup.onMax=t.onMax),t.onMin&&(w2popup.onMin=t.onMin),t.onKeydown&&(w2popup.onKeydown=t.onKeydown),window.innerHeight==undefined?(e=document.documentElement.offsetWidth,f=document.documentElement.offsetHeight,w2utils.engine=="IE7"&&(e+=21,f+=4)):(e=window.innerWidth,f=window.innerHeight),parseInt(e)-10<parseInt(t.width)&&(t.width=parseInt(e)-10),parseInt(f)-10<parseInt(t.height)&&(t.height=parseInt(f)-10),v=(parseInt(f)-parseInt(t.height))/2*.6,y=(parseInt(e)-parseInt(t.width))/2,n("#w2ui-popup").length==0){if(u=this.trigger({phase:"before",type:"open",target:"popup",options:t,present:!1}),u.isCancelled===!0)return;w2popup.lockScreen(t),r='<div id="w2ui-popup" class="w2ui-popup" style="width: '+parseInt(t.width)+"px; height: "+parseInt(t.height)+"px; opacity: 0; -webkit-transform: scale(0.8); -moz-transform: scale(0.8); -ms-transform: scale(0.8); -o-transform: scale(0.8); left: "+y+"px; top: "+v+'px;">',t.title!=""&&(r+='<div class="w2ui-msg-title">'+(t.showClose?'<div class="w2ui-msg-button w2ui-msg-close" onclick="w2popup.close(); if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">Close</div>':"")+(t.showMax?'<div class="w2ui-msg-button w2ui-msg-max" onclick="w2popup.toggle()">Max</div>':"")+t.title+"</div>"),r+='<div class="w2ui-box1" style="'+(t.title==""?"top: 0px !important;":"")+(t.buttons==""?"bottom: 0px !important;":"")+'">',r+='<div class="w2ui-msg-body'+(!t.title!=""?" w2ui-msg-no-title":"")+(!t.buttons!=""?" w2ui-msg-no-buttons":"")+'" style="'+t.style+'">'+t.body+"</div>",r+="</div>",r+='<div class="w2ui-box2" style="'+(t.title==""?"top: 0px !important;":"")+(t.buttons==""?"bottom: 0px !important;":"")+'">',r+='<div class="w2ui-msg-body'+(!t.title!=""?" w2ui-msg-no-title":"")+(!t.buttons!=""?" w2ui-msg-no-buttons":"")+'" style="'+t.style+'"></div>',r+="</div>",t.buttons!=""&&(r+='<div class="w2ui-msg-buttons">'+t.buttons+"</div>"),r+="</div>",n("body").append(r),setTimeout(function(){n("#w2ui-popup .w2ui-box2").hide(),n("#w2ui-popup").css({"-webkit-transition":t.speed+"s opacity, "+t.speed+"s -webkit-transform","-webkit-transform":"scale(1)","-moz-transition":t.speed+"s opacity, "+t.speed+"s -moz-transform","-moz-transform":"scale(1)","-ms-transition":t.speed+"s opacity, "+t.speed+"s -ms-transform","-ms-transform":"scale(1)","-o-transition":t.speed+"s opacity, "+t.speed+"s -o-transform","-o-transform":"scale(1)",opacity:"1"})},1),setTimeout(function(){n("#w2ui-popup").css({"-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":""}),p.trigger(n.extend(u,{phase:"after"}))},t.speed*1e3)}else{if(u=this.trigger({phase:"before",type:"open",target:"popup",options:t,present:!0}),u.isCancelled===!0)return;(typeof o=="undefined"||o.width!=t.width||o.height!=t.height)&&(n("#w2ui-panel").remove(),w2popup.resize(t.width,t.height)),a=n("#w2ui-popup .w2ui-box2 > .w2ui-msg-body").html(t.body),a.length>0&&(a[0].style.cssText=t.style),n("#w2ui-popup .w2ui-msg-buttons").html(t.buttons),n("#w2ui-popup .w2ui-msg-title").html((t.showClose?'<div class="w2ui-msg-button w2ui-msg-close" onclick="w2popup.close()">Close</div>':"")+(t.showMax?'<div class="w2ui-msg-button w2ui-msg-max" onclick="w2popup.max()">Max</div>':"")+t.title),l=n("#w2ui-popup .w2ui-box1")[0],s=n("#w2ui-popup .w2ui-box2")[0],w2utils.transition(l,s,t.transition),s.className="w2ui-box1",l.className="w2ui-box2",n(s).addClass("w2ui-current-box"),n("#w2ui-popup").data("prev-size",null),setTimeout(function(){p.trigger(n.extend(u,{phase:"after"}))},1)}if(t._last_w2ui_name=w2utils.keyboard.active(),w2utils.keyboard.active(null),n("#w2ui-popup").data("options",t),t.keyboard)n(document).on("keydown",this.keydown);i={resizing:!1};n("#w2ui-popup .w2ui-msg-title").on("mousedown",function(n){w(n)}).on("mousemove",function(n){c(n)}).on("mouseup",function(n){h(n)});n("#w2ui-popup .w2ui-msg-body").on("mousemove",function(n){c(n)}).on("mouseup",function(n){h(n)});n("#w2ui-lock").on("mousemove",function(n){c(n)}).on("mouseup",function(n){h(n)});return this},keydown:function(t){var r=n("#w2ui-popup").data("options"),i;if(r.keyboard&&(i=w2popup.trigger({phase:"before",type:"keydown",target:"popup",options:r,object:w2popup,originalEvent:t}),i.isCancelled!==!0)){switch(t.keyCode){case 27:t.preventDefault(),n("#w2ui-popup .w2ui-popup-message").length>0?w2popup.message():w2popup.close()}w2popup.trigger(n.extend(i,{phase:"after"}))}},close:function(t){var r=this,t=n.extend({},n("#w2ui-popup").data("options"),t),i=this.trigger({phase:"before",type:"close",target:"popup",options:t});i.isCancelled!==!0&&(n("#w2ui-popup, #w2ui-panel").css({"-webkit-transition":t.speed+"s opacity, "+t.speed+"s -webkit-transform","-webkit-transform":"scale(0.9)","-moz-transition":t.speed+"s opacity, "+t.speed+"s -moz-transform","-moz-transform":"scale(0.9)","-ms-transition":t.speed+"s opacity, "+t.speed+"s -ms-transform","-ms-transform":"scale(0.9)","-o-transition":t.speed+"s opacity, "+t.speed+"s -o-transform","-o-transform":"scale(0.9)",opacity:"0"}),w2popup.unlockScreen(),setTimeout(function(){n("#w2ui-popup").remove(),n("#w2ui-panel").remove(),r.trigger(n.extend(i,{phase:"after"}))},t.speed*1e3),w2utils.keyboard.active(t._last_w2ui_name),t.keyboard&&n(document).off("keydown",this.keydown))},toggle:function(){var t=n("#w2ui-popup").data("options");t.maximized===!0?w2popup.min():w2popup.max()},max:function(){var r=this,t=n("#w2ui-popup").data("options"),i;t.maximized!==!0&&(i=this.trigger({phase:"before",type:"max",target:"popup",options:t}),i.isCancelled!==!0)&&(t.maximized=!0,t.prevSize=n("#w2ui-popup").css("width")+":"+n("#w2ui-popup").css("height"),n("#w2ui-popup").data("options",t),w2popup.resize(1e4,1e4,function(){r.trigger(n.extend(i,{phase:"after"}))}))},min:function(){var u=this,t=n("#w2ui-popup").data("options"),i,r;t.maximized===!0&&(i=t.prevSize.split(":"),r=this.trigger({phase:"before",type:"min",target:"popup",options:t}),r.isCancelled!==!0)&&(t.maximized=!1,t.prevSize=null,n("#w2ui-popup").data("options",t),w2popup.resize(i[0],i[1],function(){u.trigger(n.extend(r,{phase:"after"}))}))},get:function(){return n("#w2ui-popup").data("options")},set:function(n){w2popup.open(n)},clear:function(){n("#w2ui-popup .w2ui-msg-title").html(""),n("#w2ui-popup .w2ui-msg-body").html(""),n("#w2ui-popup .w2ui-msg-buttons").html("")},reset:function(){w2popup.open(w2popup.defaults)},load:function(t){function u(i,r){if(delete t.url,n("body").append('<div id="w2ui-tmp" style="display: none">'+i+"</div>"),typeof r!="undefined"&&n("#w2ui-tmp #"+r).length>0?n("#w2ui-tmp #"+r).w2popup(t):n("#w2ui-tmp > div").w2popup(t),n("#w2ui-tmp > style").length>0){var u=n("<div>").append(n("#w2ui-tmp > style").clone()).html();n("#w2ui-popup #div-style").length==0&&n("#w2ui-ppopup").append('<div id="div-style" style="position: absolute; left: -100; width: 1px"></div>'),n("#w2ui-popup #div-style").html(u)}n("#w2ui-tmp").remove()}var i;if(String(t.url)=="undefined"){console.log("ERROR: The url parameter is empty.");return}var f=String(t.url).split("#"),r=f[0],e=f[1];String(t)=="undefined"&&(t={}),i=n("#w2ui-popup").data(r),typeof i!="undefined"&&i!=null?u(i,e):n.get(r,function(t,i,f){u(f.responseText,e),n("#w2ui-popup").data(r,f.responseText)})},message:function(t){var r,u,i,t;n().w2tag(),t||(t={width:200,height:100}),parseInt(t.width)<10&&(t.width=10),parseInt(t.height)<10&&(t.height=10),typeof t.hideOnClick=="undefined"&&(t.hideOnClick=!1),r=n("#w2ui-popup .w2ui-msg-title"),n("#w2ui-popup .w2ui-popup-message").length==0?(u=parseInt(n("#w2ui-popup").width()),n("#w2ui-popup .w2ui-box1").before('<div class="w2ui-popup-message" style="display: none; '+(r.length==0?"top: 0px;":"top: "+w2utils.getSize(r,"height")+"px;")+(typeof t.width!="undefined"?"width: "+t.width+"px; left: "+(u-t.width)/2+"px;":"left: 10px; right: 10px;")+(typeof t.height!="undefined"?"height: "+t.height+"px;":"bottom: 6px;")+'-webkit-transition: .3s; -moz-transition: .3s; -ms-transition: .3s; -o-transition: .3s;"'+(t.hideOnClick===!0?'onclick="w2popup.message();"':"")+"></div>"),n("#w2ui-popup .w2ui-popup-message").data("options",t)):(typeof t.width=="undefined"&&(t.width=w2utils.getSize(n("#w2ui-popup .w2ui-popup-message"),"width")),typeof t.height=="undefined"&&(t.height=w2utils.getSize(n("#w2ui-popup .w2ui-popup-message"),"height"))),i=n("#w2ui-popup .w2ui-popup-message").css("display"),n("#w2ui-popup .w2ui-popup-message").css({"-webkit-transform":i=="none"?"translateY(-"+t.height+"px)":"translateY(0px)","-moz-transform":i=="none"?"translateY(-"+t.height+"px)":"translateY(0px)","-ms-transform":i=="none"?"translateY(-"+t.height+"px)":"translateY(0px)","-o-transform":i=="none"?"translateY(-"+t.height+"px)":"translateY(0px)"}),i=="none"?(n("#w2ui-popup .w2ui-popup-message").show().html(t.html),setTimeout(function(){n("#w2ui-popup .w2ui-popup-message").css({"-webkit-transition":"0s","-moz-transition":"0s","-ms-transition":"0s","-o-transition":"0s","z-Index":1500}),w2popup.lock(),typeof t.onOpen=="function"&&t.onOpen()},300)):(n("#w2ui-popup .w2ui-popup-message").css("z-Index",250),t=n("#w2ui-popup .w2ui-popup-message").data("options"),n("#w2ui-popup .w2ui-popup-message").remove(),w2popup.unlock(),typeof t.onClose=="function"&&t.onClose()),setTimeout(function(){n("#w2ui-popup .w2ui-popup-message").css({"-webkit-transform":i=="none"?"translateY(0px)":"translateY(-"+t.height+"px)","-moz-transform":i=="none"?"translateY(0px)":"translateY(-"+t.height+"px)","-ms-transform":i=="none"?"translateY(0px)":"translateY(-"+t.height+"px)","-o-transform":i=="none"?"translateY(0px)":"translateY(-"+t.height+"px)"})},1)},lock:function(t,i){w2utils.lock(n("#w2ui-popup"),t,i)},unlock:function(){w2utils.unlock(n("#w2ui-popup"))},lockScreen:function(t){if(n("#w2ui-lock").length>0)return!1;if(typeof t=="undefined"&&(t=n("#w2ui-popup").data("options")),typeof t=="undefined"&&(t={}),t=n.extend({},w2popup.defaults,t),n("body").append('<div id="w2ui-lock" \tonmousewheel="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; if (event.preventDefault) event.preventDefault(); else return false;"\tstyle="position: '+(w2utils.engine=="IE5"?"absolute":"fixed")+"; z-Index: 1199; left: 0px; top: 0px; \t\t   padding: 0px; margin: 0px; background-color: "+t.color+'; width: 100%; height: 100%; opacity: 0;"></div>'),setTimeout(function(){n("#w2ui-lock").css({"-webkit-transition":t.speed+"s opacity","-moz-transition":t.speed+"s opacity","-ms-transition":t.speed+"s opacity","-o-transition":t.speed+"s opacity",opacity:t.opacity})},1),t.modal==!0){n("#w2ui-lock").on("mousedown",function(){n("#w2ui-lock").css({"-webkit-transition":".1s","-moz-transition":".1s","-ms-transition":".1s","-o-transition":".1s",opacity:"0.6"}),window.getSelection&&window.getSelection().removeAllRanges()});n("#w2ui-lock").on("mouseup",function(){setTimeout(function(){n("#w2ui-lock").css({"-webkit-transition":".1s","-moz-transition":".1s","-ms-transition":".1s","-o-transition":".1s",opacity:t.opacity})},100),window.getSelection&&window.getSelection().removeAllRanges()})}else n("#w2ui-lock").on("mouseup",function(){w2popup.close()});return!0},unlockScreen:function(){if(n("#w2ui-lock").length==0)return!1;var t=n.extend({},n("#w2ui-popup").data("options"),t);return n("#w2ui-lock").css({"-webkit-transition":t.speed+"s opacity","-moz-transition":t.speed+"s opacity","-ms-transition":t.speed+"s opacity","-o-transition":t.speed+"s opacity",opacity:0}),setTimeout(function(){n("#w2ui-lock").remove()},t.speed*1e3),!0},resize:function(t,i,r){var u=n("#w2ui-popup").data("options"),e,f;parseInt(n(window).width())-10<parseInt(t)&&(t=parseInt(n(window).width())-10),parseInt(n(window).height())-10<parseInt(i)&&(i=parseInt(n(window).height())-10),e=(parseInt(n(window).height())-parseInt(i))/2*.8,f=(parseInt(n(window).width())-parseInt(t))/2,n("#w2ui-popup").css({"-webkit-transition":u.speed+"s width, "+u.speed+"s height, "+u.speed+"s left, "+u.speed+"s top","-moz-transition":u.speed+"s width, "+u.speed+"s height, "+u.speed+"s left, "+u.speed+"s top","-ms-transition":u.speed+"s width, "+u.speed+"s height, "+u.speed+"s left, "+u.speed+"s top","-o-transition":u.speed+"s width, "+u.speed+"s height, "+u.speed+"s left, "+u.speed+"s top",top:e,left:f,width:t,height:i}),typeof r=="function"&&setTimeout(function(){r()},u.speed*1e3)}},n.extend(w2popup,w2utils.event)}(jQuery),w2alert=function(n,t,i){typeof t=="undefined"&&(t=w2utils.lang("Notification")),jQuery("#w2ui-popup").length>0?w2popup.message({width:400,height:150,html:'<div style="position: absolute; top: 0px; left: 0px; right: 0px; bottom: 40px; overflow: auto">\t\t<div class="w2ui-centered"><div style="font-size: 13px;">'+n+'</div></div></div><div style="position: absolute; bottom: 7px; left: 0px; right: 0px; text-align: center; padding: 5px">\t\t<input type="button" value="Ok" onclick="w2popup.message();" class="w2ui-popup-button"></div>',onClose:function(){typeof i=="function"&&i()}}):w2popup.open({width:450,height:200,showMax:!1,title:t,body:'<div class="w2ui-centered"><div style="font-size: 13px;">'+n+"</div></div>",buttons:'<input type="button" value="'+w2utils.lang("Ok")+'" class="w2ui-popup-button" onclick="w2popup.close();">',onClose:function(){typeof i=="function"&&i()}})},w2confirm=function(n,t,i){(typeof i=="undefined"||typeof t=="function")&&(i=t,t=w2utils.lang("Confirmation")),typeof t=="undefined"&&(t=w2utils.lang("Confirmation")),jQuery("#w2ui-popup").length>0?w2popup.message({width:400,height:150,html:'<div style="position: absolute; top: 0px; left: 0px; right: 0px; bottom: 40px; overflow: auto">\t\t<div class="w2ui-centered"><div style="font-size: 13px;">'+n+'</div></div></div><div style="position: absolute; bottom: 7px; left: 0px; right: 0px; text-align: center; padding: 5px">\t\t<input id="No" type="button" value="'+w2utils.lang("No")+'" class="w2ui-popup-button">\t\t<input id="Yes" type="button" value="'+w2utils.lang("Yes")+'" class="w2ui-popup-button"></div>',onOpen:function(){jQuery("#w2ui-popup .w2ui-popup-message .w2ui-popup-button").on("click",function(n){w2popup.message(),typeof i=="function"&&i(n.target.id)})},onKeydown:function(n){switch(n.originalEvent.keyCode){case 13:typeof i=="function"&&i("Yes"),w2popup.message();break;case 27:typeof i=="function"&&i("No"),w2popup.message()}}}):w2popup.open({width:450,height:200,title:t,modal:!0,showClose:!1,body:'<div class="w2ui-centered"><div style="font-size: 13px;">'+n+"</div></div>",buttons:'<input id="No" type="button" value="'+w2utils.lang("No")+'" class="w2ui-popup-button"><input id="Yes" type="button" value="'+w2utils.lang("Yes")+'" class="w2ui-popup-button">',onOpen:function(n){n.onComplete=function(){jQuery("#w2ui-popup .w2ui-popup-button").on("click",function(n){w2popup.close(),typeof i=="function"&&i(n.target.id)})}},onKeydown:function(n){switch(n.originalEvent.keyCode){case 13:typeof i=="function"&&i("Yes"),w2popup.close();break;case 27:typeof i=="function"&&i("No"),w2popup.close()}}})},function(n){var t=function(t){this.box=null,this.name=null,this.active=null,this.tabs=[],this.right="",this.style="",this.onClick=null,this.onClose=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,n.extend(!0,this,w2obj.tabs,t)};n.fn.w2tabs=function(i){var e,r,f,u;if(typeof i!="object"&&i){if(w2ui[n(this).attr("name")])return u=w2ui[n(this).attr("name")],u[i].apply(u,Array.prototype.slice.call(arguments,1)),this;console.log("ERROR: Method "+i+" does not exist on jQuery.w2tabs")}else{if(!i||typeof i.name=="undefined"){console.log('ERROR: The parameter "name" is required but not supplied in $().w2tabs().');return}if(typeof w2ui[i.name]!="undefined"){console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+i.name+").");return}if(!w2utils.isAlphaNumeric(i.name)){console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). ');return}e=i.tabs,r=new t(i),n.extend(r,{tabs:[],handlers:[]});for(f in e)r.tabs[f]=n.extend({},t.prototype.tab,e[f]);return n(this).length!=0&&r.render(n(this)[0]),w2ui[r.name]=r,r}},t.prototype={tab:{id:null,text:"",hidden:!1,disabled:!1,closable:!1,hint:"",onClick:null,onRefresh:null,onClose:null},add:function(n){return this.insert(null,n)},insert:function(t,i){var r,f,e,i,u;n.isArray(i)||(i=[i]);for(r in i){if(String(i[r].id)=="undefined"){console.log('ERROR: The parameter "id" is required but not supplied. (obj: '+this.name+")");return}f=!0;for(e in this.tabs)if(this.tabs[e].id==i[r].id){f=!1;break}if(!f){console.log('ERROR: The parameter "id='+i[r].id+'" is not unique within the current tabs. (obj: '+this.name+")");return}if(!w2utils.isAlphaNumeric(i[r].id)){console.log('ERROR: The parameter "id='+i[r].id+'" must be alpha-numeric + "-_". (obj: '+this.name+")");return}i=n.extend({},i,i[r]),t==null||typeof t=="undefined"?this.tabs.push(i):(u=this.get(t,!0),this.tabs=this.tabs.slice(0,u).concat([i],this.tabs.slice(u))),this.refresh(i[r].id)}},remove:function(){for(var u=0,r,i=0;i<arguments.length;i++){if(r=this.get(arguments[i]),!r)return!1;u++,this.tabs.splice(this.get(r.id,!0),1),n(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(r.id)).remove()}return u},select:function(n){return this.get(n)==null||this.active==n?!1:(this.active=n,this.refresh(),!0)},set:function(t,i){var r=this.get(t,!0);return r==null?!1:(n.extend(this.tabs[r],i),this.refresh(t),!0)},get:function(n,t){var r,i;if(arguments.length==0){for(r=[],i=0;i<this.tabs.length;i++)this.tabs[i].id!=null&&r.push(this.tabs[i].id);return r}for(i in this.tabs)if(this.tabs[i].id==n)return t===!0?i:this.tabs[i];return null},show:function(){for(var i=0,n,t=0;t<arguments.length;t++)(n=this.get(arguments[t]),n&&n.hidden!==!1)&&(n.hidden=!1,this.refresh(n.id),i++);return i},hide:function(){for(var i=0,n,t=0;t<arguments.length;t++)(n=this.get(arguments[t]),n&&n.hidden!==!0)&&(n.hidden=!0,this.refresh(n.id),i++);return i},enable:function(){for(var r=0,t,i=0;i<arguments.length;i++)(t=this.get(arguments[i]),t&&t.disabled!==!1)&&(t.disabled=!1,this.refresh(t.id),r++);return r},disable:function(){for(var r=0,t,i=0;i<arguments.length;i++)(t=this.get(arguments[i]),t&&t.disabled!==!0)&&(t.disabled=!0,this.refresh(t.id),r++);return r},refresh:function(t){var s=+new Date,o,e,i,r,f,u;if(window.getSelection&&window.getSelection().removeAllRanges(),String(t)=="undefined")for(o in this.tabs)this.refresh(this.tabs[o].id);return(e=this.trigger({phase:"before",type:"refresh",target:typeof t!="undefined"?t:this.name,object:this.get(t)}),e.isCancelled===!0)?!1:(i=this.get(t),i==null)?void 0:(typeof i.caption!="undefined"&&(i.text=i.caption),r=n(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(i.id)),f=(i.closable?'<div class="w2ui-tab-close" onclick="w2ui[\''+this.name+"'].animateClose('"+i.id+"', event);\"></div>":"")+'\t<div class="w2ui-tab'+(this.active==i.id?" active":"")+(i.closable?" closable":"")+'" \t\ttitle="'+(typeof i.hint!="undefined"?i.hint:"")+'"\t\tonclick="w2ui[\''+this.name+"'].click('"+i.id+"', event);\">"+i.text+"</div>",r.length==0?(u="",i.hidden&&(u+="display: none;"),i.disabled&&(u+="opacity: 0.2; -moz-opacity: 0.2; -webkit-opacity: 0.2; -o-opacity: 0.2; filter:alpha(opacity=20);"),html='<td id="tabs_'+this.name+"_tab_"+i.id+'" style="'+u+'" valign="middle">'+f+"</td>",this.get(t,!0)!=this.tabs.length-1&&n(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(t,!0))+1].id)).length>0?n(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(t,!0))+1].id)).before(html):n(this.box).find("#tabs_"+this.name+"_right").before(html)):(r.html(f),i.hidden?r.css("display","none"):r.css("display",""),i.disabled?r.css({opacity:"0.2","-moz-opacity":"0.2","-webkit-opacity":"0.2","-o-opacity":"0.2",filter:"alpha(opacity=20)"}):r.css({opacity:"1","-moz-opacity":"1","-webkit-opacity":"1","-o-opacity":"1",filter:"alpha(opacity=100)"})),this.trigger(n.extend(e,{phase:"after"})),+new Date-s)},render:function(t){var u=+new Date,i=this.trigger({phase:"before",type:"render",target:this.name,box:t}),r;return i.isCancelled===!0?!1:(window.getSelection&&window.getSelection().removeAllRanges(),String(t)!="undefined"&&t!=null&&(n(this.box).find("> table #tabs_"+this.name+"_right").length>0&&n(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),this.box=t),!this.box)?void 0:(r='<table cellspacing="0" cellpadding="1" width="100%">\t<tr><td width="100%" id="tabs_'+this.name+'_right" align="right">'+this.right+"</td></tr></table>",n(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-tabs").html(r),n(this.box).length>0&&(n(this.box)[0].style.cssText+=this.style),this.trigger(n.extend(i,{phase:"after"})),this.refresh(),+new Date-u)},resize:function(){window.getSelection&&window.getSelection().removeAllRanges();var t=this.trigger({phase:"before",type:"resize",target:this.name});if(t.isCancelled===!0)return!1;this.trigger(n.extend(t,{phase:"after"}))},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});if(t.isCancelled===!0)return!1;n(this.box).find("> table #tabs_"+this.name+"_right").length>0&&n(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),delete w2ui[this.name],this.trigger(n.extend(t,{phase:"after"}))},click:function(t,i){var u=this.get(t),r;if(u==null||u.disabled||(r=this.trigger({phase:"before",type:"click",target:t,object:this.get(t),originalEvent:i}),r.isCancelled===!0))return!1;n(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)+" .w2ui-tab").removeClass("active"),this.active=u.id,this.trigger(n.extend(r,{phase:"after"})),this.refresh(t)},animateClose:function(t,i){var u=this.get(t),f,r;if(u==null||u.disabled||(f=this.trigger({phase:"before",type:"close",target:t,object:this.get(t),originalEvent:i}),f.isCancelled===!0))return!1;r=this,n(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(u.id)).css({"-webkit-transition":".2s","-moz-transition":"2s","-ms-transition":".2s","-o-transition":".2s",opacity:"0"}),setTimeout(function(){var t=n(r.box).find("#tabs_"+r.name+"_tab_"+w2utils.escapeId(u.id)).width();n(r.box).find("#tabs_"+r.name+"_tab_"+w2utils.escapeId(u.id)).html('<div style="width: '+t+'px; -webkit-transition: .2s; -moz-transition: .2s; -ms-transition: .2s; -o-transition: .2s"></div>'),setTimeout(function(){n(r.box).find("#tabs_"+r.name+"_tab_"+w2utils.escapeId(u.id)).find(":first-child").css({width:"0px"})},50)},200),setTimeout(function(){r.remove(t)},450),this.trigger(n.extend(f,{phase:"after"})),this.refresh()},animateInsert:function(t,i){var f,e,o,s,r,u;if(this.get(t)!=null&&n.isPlainObject(i)){f=!0;for(e in this.tabs)if(this.tabs[e].id==i.id){f=!1;break}if(!f){console.log('ERROR: The parameter "id='+i.id+'" is not unique within the current tabs. (obj: '+this.name+")");return}(o=n(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(i.id)),o.length==0)&&(typeof i.caption!="undefined"&&(i.text=i.caption),s='<div id="_tmp_tabs" class="w2ui-reset w2ui-tabs" style="position: absolute; top: -1000px;"><table cellspacing="0" cellpadding="1" width="100%"><tr><td id="_tmp_simple_tab" style="" valign="middle">'+(i.closable?'<div class="w2ui-tab-close"></div>':"")+'\t<div class="w2ui-tab '+(this.active==i.id?"active":"")+'">'+i.text+"</div></td></tr></table></div>",n("body").append(s),tabHTML='<div style="width: 1px; -webkit-transition: 0.2s; -moz-transition: 0.2s; -ms-transition: 0.2s; -o-transition: 0.2s;">&nbsp;</div>',r="",i.hidden&&(r+="display: none;"),i.disabled&&(r+="opacity: 0.2; -moz-opacity: 0.2; -webkit-opacity: 0.2; -o-opacity: 0.2; filter:alpha(opacity=20);"),html='<td id="tabs_'+this.name+"_tab_"+i.id+'" style="'+r+'" valign="middle">'+tabHTML+"</td>",this.get(t,!0)!=this.tabs.length&&n(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(t,!0))].id)).length>0?n(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(t,!0))].id)).before(html):n(this.box).find("#tabs_"+this.name+"_right").before(html),u=this,setTimeout(function(){var t=n("#_tmp_simple_tab").width();n("#_tmp_tabs").remove(),n("#tabs_"+u.name+"_tab_"+w2utils.escapeId(i.id)+" > div").css("width",t+"px")},1),setTimeout(function(){u.insert(t,i)},200))}}},n.extend(t.prototype,w2utils.event),w2obj.tabs=t}(jQuery),function(n){var t=function(t){this.box=null,this.name=null,this.items=[],this.right="",this.onClick=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,n.extend(!0,this,w2obj.toolbar,t)};n.fn.w2toolbar=function(i){var e,r,f,u;if(typeof i!="object"&&i){if(w2ui[n(this).attr("name")])return u=w2ui[n(this).attr("name")],u[i].apply(u,Array.prototype.slice.call(arguments,1)),this;console.log("ERROR: Method "+i+" does not exist on jQuery.w2toolbar")}else{if(!i||typeof i.name=="undefined"){console.log('ERROR: The parameter "name" is required but not supplied in $().w2toolbar().');return}if(typeof w2ui[i.name]!="undefined"){console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+i.name+").");return}if(!w2utils.isAlphaNumeric(i.name)){console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). ');return}e=i.items,r=new t(i),n.extend(r,{items:[],handlers:[]});for(f in e)r.items[f]=n.extend({},t.prototype.item,e[f]);return n(this).length!=0&&r.render(n(this)[0]),w2ui[r.name]=r,r}},t.prototype={item:{id:null,type:"button",text:"",html:"",img:null,icon:null,hidden:!1,disabled:!1,checked:!1,arrow:!0,hint:"",group:null,items:null,onClick:null},add:function(n){this.insert(null,n)},insert:function(i,r){var u,s,e,f,o;n.isArray(r)||(r=[r]);for(u in r){if(typeof r[u].type=="undefined"){console.log('ERROR: The parameter "type" is required but not supplied in w2toolbar.add() method.');return}if(n.inArray(String(r[u].type),["button","check","radio","drop","menu","break","html","spacer"])==-1){console.log('ERROR: The parameter "type" should be one of the following [button, check, radio, drop, menu, break, html, spacer] in w2toolbar.add() method.');return}if(typeof r[u].id=="undefined"){console.log('ERROR: The parameter "id" is required but not supplied in w2toolbar.add() method.');return}for(s=!0,e=0;e<this.items.length;e++)if(this.items[e].id==r[u].id){s=!1;return}if(!s){console.log('ERROR: The parameter "id" is not unique within the current toolbar.');return}if(!w2utils.isAlphaNumeric(r[u].id)){console.log('ERROR: The parameter "id" must be alpha-numeric + "-_".');return}f=n.extend({},t.prototype.item,r[u]),i==null||typeof i=="undefined"?this.items.push(f):(o=this.get(i,!0),this.items=this.items.slice(0,o).concat([f],this.items.slice(o))),this.refresh(f.id)}},remove:function(){for(var f=0,i,u,r=0;r<arguments.length;r++)(i=this.get(arguments[r]),i)&&(f++,n(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(i.id)).remove(),u=this.get(i.id,!0),u&&this.items.splice(u,1));return f},set:function(t,i){var r=this.get(t,!0);return r==null?!1:(n.extend(this.items[r],i),this.refresh(t),!0)},get:function(n,t){var r,i;if(arguments.length==0){for(r=[],i=0;i<this.items.length;i++)this.items[i].id!=null&&r.push(this.items[i].id);return r}for(i=0;i<this.items.length;i++)if(this.items[i].id==n)return t===!0?i:this.items[i];return null},show:function(){for(var r=0,i,t=0;t<arguments.length;t++)(i=this.get(arguments[t]),i)&&(r++,i.hidden=!1,this.refresh(i.id));return r},hide:function(){for(var r=0,i,t=0;t<arguments.length;t++)(i=this.get(arguments[t]),i)&&(r++,i.hidden=!0,this.refresh(i.id));return r},enable:function(){for(var r=0,i,t=0;t<arguments.length;t++)(i=this.get(arguments[t]),i)&&(r++,i.disabled=!1,this.refresh(i.id));return r},disable:function(){for(var r=0,i,t=0;t<arguments.length;t++)(i=this.get(arguments[t]),i)&&(r++,i.disabled=!0,this.refresh(i.id));return r},check:function(){for(var r=0,i,t=0;t<arguments.length;t++)(i=this.get(arguments[t]),i)&&(r++,i.checked=!0,this.refresh(i.id));return r},uncheck:function(){for(var r=0,i,t=0;t<arguments.length;t++)(i=this.get(arguments[t]),i)&&(r++,i.checked=!1,this.refresh(i.id));return r},render:function(t){var f=this.trigger({phase:"before",type:"render",target:this.name,box:t}),r,u,i;if(f.isCancelled===!0)return!1;if(typeof t!="undefined"&&t!=null&&(n(this.box).find("> table #tb_"+this.name+"_right").length>0&&n(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),this.box=t),this.box){for(r='<table cellspacing="0" cellpadding="0" width="100%"><tr>',u=0;u<this.items.length;u++)(i=this.items[u],(typeof i.id=="undefined"||i.id==null)&&(i.id="item_"+u),i!=null)&&(r+=i.type=="spacer"?'<td width="100%" id="tb_'+this.name+"_item_"+i.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+i.id+'" style="'+(i.hidden?"display: none":"")+'" \tclass="'+(i.disabled?"disabled":"")+'" valign="middle">'+this.getItemHTML(i)+"</td>");r+='<td width="100%" id="tb_'+this.name+'_right" align="right">'+this.right+"</td>",r+="</tr></table>",n(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(r),n(this.box).length>0&&(n(this.box)[0].style.cssText+=this.style),this.trigger(n.extend(f,{phase:"after"}))}},refresh:function(t){var o=+new Date,e,f,i,r,u;if(window.getSelection&&window.getSelection().removeAllRanges(),e=this.trigger({phase:"before",type:"refresh",target:typeof t!="undefined"?t:this.name,item:this.get(t)}),e.isCancelled===!0)return!1;if(typeof t=="undefined")for(f=0;f<this.items.length;f++)i=this.items[f],(typeof i.id=="undefined"||i.id==null)&&(i.id="item_"+f),this.refresh(i.id);if(i=this.get(t),i!=null)return r=n(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(i.id)),u=this.getItemHTML(i),r.length==0?(u=i.type=="spacer"?'<td width="100%" id="tb_'+this.name+"_item_"+i.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+i.id+'" style="'+(i.hidden?"display: none":"")+'" \tclass="'+(i.disabled?"disabled":"")+'" valign="middle">'+u+"</td>",this.get(t,!0)==this.items.length-1?n(this.box).find("#tb_"+this.name+"_right").before(u):n(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(this.items[parseInt(this.get(t,!0))+1].id)).before(u)):(r.html(u),i.hidden?r.css("display","none"):r.css("display",""),i.disabled?r.addClass("disabled"):r.removeClass("disabled")),this.trigger(n.extend(e,{phase:"after"})),+new Date-o},resize:function(){var i=+new Date,t;return(window.getSelection&&window.getSelection().removeAllRanges(),t=this.trigger({phase:"before",type:"resize",target:this.name}),t.isCancelled===!0)?!1:(this.trigger(n.extend(t,{phase:"after"})),+new Date-i)},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});if(t.isCancelled===!0)return!1;n(this.box).find("> table #tb_"+this.name+"_right").length>0&&n(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),n(this.box).html(""),delete w2ui[this.name],this.trigger(n.extend(t,{phase:"after"}))},getItemHTML:function(n){var t="",r,i;typeof n.caption!="undefined"&&(n.text=n.caption),typeof n.hint=="undefined"&&(n.hint=""),typeof n.text=="undefined"&&(n.text="");switch(n.type){case"menu":case"button":case"check":case"radio":case"drop":r="<td>&nbsp;</td>",n.img&&(r='<td><div class="w2ui-tb-image w2ui-icon '+n.img+'"></div></td>'),n.icon&&(r='<td><div class="w2ui-tb-image"><span class="'+n.icon+'"></span></div></td>'),t+='<table cellpadding="0" cellspacing="0" title="'+n.hint+'" class="w2ui-button '+(n.checked?"checked":"")+'"        onclick     = "var el=w2ui[\''+this.name+"']; if (el) el.click('"+n.id+'\', event);"        onmouseover = "'+(n.disabled?"":"$(this).addClass('over');")+'"       onmouseout  = "'+(n.disabled?"":"$(this).removeClass('over');")+'"       onmousedown = "'+(n.disabled?"":"$(this).addClass('down');")+'"       onmouseup   = "'+(n.disabled?"":"$(this).removeClass('down');")+'"><tr><td>  <table cellpadding="1" cellspacing="0">  <tr>'+r+(n.text!=""?'<td class="w2ui-tb-caption" nowrap>'+n.text+"</td>":"")+((n.type=="drop"||n.type=="menu")&&n.arrow!==!1?'<td class="w2ui-tb-down" nowrap>&nbsp;&nbsp;&nbsp;</td>':"")+"  </tr></table></td></tr></table>";break;case"break":t+='<table cellpadding="0" cellspacing="0"><tr>    <td><div class="w2ui-break">&nbsp;</div></td></tr></table>';break;case"html":t+='<table cellpadding="0" cellspacing="0"><tr>    <td nowrap>'+n.html+"</td></tr></table>"}return i="",typeof n.onRender=="function"&&(i=n.onRender.call(this,n.id,t)),typeof this.onRender=="function"&&(i=this.onRender(n.id,t)),i!=""&&typeof i!="undefined"&&(t=i),t},menuClick:function(t,i,r){var e,f,u;if(window.getSelection&&window.getSelection().removeAllRanges(),e=this,f=this.get(t),f&&!f.disabled){if(u=this.trigger({phase:"before",type:"click",target:typeof t!="undefined"?t:this.name,item:this.get(t),subItem:typeof i!="undefined"&&this.get(t)?this.get(t).items[i]:null,originalEvent:r}),u.isCancelled===!0)return!1;this.trigger(n.extend(u,{phase:"after"}))}},click:function(t,i){var f,r,o,e,u;if(window.getSelection&&window.getSelection().removeAllRanges(),f=this,r=this.get(t),r&&!r.disabled){if(o=this.trigger({phase:"before",type:"click",target:typeof t!="undefined"?t:this.name,item:this.get(t),originalEvent:i}),o.isCancelled===!0)return!1;if(n("#tb_"+this.name+"_item_"+w2utils.escapeId(r.id)+" table.w2ui-button").removeClass("down"),r.type=="radio"){for(e=0;e<this.items.length;e++)(u=this.items[e],u!=null&&u.id!=r.id&&u.type=="radio")&&u.group==r.group&&u.checked&&(u.checked=!1,this.refresh(u.id));r.checked=!0,n("#tb_"+this.name+"_item_"+w2utils.escapeId(r.id)+" table.w2ui-button").addClass("checked")}(r.type=="drop"||r.type=="menu")&&(r.checked?r.checked=!1:setTimeout(function(){function i(){r.checked=!1,r.checked?n("#tb_"+f.name+"_item_"+w2utils.escapeId(r.id)+" table.w2ui-button").addClass("checked"):n("#tb_"+f.name+"_item_"+w2utils.escapeId(r.id)+" table.w2ui-button").removeClass("checked"),f.refresh(r.id),n(document).off("click",i)}var t=n("#tb_"+f.name+"_item_"+w2utils.escapeId(r.id));n.isPlainObject(r.overlay)||(r.overlay={}),r.type=="drop"&&t.w2overlay(r.html,n.extend({left:(t.width()-50)/2,top:3},r.overlay)),r.type=="menu"&&t.w2menu(r.items,n.extend({left:(t.width()-50)/2,top:3},r.overlay,{select:function(n,t,i){f.menuClick(r.id,i,t)}}));n(document).on("click",i)},1)),(r.type=="check"||r.type=="drop"||r.type=="menu")&&(r.checked=!r.checked,r.checked?n("#tb_"+this.name+"_item_"+w2utils.escapeId(r.id)+" table.w2ui-button").addClass("checked"):n("#tb_"+this.name+"_item_"+w2utils.escapeId(r.id)+" table.w2ui-button").removeClass("checked")),this.trigger(n.extend(o,{phase:"after"}))}}},n.extend(t.prototype,w2utils.event),w2obj.toolbar=t}(jQuery),function(n){var t=function(t){this.name=null,this.box=null,this.sidebar=null,this.parent=null,this.nodes=[],this.menu=[],this.selected=null,this.img=null,this.icon=null,this.style="",this.topHTML="",this.bottomHTML="",this.keyboard=!0,this.onClick=null,this.onDblClick=null,this.onContextMenu=null,this.onMenuClick=null,this.onExpand=null,this.onCollapse=null,this.onKeydown=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,n.extend(!0,this,w2obj.sidebar,t)};n.fn.w2sidebar=function(i){var f,r,u;if(typeof i!="object"&&i){if(w2ui[n(this).attr("name")])return u=w2ui[n(this).attr("name")],u[i].apply(u,Array.prototype.slice.call(arguments,1)),this;console.log("ERROR: Method "+i+" does not exist on jQuery.w2sidebar")}else{if(!i||typeof i.name=="undefined"){console.log('ERROR: The parameter "name" is required but not supplied in $().w2sidebar().');return}if(typeof w2ui[i.name]!="undefined"){console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+i.name+").");return}if(!w2utils.isAlphaNumeric(i.name)){console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). ');return}return f=i.nodes,r=new t(i),n.extend(r,{handlers:[],nodes:[]}),typeof f!="undefined"&&r.add(r,f),n(this).length!=0&&r.render(n(this)[0]),r.sidebar=r,w2ui[r.name]=r,r}},t.prototype={node:{id:null,text:"",count:"",img:null,icon:null,nodes:[],style:"",selected:!1,expanded:!1,hidden:!1,disabled:!1,group:!1,plus:!1,onClick:null,onDblClick:null,onContextMenu:null,onExpand:null,onCollapse:null,parent:null,sidebar:null},add:function(n,t){return arguments.length==1&&(t=arguments[0],n=this),typeof n=="string"&&(n=this.get(n)),this.insert(n,null,t)},insert:function(i,r,u){var f,e,h,s,o;if(arguments.length==2){if(u=arguments[1],r=arguments[0],s=this.get(r),s==null)return o=u[f].caption!="undefined"?u[f].caption:u[f].text,console.log('ERROR: Cannot insert node "'+o+'" because cannot find node "'+r+'" to insert before.'),null;i=this.get(r).parent}typeof i=="string"&&(i=this.get(i)),n.isArray(u)||(u=[u]);for(f in u){if(typeof u[f].id=="undefined"){o=u[f].caption!="undefined"?u[f].caption:u[f].text,console.log('ERROR: Cannot insert node "'+o+'" because it has no id.');continue}if(this.get(this,u[f].id)!=null){o=u[f].caption!="undefined"?u[f].caption:u[f].text,console.log("ERROR: Cannot insert node with id="+u[f].id+" (text: "+o+") because another node with the same id already exists.");continue}if(e=n.extend({},t.prototype.node,u[f]),e.sidebar=this,e.parent=i,h=e.nodes,e.nodes=[],r==null)i.nodes.push(e);else{if(s=this.get(i,r,!0),s==null)return o=u[f].caption!="undefined"?u[f].caption:u[f].text,console.log('ERROR: Cannot insert node "'+o+'" because cannot find node "'+r+'" to insert before.'),null;i.nodes.splice(s,0,e)}typeof h!="undefined"&&h.length>0&&this.insert(e,null,h)}return this.refresh(i.id),e},remove:function(){for(var r=0,n,i,t=0;t<arguments.length;t++)(n=this.get(arguments[t]),n!=null)&&(i=this.get(n.parent,arguments[t],!0),i!=null)&&(n.parent.nodes.splice(i,1),r++);return r>0&&arguments.length==1?this.refresh(n.parent.id):this.refresh(),r},set:function(t,i,r){var u,f;if(arguments.length==2&&(r=i,i=t,t=this),this._tmp=null,typeof t=="string"&&(t=this.get(t)),t.nodes==null)return null;for(u=0;u<t.nodes.length;u++){if(t.nodes[u].id==i)return f=r.nodes,n.extend(t.nodes[u],r,{nodes:[]}),typeof f!="undefined"&&this.add(t.nodes[u],f),this.refresh(i),!0;if(this._tmp=this.set(t.nodes[u],i,r),this._tmp)return!0}return!1},get:function(n,t,i){if((arguments.length==1||arguments.length==2&&t===!0)&&(i=t,t=n,n=this),this._tmp=null,typeof n=="string"&&(n=this.get(n)),n.nodes==null)return null;for(var r=0;r<n.nodes.length;r++){if(n.nodes[r].id==t)return i===!0?r:n.nodes[r];if(this._tmp=this.get(n.nodes[r],t,i),this._tmp||this._tmp===0)return this._tmp}return this._tmp},hide:function(){for(var i=0,t,n=0;n<arguments.length;n++)(t=this.get(arguments[n]),t!=null)&&(t.hidden=!0,i++);return arguments.length==1?this.refresh(arguments[0]):this.refresh(),i},show:function(){for(var i=0,t,n=0;n<arguments.length;n++)(t=this.get(arguments[n]),t!=null)&&(t.hidden=!1,i++);return arguments.length==1?this.refresh(arguments[0]):this.refresh(),i},disable:function(){for(var i=0,n,t=0;t<arguments.length;t++)(n=this.get(arguments[t]),n!=null)&&(n.disabled=!0,n.selected&&this.unselect(n.id),i++);return arguments.length==1?this.refresh(arguments[0]):this.refresh(),i},enable:function(){for(var i=0,t,n=0;n<arguments.length;n++)(t=this.get(arguments[n]),t!=null)&&(t.disabled=!1,i++);return arguments.length==1?this.refresh(arguments[0]):this.refresh(),i},select:function(t){if(this.selected==t)return!1;this.unselect(this.selected);var i=this.get(t);if(!i)return!1;n(this.box).find("#node_"+w2utils.escapeId(t)).addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),i.selected=!0,this.selected=t},unselect:function(t){var i=this.get(t);return i?(i.selected=!1,n(this.box).find("#node_"+w2utils.escapeId(t)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),this.selected==t&&(this.selected=null),!0):!1},toggle:function(n){var t=this.get(n);if(t!=null){if(t.plus){this.set(n,{plus:!1}),this.expand(n),this.refresh(n);return}t.nodes.length!=0&&(this.get(n).expanded?this.collapse(n):this.expand(n))}},collapse:function(t){var r=this.get(t),i=this.trigger({phase:"before",type:"collapse",target:t,object:r});if(i.isCancelled===!0)return!1;n(this.box).find("#node_"+w2utils.escapeId(t)+"_sub").slideUp("fast"),n(this.box).find("#node_"+w2utils.escapeId(t)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">+</div>'),r.expanded=!1,this.trigger(n.extend(i,{phase:"after"})),this.resize()},collapseAll:function(n){if(typeof n=="undefined"&&(n=this),typeof n=="string"&&(n=this.get(n)),n.nodes==null)return null;for(var t=0;t<n.nodes.length;t++)n.nodes[t].expanded===!0&&(n.nodes[t].expanded=!1),n.nodes[t].nodes&&n.nodes[t].nodes.length>0&&this.collapseAll(n.nodes[t]);this.refresh(n.id)},expand:function(t){var r=this.get(t),i=this.trigger({phase:"before",type:"expand",target:t,object:r});if(i.isCancelled===!0)return!1;n(this.box).find("#node_"+w2utils.escapeId(t)+"_sub").slideDown("fast"),n(this.box).find("#node_"+w2utils.escapeId(t)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">-</div>'),r.expanded=!0,this.trigger(n.extend(i,{phase:"after"})),this.resize()},expandAll:function(n){if(typeof n=="undefined"&&(n=this),typeof n=="string"&&(n=this.get(n)),n.nodes==null)return null;for(var t=0;t<n.nodes.length;t++)n.nodes[t].expanded===!1&&(n.nodes[t].expanded=!0),n.nodes[t].nodes&&n.nodes[t].nodes.length>0&&this.collapseAll(n.nodes[t]);this.refresh(n.id)},expandParents:function(n){var t=this.get(n);t!=null&&(t.parent&&(t.parent.expanded=!0,this.expandParents(t.parent.id)),this.refresh(n))},click:function(t,i){var r=this,f=this.get(t),u;f!=null&&((u=this.selected,f.disabled||f.group)||(n(r.box).find("#node_"+w2utils.escapeId(u)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),n(r.box).find("#node_"+w2utils.escapeId(t)).addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),setTimeout(function(){var e=r.trigger({phase:"before",type:"click",target:t,originalEvent:i,object:f});if(e.isCancelled===!0)return n(r.box).find("#node_"+w2utils.escapeId(t)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),n(r.box).find("#node_"+w2utils.escapeId(u)).addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),!1;u!=null&&(r.get(u).selected=!1),r.get(t).selected=!0,r.selected=t,r.trigger(n.extend(e,{phase:"after"}))},1)))},keydown:function(t){function f(n,t){var u;if(n==null)return null;var e=n.parent,o=i.get(n.id,!0),r=null;return n.expanded&&n.nodes.length>0&&t!==!0?(u=n.nodes[0],r=u.disabled||u.group?f(u):u):r=e&&o+1<e.nodes.length?e.nodes[o+1]:f(e,!0),r!=null&&(r.disabled||r.group)&&(r=f(r)),r}function e(n){var r;if(n==null)return null;var f=n.parent,u=i.get(n.id,!0),t=null,o=!1;return u>0?(t=f.nodes[u-1],t.expanded&&t.nodes.length>0&&(r=t.nodes[t.nodes.length-1],t=r.disabled||r.group?e(r):r)):(t=f,o=!0),t!=null&&(t.disabled||t.group)&&(t=e(t)),t}var i=this,r=i.get(i.selected),o,u;if(r&&i.keyboard===!0){if(o=i.trigger({phase:"before",type:"keydown",target:i.name,originalEvent:t}),o.isCancelled===!0)return!1;(t.keyCode==13||t.keyCode==32)&&r.nodes.length>0&&i.toggle(i.selected),t.keyCode==37&&(r.nodes.length>0?i.collapse(i.selected):!r.parent||r.parent.disabled||r.parent.group||(i.collapse(r.parent.id),i.click(r.parent.id),setTimeout(function(){i.scrollIntoView()},50))),t.keyCode==39&&r.nodes.length>0&&i.expand(i.selected),t.keyCode==38&&(u=e(r),u!=null&&(i.click(u.id,t),setTimeout(function(){i.scrollIntoView()},50))),t.keyCode==40&&(u=f(r),u!=null&&(i.click(u.id,t),setTimeout(function(){i.scrollIntoView()},50))),n.inArray(t.keyCode,[13,32,37,38,39,40])!=-1&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()),i.trigger(n.extend(o,{phase:"after"}));return}},scrollIntoView:function(t){var f;if(typeof t=="undefined"&&(t=this.selected),f=this.get(t),f!=null){var i=n(this.box).find(".w2ui-sidebar-div"),u=n(this.box).find("#node_"+w2utils.escapeId(t)),r=u.offset().top-i.offset().top;r+u.height()>i.height()&&i.animate({scrollTop:i.scrollTop()+i.height()/1.3}),r<=0&&i.animate({scrollTop:i.scrollTop()-i.height()/1.3})}},dblClick:function(t,i){window.getSelection&&window.getSelection().removeAllRanges();var u=this.get(t),r=this.trigger({phase:"before",type:"dblClick",target:t,originalEvent:i,object:u});if(r.isCancelled===!0)return!1;u.nodes.length>0&&this.toggle(t),this.trigger(n.extend(r,{phase:"after"}))},contextMenu:function(t,i){var r=this,u=r.get(t);t!=r.selected&&r.click(t),setTimeout(function(){var f=r.trigger({phase:"before",type:"contextMenu",target:t,originalEvent:i,object:u});if(f.isCancelled===!0)return!1;u.group||u.disabled||(r.menu.length>0&&n(r.box).find("#node_"+w2utils.escapeId(t)).w2menu(r.menu,{left:(i?i.offsetX||i.pageX:50)-25,select:function(n,i,u){r.menuClick(t,u,i)}}),r.trigger(n.extend(f,{phase:"after"})))},1)},menuClick:function(t,i,r){var u=this,f=u.trigger({phase:"before",type:"menuClick",target:t,originalEvent:r,menuIndex:i,menuItem:u.menu[i]});if(f.isCancelled===!0)return!1;u.trigger(n.extend(f,{phase:"after"}))},render:function(t){var i=this.trigger({phase:"before",type:"render",target:this.name,box:t});if(i.isCancelled===!0)return!1;(typeof t!="undefined"&&t!=null&&(n(this.box).find("> div > div.w2ui-sidebar-div").length>0&&n(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),this.box=t),this.box)&&(n(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-sidebar").html('<div><div class="w2ui-sidebar-top"></div><div class="w2ui-sidebar-div"></div><div class="w2ui-sidebar-bottom"></div></div>'),n(this.box).find("> div").css({width:n(this.box).width()+"px",height:n(this.box).height()+"px"}),n(this.box).length>0&&(n(this.box)[0].style.cssText+=this.style),this.topHTML!=""&&(n(this.box).find(".w2ui-sidebar-top").html(this.topHTML),n(this.box).find(".w2ui-sidebar-div").css("top",n(this.box).find(".w2ui-sidebar-top").height()+"px")),this.bottomHTML!=""&&(n(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),n(this.box).find(".w2ui-sidebar-div").css("bottom",n(this.box).find(".w2ui-sidebar-bottom").height()+"px")),this.trigger(n.extend(i,{phase:"after"})),this.refresh())},refresh:function(t){function h(n){var e="",f=n.img,i,u,t;for(f==null&&(f=this.img),i=n.icon,i==null&&(i=this.icon),t=n.parent,u=0;t&&t.parent!=null;)t.group&&u--,t=t.parent,u++;return typeof n.caption!="undefined"&&(n.text=n.caption),n.group?e='<div class="w2ui-node-group"  id="node_'+n.id+'"\t\tonclick="w2ui[\''+r.name+"'].toggle('"+n.id+"'); \t\t\t\t var sp=$(this).find('span:nth-child(1)'); if (sp.html() == '"+w2utils.lang("Hide")+"') sp.html('"+w2utils.lang("Show")+"'); else sp.html('"+w2utils.lang("Hide")+"');\"\t\tonmouseout=\"$(this).find('span:nth-child(1)').css('color', 'transparent')\" \t\tonmouseover=\"$(this).find('span:nth-child(1)').css('color', 'inherit')\">\t<span>"+(!n.hidden&&n.expanded?w2utils.lang("Hide"):w2utils.lang("Show"))+"</span>\t<span>"+n.text+'</span></div><div class="w2ui-node-sub" id="node_'+n.id+'_sub" style="'+n.style+";"+(!n.hidden&&n.expanded?"":"display: none;")+'"></div>':(n.selected&&!n.disabled&&(r.selected=n.id),t="",f&&(t='<div class="w2ui-node-image w2ui-icon '+f+(n.selected&&!n.disabled?" w2ui-icon-selected":"")+'"></div>'),i&&(t='<div class="w2ui-node-image"><span class="'+i+'"></span></div>'),e='<div class="w2ui-node '+(n.selected?"w2ui-selected":"")+" "+(n.disabled?"w2ui-disabled":"")+'" id="node_'+n.id+'" style="'+(n.hidden?"display: none;":"")+'"\tondblclick="w2ui[\''+r.name+"'].dblClick('"+n.id+"', event);\"\toncontextmenu=\"w2ui['"+r.name+"'].contextMenu('"+n.id+"', event); \t\tif (event.preventDefault) event.preventDefault();\"\tonClick=\"w2ui['"+r.name+"'].click('"+n.id+'\', event); "><table cellpadding="0" cellspacing="0" style="margin-left:'+u*18+"px; padding-right:"+u*18+'px"><tr><td class="w2ui-node-dots" nowrap onclick="w2ui[\''+r.name+"'].toggle('"+n.id+'\'); \t\tif (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">\t<div class="w2ui-expand">'+(n.nodes.length>0?n.expanded?"-":"+":n.plus?"+":"")+'</div></td><td class="w2ui-node-data" nowrap>'+t+(n.count!==""?'<div class="w2ui-node-count">'+n.count+"</div>":"")+'<div class="w2ui-node-caption">'+n.text+'</div></td></tr></table></div><div class="w2ui-node-sub" id="node_'+n.id+'_sub" style="'+n.style+";"+(!n.hidden&&n.expanded?"":"display: none;")+'"></div>'),e}var c=+new Date,s,r,i,f,o,u,e;if(window.getSelection&&window.getSelection().removeAllRanges(),s=this.trigger({phase:"before",type:"refresh",target:typeof t!="undefined"?t:this.name}),s.isCancelled===!0)return!1;if(this.topHTML!=""&&(n(this.box).find(".w2ui-sidebar-top").html(this.topHTML),n(this.box).find(".w2ui-sidebar-div").css("top",n(this.box).find(".w2ui-sidebar-top").height()+"px")),this.bottomHTML!=""&&(n(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),n(this.box).find(".w2ui-sidebar-div").css("bottom",n(this.box).find(".w2ui-sidebar-bottom").height()+"px")),n(this.box).find("> div").css({width:n(this.box).width()+"px",height:n(this.box).height()+"px"}),r=this,typeof t=="undefined")i=this,f=".w2ui-sidebar-div";else{if(i=this.get(t),i==null)return;f="#node_"+w2utils.escapeId(i.id)+"_sub"}for(i!=this&&(o="#node_"+w2utils.escapeId(i.id),e=h(i),n(this.box).find(o).before('<div id="sidebar_'+this.name+'_tmp"></div>'),n(this.box).find(o).remove(),n(this.box).find(f).remove(),n("#sidebar_"+this.name+"_tmp").before(e),n("#sidebar_"+this.name+"_tmp").remove()),n(this.box).find(f).html(""),u=0;u<i.nodes.length;u++)e=h(i.nodes[u]),n(this.box).find(f).append(e),i.nodes[u].nodes.length!=0&&this.refresh(i.nodes[u].id);return this.trigger(n.extend(s,{phase:"after"})),+new Date-c},resize:function(){var i=+new Date,t;return(window.getSelection&&window.getSelection().removeAllRanges(),t=this.trigger({phase:"before",type:"resize",target:this.name}),t.isCancelled===!0)?!1:(n(this.box).css("overflow","hidden"),n(this.box).find("> div").css({width:n(this.box).width()+"px",height:n(this.box).height()+"px"}),this.trigger(n.extend(t,{phase:"after"})),+new Date-i)},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});if(t.isCancelled===!0)return!1;n(this.box).find("> div > div.w2ui-sidebar-div").length>0&&n(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),delete w2ui[this.name],this.trigger(n.extend(t,{phase:"after"}))},lock:function(t,i){var r=n(this.box).find("> div:first-child");w2utils.lock(r,t,i)},unlock:function(){w2utils.unlock(this.box)}},n.extend(t.prototype,w2utils.event),w2obj.sidebar=t}(jQuery),function(n){var t=new function(){this.customTypes=[]};n.fn.w2field=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object")return t.init.apply(this,arguments);if(typeof n=="string")return t.init.apply(this,[{type:n}]);console.log("ERROR: Method "+n+" does not exist on jQuery.w2field")},n.extend(t,{init:function(i){var r=t;return n(this).each(function(){var l,s,y,f,h,o,c,a;if(typeof t.customTypes[i.type.toLowerCase()]=="function"){t.customTypes[i.type.toLowerCase()].call(this,i);return}l=i.type.toLowerCase();switch(l){case"clear":n(this).off("focus").off("blur").off("keypress").off("keydown").off("change").removeData(),n(this).prev().hasClass("w2ui-list")&&(n(this).prev().remove(),n(this).removeAttr("tabindex").css("border-color","").show()),n(this).prev().hasClass("w2ui-upload")&&(n(this).prev().remove(),n(this).removeAttr("tabindex").css("border-color","").show()),n(this).prev().hasClass("w2ui-field-helper")&&(n(this).css("padding-left",n(this).css("padding-top")),n(this).prev().remove()),n(this).next().hasClass("w2ui-field-helper")&&(n(this).css("padding-right",n(this).css("padding-top")),n(this).next().remove()),n(this).next().hasClass("w2ui-field-helper")&&n(this).next().remove();break;case"text":case"int":case"float":case"money":case"alphanumeric":case"hex":s=this,h={min:null,max:null,arrows:!1,keyboard:!0,suffix:"",prefix:""},i=n.extend({},h,i),["text","alphanumeric","hex"].indexOf(l)!=-1&&(i.arrows=!1,i.keyboard=!1);n(this).data("options",i).on("keypress",function(t){if(!t.metaKey&&!t.ctrlKey&&!t.altKey&&(t.charCode==t.keyCode||!(t.keyCode>0))){t.keyCode==13&&n(this).change();var i=String.fromCharCode(t.charCode);if(!v(i,!0))return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,!1}}).on("keydown",function(t,r){var e,u,o,f;if(i.keyboard){e=!1,u=n(s).val(),u=v(u)?parseFloat(u):i.min||0,o=t.keyCode||r.keyCode,f=1,(t.ctrlKey||t.metaKey)&&(f=10);switch(o){case 38:n(s).val(u+f<=i.max||i.max==null?u+f:i.max).change(),l=="money"&&n(s).val(Number(n(s).val()).toFixed(2)),e=!0;break;case 40:n(s).val(u-f>=i.min||i.min==null?u-f:i.min).change(),l=="money"&&n(s).val(Number(n(s).val()).toFixed(2)),e=!0}e&&(t.preventDefault(),setTimeout(function(){s.setSelectionRange(s.value.length,s.value.length)},0))}}).on("change",function(t){var r=n(s).val(),u=!1;if(i.min!=null&&r!=""&&r<i.min&&(n(s).val(i.min).change(),u=!0),i.max!=null&&r!=""&&r>i.max&&(n(s).val(i.max).change(),u=!0),u)return t.stopPropagation(),t.preventDefault(),!1;this.value==""||v(this.value)||n(this).val(i.min!=null?i.min:"")});if(n(this).val()==""&&i.min!=null&&n(this).val(i.min),i.prefix!=""){n(this).before('<div class="w2ui-field-helper">'+i.prefix+"</div>"),o=n(this).prev();o.css({color:n(this).css("color"),"font-family":n(this).css("font-family"),"font-size":n(this).css("font-size"),"padding-top":n(this).css("padding-top"),"padding-bottom":n(this).css("padding-bottom"),"padding-left":n(this).css("padding-left"),"padding-right":0,"margin-top":parseInt(n(this).css("margin-top"))+1+"px","margin-bottom":parseInt(n(this).css("margin-bottom"))+1+"px","margin-left":0,"margin-right":0}).on("click",function(){n(this).next().focus()});n(this).css("padding-left",o.width()+parseInt(n(this).css("padding-left"))+5+"px")}if(c=parseInt(n(this).css("padding-right")),i.arrows!=""){n(this).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&nbsp;\t<div class="w2ui-field-up" type="up">\t\t<div class="arrow-up" type="up"></div>\t</div>\t<div class="w2ui-field-down" type="down">\t\t<div class="arrow-down" type="down"></div>\t</div>\t<div style="position: absolute; height: 1px; border-top: 1px solid red"></div></div>'),y=w2utils.getSize(this,"height"),o=n(this).next();o.css({color:n(this).css("color"),"font-family":n(this).css("font-family"),"font-size":n(this).css("font-size"),height:n(this).height()+parseInt(n(this).css("padding-top"))+parseInt(n(this).css("padding-bottom"))+"px",padding:"0px","margin-top":parseInt(n(this).css("margin-top"))+1+"px","margin-bottom":"0px","border-left":"1px solid silver"}).css("margin-left","-"+(o.width()+parseInt(n(this).css("margin-right"))+12)+"px").on("mousedown",function(t){function r(){clearTimeout(n("body").data("_field_update_timer")),n("body").off("mouseup",r)}function i(t){n(s).focus().trigger(n.Event("keydown"),{keyCode:n(u.target).attr("type")=="up"?38:40}),t!==!1&&n("body").data("_field_update_timer",setTimeout(i,60))}var f=this,u=t;n("body").on("mouseup",r);n("body").data("_field_update_timer",setTimeout(i,700)),i(!1)});c+=o.width()+12,n(this).css("padding-right",c+"px")}if(i.suffix!=""){n(this).after('<div class="w2ui-field-helper">'+i.suffix+"</div>"),o=n(this).next();o.css({color:n(this).css("color"),"font-family":n(this).css("font-family"),"font-size":n(this).css("font-size"),"padding-top":n(this).css("padding-top"),"padding-bottom":n(this).css("padding-bottom"),"padding-left":"3px","padding-right":n(this).css("padding-right"),"margin-top":parseInt(n(this).css("margin-top"))+1+"px","margin-bottom":parseInt(n(this).css("margin-bottom"))+1+"px"}).on("click",function(){n(this).prev().focus()});o.css("margin-left","-"+(o.width()+parseInt(n(this).css("padding-right"))+5)+"px"),c+=o.width()+3,n(this).css("padding-right",c+"px")}function v(n,t){switch(l){case"int":return t&&["-"].indexOf(n)!=-1?!0:w2utils.isInt(n);case"float":return t&&["-","."].indexOf(n)!=-1?!0:w2utils.isFloat(n);case"money":return t&&["-",".","$","€","£","¥"].indexOf(n)!=-1?!0:w2utils.isMoney(n);case"hex":return w2utils.isHex(n);case"alphanumeric":return w2utils.isAlphaNumeric(n)}return!0}break;case"date":f=this,h={format:w2utils.settings.date_format,start:"",end:"",blocked:{},colored:{}},i=n.extend({},h,i);n(this).css({transition:"none","-webkit-transition":"none","-moz-transition":"none","-ms-transition":"none","-o-transition":"none"}).data("options",i).on("focus",function(){var e=parseFloat(n(f).offset().top)+parseFloat(f.offsetHeight),u=parseFloat(n(f).offset().left),t,r;clearInterval(n(f).data("mtimer")),n("#global_calendar_div").remove(),n("body").append('<div id="global_calendar_div" style="top: '+(e+parseInt(f.offsetHeight))+"px; left: "+u+'px;"  class="w2ui-reset w2ui-calendar"  onmousedown="\t\tif (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; \t\tif (event.preventDefault) event.preventDefault(); else return false;"></div>'),n("#global_calendar_div").html(n().w2field("calendar_get",f.value,i)).css({left:u+"px",top:e+"px"}).data("el",f).show(),t=n(window).width()+n(document).scrollLeft()-1,u+n("#global_calendar_div").width()>t&&n("#global_calendar_div").css("left",t-n("#global_calendar_div").width()+"px"),r=setInterval(function(){var i=n(window).width()+n(document).scrollLeft()-1,t=n(f).offset().left;if(t+n("#global_calendar_div").width()>i&&(t=i-n("#global_calendar_div").width()),n("#global_calendar_div").data("position")!=n(f).offset().left+"x"+(n(f).offset().top+f.offsetHeight)&&n("#global_calendar_div").css({"-webkit-transition":".2s",left:t+"px",top:n(f).offset().top+f.offsetHeight+"px"}).data("position",n(f).offset().left+"x"+(n(f).offset().top+f.offsetHeight)),n(f).length==0||n(f).offset().left==0&&n(f).offset().top==0){clearInterval(r),n("#global_calendar_div").remove();return}},100),n(f).data("mtimer",r)}).on("blur",function(){n(f).val(n.trim(n(f).val())),n.trim(n(f).val())==""||w2utils.isDate(n(f).val(),i.format)||n(this).w2tag(w2utils.lang("Not a valid date")+": "+i.format),clearInterval(n(f).data("mtimer")),n("#global_calendar_div").remove()}).on("keypress",function(){var r=this;setTimeout(function(){n("#global_calendar_div").html(n().w2field("calendar_get",r.value,i))},10)});setTimeout(function(){w2utils.isInt(f.value)&&(f.value=w2utils.formatDate(f.value,i.format))},1);break;case"time":break;case"datetime":break;case"color":f=this,h={prefix:"#",suffix:'<div style="margin-top: 1px; height: 12px; width: 12px;"></div>'},i=n.extend({},h,i);n(this).attr("maxlength",6).on("focus",function(){var u=parseFloat(n(f).offset().top)+parseFloat(f.offsetHeight),r=parseFloat(n(f).offset().left),t,i;clearInterval(n(f).data("mtimer")),n("#global_color_div").remove(),n("body").append('<div id="global_color_div" style="top: '+(u+parseInt(f.offsetHeight))+"px; left: "+r+'px;"  class="w2ui-reset w2ui-calendar"  onmousedown="\t\tif (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; \t\tif (event.preventDefault) event.preventDefault(); else return false;"></div>'),n("#global_color_div").html(n().w2field("getColorHTML",f.value)).css({left:r+"px",top:u+"px"}).data("el",f).show(),t=n(window).width()+n(document).scrollLeft()-1,r+n("#global_color_div").width()>t&&n("#global_color_div").css("left",t-n("#global_color_div").width()+"px"),i=setInterval(function(){var r=n(window).width()+n(document).scrollLeft()-1,t=n(f).offset().left;if(t+n("#global_color_div").width()>r&&(t=r-n("#global_color_div").width()),n("#global_color_div").data("position")!=n(f).offset().left+"x"+(n(f).offset().top+f.offsetHeight)&&n("#global_color_div").css({"-webkit-transition":".2s",left:t+"px",top:n(f).offset().top+f.offsetHeight+"px"}).data("position",n(f).offset().left+"x"+(n(f).offset().top+f.offsetHeight)),n(f).length==0||n(f).offset().left==0&&n(f).offset().top==0){clearInterval(i),n("#global_color_div").remove();return}},100),n(f).data("mtimer",i)}).on("click",function(){n(this).trigger("focus")}).on("blur",function(){n(f).val(n.trim(n(f).val())),clearInterval(n(f).data("mtimer")),n("#global_color_div").remove()}).on("keydown",function(t){if(t.keyCode==86&&(t.ctrlKey||t.metaKey)){var i=this;n(this).prop("maxlength",7),setTimeout(function(){var t=n(i).val();t.substr(0,1)=="#"&&(t=t.substr(1)),w2utils.isHex(t)||(t=""),n(i).val(t).prop("maxlength",6).change()},20)}}).on("keyup",function(t){t.keyCode==86&&(t.ctrlKey||t.metaKey)&&n(this).prop("maxlength",6)}).on("keypress",function(t){t.keyCode==13&&n(this).change();var i=String.fromCharCode(t.charCode);if(!w2utils.isHex(i,!0))return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,!1}).on("change",function(){var i="#"+n(this).val();n(this).val().length!=6&&n(this).val().length!=3&&(i=""),n(this).next().find("div").css("background-color",i)});if(i.prefix!=""){n(this).before('<div class="w2ui-field-helper">'+i.prefix+"</div>"),o=n(this).prev();o.css({color:n(this).css("color"),"font-family":n(this).css("font-family"),"font-size":n(this).css("font-size"),"padding-top":n(this).css("padding-top"),"padding-bottom":n(this).css("padding-bottom"),"padding-left":n(this).css("padding-left"),"padding-right":0,"margin-top":parseInt(n(this).css("margin-top"))+1+"px","margin-bottom":parseInt(n(this).css("margin-bottom"))+1+"px","margin-left":0,"margin-right":0}).on("click",function(){n(this).next().focus()});n(this).css("padding-left",o.width()+parseInt(n(this).css("padding-left"))+2+"px")}if(i.suffix!=""){n(this).after('<div class="w2ui-field-helper">'+i.suffix+"</div>"),o=n(this).next();o.css({color:n(this).css("color"),"font-family":n(this).css("font-family"),"font-size":n(this).css("font-size"),"padding-top":n(this).css("padding-top"),"padding-bottom":n(this).css("padding-bottom"),"padding-left":"3px","padding-right":n(this).css("padding-right"),"margin-top":parseInt(n(this).css("margin-top"))+1+"px","margin-bottom":parseInt(n(this).css("margin-bottom"))+1+"px"}).on("click",function(){n(this).prev().focus()});o.css("margin-left","-"+(o.width()+parseInt(n(this).css("padding-right"))+4)+"px"),c=o.width()+parseInt(n(this).css("padding-right"))+4,n(this).css("padding-right",c+"px"),o.find("div").css("background-color","#"+n(f).val())}break;case"select":case"list":if(this.tagName!="SELECT"){console.log("ERROR: You can only apply $().w2field('list') to a SELECT element");return}var h={url:"",items:[],value:null,showNone:!0},f=this,e=n.extend({},h,i);n(f).data("settings",e),f.refresh=function(){var i=n(f).data("settings"),e="",r=t.cleanItems(i.items),u;i.showNone&&(e='<option value="">- '+w2utils.lang("none")+" -</option>");for(u in r)i.showNone||i.value!=null||(i.value=r[u].id),e+='<option value="'+r[u].id+'">'+r[u].text+"</option>";n(f).html(e),n(f).val(i.value),n(f).val()!=i.value&&n(f).change()},e.url!=""?n.ajax({type:"GET",dataType:"text",url:e.url,complete:function(i,r){if(r=="success"){var e=n.parseJSON(i.responseText),u=n(f).data("settings");u.items=t.cleanItems(e.items),n(f).data("settings",u),f.refresh()}}}):f.refresh();break;case"enum":if(this.tagName!="INPUT"){console.log("ERROR: You can only apply $().w2field('enum') to an INPUT element");return}var h={url:"",items:[],selected:[],max:0,maxHeight:172,showAll:!1,match:"begins with",render:null,maxCache:500,onShow:null,onHide:null,onAdd:null,onRemove:null,onItemOver:null,onItemOut:null,onItemClick:null},f=this,e=n.extend({},h,i);e.items=t.cleanItems(e.items),e.selected=t.cleanItems(e.selected),n(this).data("selected",e.selected),n(this).css({padding:"0px","border-color":"transparent","background-color":"transparent",outline:"none"}),this.add=function(t){var i,r,u;n(this).attr("readonly")||(i=n(this).data("selected"),r=n(this).data("settings"),typeof r.onAdd!="function"||(u=r.onAdd(t,r),u!==!1))&&(n.isArray(i)||(i=[]),r.max!=0&&r.max<=i.length&&i.splice(i.length-1,1),i.push(t),n(this).data("last_del",null),n(this).trigger("change"))},this.remove=function(i){var r=n(this).data("settings"),u;(typeof r.onRemove!="function"||(u=r.onRemove(i,r),u!==!1))&&(n(this).attr("readonly")||(n(this).data("selected").splice(i,1),n(this).parent().find("[title=Remove][index="+i+"]").remove(),this.refresh(),t.list_render.call(this),n(this).trigger("change")))},this.show=function(){var i,u,r;if(!n(this).attr("readonly")){if(i=n(this).data("settings"),n("#w2ui-global-items").length==0)n("body").append('<div id="w2ui-global-items" class="w2ui-reset w2ui-items"></div>');else return;u=n("#w2ui-global-items"),u.css({display:"block",left:n(f).offset().left+"px",top:n(f).offset().top+f.offsetHeight+3+"px"}).width(w2utils.getSize(f,"width")).data("position",n(f).offset().left+"x"+(n(f).offset().top+f.offsetHeight)),t.list_render.call(f),r=function(){var i=n("#w2ui-global-items");if(n(f).length==0||n(f).offset().left==0&&n(f).offset().top==0){clearInterval(n(f).data("mtimer")),hide();return}i.data("position")!=n(f).offset().left+"x"+(n(f).offset().top+f.offsetHeight)&&(i.css({"-webkit-transition":".2s",left:n(f).offset().left+"px",top:n(f).offset().top+f.offsetHeight+3+"px"}).data("position",n(f).offset().left+"x"+(n(f).offset().top+f.offsetHeight)),setTimeout(function(){t.list_render.call(f,n(f).data("last_search"))},200)),i.length>0&&n(f).data("mtimer",setTimeout(r,100))},n(f).data("mtimer",setTimeout(r,100)),typeof i.onShow=="function"&&i.onShow.call(this,i)}},this.hide=function(){var t=n(this).data("settings");clearTimeout(n(f).data("mtimer")),n("#w2ui-global-items").remove(),typeof t.onHide=="function"&&t.onHide.call(this,t)},this.refresh=function(){var r=this,i,t;n(n(this).data("div")).remove();var o="margin-top: "+n(this).css("margin-top")+"; margin-bottom: "+n(this).css("margin-bottom")+"; margin-left: "+n(this).css("margin-left")+"; margin-right: "+n(this).css("margin-right")+"; width: "+(w2utils.getSize(this,"width")-parseInt(n(this).css("margin-left"))-parseInt(n(this).css("margin-right")))+"px; ",u='<div class="w2ui-list" style="'+o+';"><div style="padding: 0px; margin: 0px; display: inline-block"><ul>',f=n(this).data("selected");for(i in f)u+='<li style="'+(n(this).data("last_del")==i?"opacity: 0.5":"")+'">\t<div title="'+w2utils.lang("Remove")+'" index="'+i+'">&nbsp;&nbsp;</div>'+f[i].text+"</li>";u+='<li style="padding-left: 0px; padding-right: 0px" class="nomouse">\t<input type="text" '+(n(this).attr("readonly")?"readonly":"")+' style="background-color: transparent"></li></ul></div></div>',n(this).before(u),t=n(this).prev()[0],n(this).data("div",t);n(t).find("li").data("mouse","out").on("click",function(t){if(!n(t.target).hasClass("nomouse")){if(t.target.title==w2utils.lang("Remove")){r.remove(n(t.target).attr("index"));return}t.stopPropagation(),typeof e.onItemClick=="function"&&e.onItemClick.call(this,e)}}).on("mouseover",function(t){var i=t.target;(i.tagName!="LI"&&(i=i.parentNode),n(i).hasClass("nomouse"))||(n(i).data("mouse")=="out"&&typeof e.onItemOver=="function"&&e.onItemOver.call(this,e),n(i).data("mouse","over"))}).on("mouseout",function(t){var i=t.target;(i.tagName!="LI"&&(i=i.parentNode),n(i).hasClass("nomouse"))||(n(i).data("mouse","leaving"),setTimeout(function(){n(i).data("mouse")=="leaving"&&(n(i).data("mouse","out"),typeof e.onItemOut=="function"&&e.onItemOut.call(this,e))},0))});n(t).on("click",function(){n(this).find("input").focus()}).find("input").on("focus",function(i){n(t).css({outline:"auto 5px -webkit-focus-ring-color","outline-offset":"-2px"}),r.show(),i.stopPropagation?i.stopPropagation():i.cancelBubble=!0}).on("blur",function(i){n(t).css("outline","none"),r.hide(),i.stopPropagation?i.stopPropagation():i.cancelBubble=!0});r.resize()},this.resize=function(){var r=n(this).data("settings"),i=n(this).prev(),t=n(i).find(">div").height();t<23&&(t=23),t>r.maxHeight&&(t=r.maxHeight),n(i).height(t+(t%23==0?0:23-t%23)),i.length>0&&(i[0].scrollTop=1e3),n(this).height(t)},n(this).data("settings",e).attr("tabindex",-1),f.refresh();break;case"upload":if(this.tagName!="INPUT"){console.log("ERROR: You can only apply $().w2field('upload') to an INPUT element");return}var h={url:"",base64:!0,hint:w2utils.lang("Attach files by dragging and dropping or Click to Select"),max:0,maxSize:0,maxFileSize:0,onAdd:null,onRemove:null,onItemClick:null,onItemDblClick:null,onItemOver:null,onItemOut:null,onProgress:null,onComplete:null},f=this,e=n.extend({},h,i);e.base64===!0&&(e.maxSize==0&&(e.maxSize=20971520),e.maxFileSize==0&&(e.maxFileSize=20971520)),a=e.selected,delete e.selected,n.isArray(a)||(a=[]),n(this).data("selected",a).data("settings",e).attr("tabindex",-1),t.upload_init.call(this),this.refresh=function(){var o=this,r=n(this).data("div"),i=n(this).data("settings"),c=n(this).data("selected"),h,t,s,l,e,f,u;n(r).find("li").remove(),n(r).find("> span:first-child").css("line-height",n(r).height()-w2utils.getSize(r,"+height")-8+"px");for(h in c){t=c[h],s=n(r).find(".file-list li").length,n(r).find("> span:first-child").remove(),n(r).find(".file-list").append('<li id="file-'+s+'">\t<div class="file-delete" onmouseover="event.stopPropagation();">&nbsp;&nbsp;</div>\t<span class="file-name">'+t.name+'</span>\t<span class="file-size"> - '+w2utils.size(t.size)+"</span></li>"),l=n(r).find(".file-list #file-"+s),e="",/image/i.test(t.type)&&(e='<div style="padding: 2px;">\t<img src="##FILE##" style="max-width: 300px;" \t\tonload="var w = $(this).width(); var h = $(this).height(); \t\t\tif (w < 300 & h < 300) return; \t\t\tif (w >= h && w > 300) $(this).width(300);\t\t\tif (w < h && h > 300) $(this).height(300);"\t\tonerror="this.style.display = \'none\'"\t></div>'),f='style="padding: 3px; text-align: right; color: #777;"',u='style="padding: 3px"',e+='<div style="padding: 5px;">\t<table cellpadding="2">\t<tr><td '+f+">Name:</td><td "+u+">"+t.name+"</td></tr>\t<tr><td "+f+">Size:</td><td "+u+">"+w2utils.size(t.size)+"</td></tr>\t<tr><td "+f+">Type:</td><td "+u+'>\t\t<span style="width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">'+t.type+"</span>\t</td></tr>\t<tr><td "+f+">Modified:</td><td "+u+">"+w2utils.date(t.modified)+"</td></tr>\t</table></div>";l.data("file",t).on("click",function(t){if(typeof i.onItemClick=="function"){var r=i.onItemClick.call(o,n(this).data("file"));if(r===!1)return}n(t.target).hasClass("file-delete")||t.stopPropagation()}).on("dblclick",function(t){if(typeof i.onItemDblClick=="function"){var r=i.onItemDblClick.call(o,n(this).data("file"));if(r===!1)return}t.stopPropagation(),document.selection?document.selection.empty():document.defaultView.getSelection().removeAllRanges()}).on("mouseover",function(){var u,r;(typeof i.onItemOver!="function"||(u=i.onItemOver.call(o,n(this).data("file")),u!==!1))&&(r=n(this).data("file"),n(this).w2overlay(e.replace("##FILE##",r.content?"data:"+r.type+";base64,"+r.content:""),{top:-4}))}).on("mouseout",function(){if(typeof i.onItemOut=="function"){var t=i.onItemOut.call(o,n(this).data("file"));if(t===!1)return}n(this).w2overlay()})}},this.refresh();break;case"slider":break;default:console.log('ERROR: w2field does not recognize "'+i.type+'" field type.')}})},addType:function(n,i){t.customTypes[String(n).toLowerCase()]=i},cleanItems:function(t){var e=[],f;for(f in t){var r="",u="",i=t[f];if(i!=null){if(n.isPlainObject(t))r=f,u=i;else if(typeof i=="object"&&(typeof i.id!="undefined"&&(r=i.id),typeof i.value!="undefined"&&(r=i.value),typeof i.txt!="undefined"&&(u=i.txt),typeof i.text!="undefined"&&(u=i.text)),typeof i=="string"){if(String(i)=="")continue;r=i,u=i,i={}}w2utils.isInt(r)&&(r=parseInt(r)),w2utils.isFloat(r)&&(r=parseFloat(r)),e.push(n.extend({},i,{id:r,text:u}))}}return e},upload_init:function(){var i=this,o=n(this).data("settings"),u=n(i).prev(),e,f,r;u.length>0&&u[0].tagName=="DIV"&&u.hasClass("w2ui-upload")&&u.remove(),e="margin-top: "+n(i).css("margin-top")+"; margin-bottom: "+n(i).css("margin-bottom")+"; margin-left: "+n(i).css("margin-left")+"; margin-right: "+n(i).css("margin-right")+"; width: "+(w2utils.getSize(i,"width")-parseInt(n(i).css("margin-left"))-parseInt(n(i).css("margin-right")))+"px; height: "+(w2utils.getSize(i,"height")-parseInt(n(i).css("margin-top"))-parseInt(n(i).css("margin-bottom")))+"px; ",f='<div style="'+e+'" class="w2ui-upload">\t<span>'+o.hint+'</span>\t<ul class="file-list"></ul>\t<input class="file-input" type="file" name="attachment" multiple style="display: none"></div>',n(i).css({display1:"none","border-color":"transparent"}).before(f),n(i).data("div",n(i).prev()[0]),r=n(i).data("div");n(r).find(".file-input").off("change").on("change",function(){if(typeof this.files!="undefined")for(var n=0,r=this.files.length;n<r;n++)t.upload_add.call(i,this.files[n])});n(r).off("click").on("click",function(u){var o;if(n(r).w2tag(),u.target.tagName!="LI"&&!n(u.target).hasClass("file-size")){if(n(u.target).hasClass("file-delete")){t.upload_remove.call(i,u.target.parentNode);return}if(u.target.tagName!="INPUT"){var e=n(i).data("settings"),s=n(i).data("selected"),f=0;for(o in s)f++;(f<e.max||e.max==0)&&n(r).find(".file-input").click()}}}).off("dragenter").on("dragenter",function(){n(r).addClass("dragover")}).off("dragleave").on("dragleave",function(){n(r).removeClass("dragover")}).off("drop").on("drop",function(u){var e,f,o;for(n(r).removeClass("dragover"),e=u.originalEvent.dataTransfer.files,f=0,o=e.length;f<o;f++)t.upload_add.call(i,e[f]);u.preventDefault(),u.stopPropagation()}).off("dragover").on("dragover",function(n){n.preventDefault(),n.stopPropagation()})},upload_add:function(t){var u=this,o=n(u).data("div"),i=n(u).data("settings"),s=n(u).data("selected"),f={name:t.name,type:t.type,modified:t.lastModifiedDate,size:t.size,content:null},l=0,a=0,c,r,h,e;for(c in s)l+=s[c].size,a++;if(i.maxFileSize!=0&&f.size>i.maxFileSize){r="Maximum file size is "+w2utils.size(i.maxFileSize),n(o).w2tag(r),console.log("ERROR: "+r);return}if(i.maxSize!=0&&l+f.size>i.maxSize){r="Maximum total size is "+w2utils.size(i.maxFileSize),n(o).w2tag(r),console.log("ERROR: "+r);return}if(i.max!=0&&a>=i.max){r="Maximum number of files is "+i.max,n(o).w2tag(r),console.log("ERROR: "+r);return}(typeof i.onAdd!="function"||(h=i.onAdd.call(u,f),h!==!1))&&(s.push(f),typeof FileReader!="undefined"&&i.base64===!0?(e=new FileReader,e.onload=function(){return function(t){var i=t.target.result,r=i.indexOf(",");f.content=i.substr(r+1),u.refresh(),n(u).trigger("change")}}(),e.readAsDataURL(t)):(u.refresh(),n(u).trigger("change")))},upload_remove:function(t){var r=this,s=n(r).data("div"),e=n(r).data("settings"),u=n(r).data("selected"),f=n(t).data("file"),o,i;if(typeof e.onRemove=="function"&&(o=e.onRemove.call(r,f),o===!1))return!1;for(i=u.length-1;i>=0;i--)u[i].name==f.name&&u[i].size==f.size&&u.splice(i,1);n(t).fadeOut("fast"),setTimeout(function(){n(t).remove(),u.length==0&&n(s).prepend("<span>"+e.hint+"</span>"),r.refresh(),n(r).trigger("change")},300)},list_render:function(i){var r=this,e=n("#w2ui-global-items"),u=n(this).data("settings"),o=u.items,v=n(this).data("selected"),k,a,w,f,c,h,g,y;if(e.length!=0){typeof i=="undefined"&&(k="",k+='<div class="w2ui-items-list"></div>',e.html(k),i=""),n(this).data("last_search",i),(typeof n(r).data("last_index")=="undefined"||n(r).data("last_index")==null)&&n(r).data("last_index",0),typeof u.last_total=="undefined"&&(u.last_total=-1),typeof u.last_search_len=="undefined"&&(u.last_search_len=0),typeof u.last_search_match=="undefined"&&(u.last_search_match=-1),u.url!=""&&(o.length==0&&u.last_total!=0||i.length>u.last_search_len&&u.last_total>u.maxCache||i.length<u.last_search_match&&i.length!=u.last_search_len)&&(a=!1,u.last_total<u.maxCache&&(a=!0),n.ajax({type:"GET",dataType:"text",url:u.url,data:{search:i,max:u.maxCache},complete:function(f,e){if(u.last_total=0,e=="success"){var o=n.parseJSON(f.responseText);a==!1&&o.total<u.maxCache&&(u.last_search_match=i.length),u.last_search_len=i.length,u.last_total=o.total,u.items=o.items,t.list_render.call(r,i)}}}));var s=0,l="<ul>",d=[];for(f in v)d.push(w2utils.isInt(v[f].id)?parseInt(v[f].id):String(v[f].id));w="";for(f in o)if(c=o[f].id,h=o[f].text,n.inArray(w2utils.isInt(c)?parseInt(c):String(c),d)==-1||u.showAll===!0){var p=String(i).toLowerCase(),b=h.toLowerCase(),a=p.length<=b.length&&b.substr(0,p.length)==p;u.match.toLowerCase()=="contains"&&b.indexOf(p)!=-1&&(a=!0),a&&(typeof u.render=="function"&&(h=u.render(o[f],v)),h!==!1&&(typeof o[f].group!="undefined"&&o[f].group!=w&&(w=o[f].group,l+='<li class="w2ui-item-group" onmousedown="event.preventDefault()">'+w+"</li>"),l+='\n<li index="'+f+'" value="'+c+"\"   onmouseover=\"$(this).parent().find('li').removeClass('selected'); $(this).addClass('selected'); \"\tclass=\""+(s%2?"w2ui-item-even":"w2ui-item-odd")+(s==n(r).data("last_index")?" selected":"")+'">'+h+"</li>",s==n(r).data("last_index")&&n(r).data("last_item",o[f]),s++))}l+="</ul>",s==0&&(l='<div class="w2ui-empty-list">'+w2utils.lang("No items found")+"</div>",g=!0),e.find(".w2ui-items-list").html(l),n(this).data("last_max",s-1),e.find("li.selected").length>0&&e.find("li.selected")[0].scrollIntoView(!1),e.css({"-webkit-transition":"0s",height:"auto"}),y=parseInt(n(document).height())-parseInt(e.offset().top)-8,parseInt(e.height())>y&&(e.css({height:y-5+"px",overflow:"show"}),n(e).find(".w2ui-items-list").css({height:y-15+"px",overflow:"auto"}));n(e).off("mousedown").on("mousedown",function(i){var e=i.target,f,o;if(e.tagName!="LI"&&(e=n(e).parents("li")),f=n(e).attr("index"),f){if(o=u.items[f],typeof f=="undefined")if(i.preventDefault)i.preventDefault();else return!1;r.add(o),n(r).data("last_index",0),r.refresh(),t.list_render.call(r,"")}});n(r).prev().find("li > input").val(i).css("max-width",n(e).width()-25+"px").width((i.length+2)*6+"px").focus().on("click",function(n){n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}).off("keyup").on("keyup",function(i){var u=this;setTimeout(function(){var f=n(r).data("last_index"),e;switch(i.keyCode){case 38:f--,f<0&&(f=0),n(r).data("last_index",f),i.preventDefault&&i.preventDefault();break;case 40:f++,f>n(r).data("last_max")&&(f=n(r).data("last_max")),n(r).data("last_index",f),i.preventDefault&&i.preventDefault();break;case 13:if(typeof n(r).data("last_item")=="undefined"||n(r).data("last_item")==null||g===!0)break;e=n(r).data("selected"),r.add(n(r).data("last_item")),f>n(r).data("last_max")-1&&(f=n(r).data("last_max")-1),n(r).data("last_index",f),n(r).data("last_item",null),n(u).val(""),r.refresh(),i.preventDefault&&i.preventDefault();break;case 8:String(u.value)==""&&(typeof n(r).data("last_del")=="undefined"||n(r).data("last_del")==null?(e=n(r).data("selected"),n.isArray(e)||(e=[]),n(r).data("last_del",e.length-1),r.refresh()):(e=n(r).data("selected"),r.remove(e.length-1)));break;default:n(r).data("last_index",0),n(r).data("last_del",null)}r.resize(),i.keyCode==8&&String(u.value)==""||(n(r).prev().find("li").css("opacity","1"),n(r).data("last_del",null)),n.inArray(i.keyCode,[16,91,37,39])==-1&&t.list_render.call(r,u.value)},10)})}},calendar_get:function(t,i){var e=new Date,s=Number(e.getMonth())+1+"/"+e.getDate()+"/"+(String(e.getYear()).length>3?e.getYear():e.getYear()+1900),o;(String(t)==""||String(t)=="undefined")&&(t=w2utils.formatDate(s,i.format)),w2utils.isDate(t,i.format)||(t=w2utils.formatDate(s,i.format));var r=t.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/"),f=i.format.replace(/-/g,"/").replace(/\./g,"/").toLowerCase(),u=new Date;return f=="mm/dd/yyyy"&&(u=new Date(r[0]+"/"+r[1]+"/"+r[2])),f=="m/d/yyyy"&&(u=new Date(r[0]+"/"+r[1]+"/"+r[2])),f=="dd/mm/yyyy"&&(u=new Date(r[1]+"/"+r[0]+"/"+r[2])),f=="d/m/yyyy"&&(u=new Date(r[1]+"/"+r[0]+"/"+r[2])),f=="yyyy/dd/mm"&&(u=new Date(r[2]+"/"+r[1]+"/"+r[0])),f=="yyyy/d/m"&&(u=new Date(r[2]+"/"+r[1]+"/"+r[0])),f=="yyyy/mm/dd"&&(u=new Date(r[1]+"/"+r[2]+"/"+r[0])),f=="yyyy/m/d"&&(u=new Date(r[1]+"/"+r[2]+"/"+r[0])),o='<table cellpadding="0" cellspacing="0"><tr><td>'+n().w2field("calendar_month",u.getMonth()+1,u.getFullYear(),i)+"</td></tr></table>"},calendar_next:function(t){var f=String(t).split("/"),i=f[0],u=f[1],r;parseInt(i)<12?i=parseInt(i)+1:(i=1,u=parseInt(u)+1),r=n(n("#global_calendar_div.w2ui-calendar").data("el")).data("options"),n("#global_calendar_div.w2ui-calendar").html(n().w2field("calendar_get",w2utils.formatDate(i+"/1/"+u,r.format),r))},calendar_previous:function(t){var f=String(t).split("/"),i=f[0],u=f[1],r;parseInt(i)>1?i=parseInt(i)-1:(i=12,u=parseInt(u)-1),r=n(n("#global_calendar_div.w2ui-calendar").data("el")).data("options"),n("#global_calendar_div.w2ui-calendar").html(n().w2field("calendar_get",w2utils.formatDate(i+"/1/"+u,r.format),r))},calendar_month:function(t,i,r){var u=new Date,rt=w2utils.settings.fullmonths,et=w2utils.settings.fulldays,p=["31","28","31","30","31","30","31","31","30","31","30","31"],ft=Number(u.getMonth())+1+"/"+u.getDate()+"/"+(String(u.getYear()).length>3?u.getYear():u.getYear()+1900),c,g,e,s,f,v,o,h,l;i=Number(i),t=Number(t),(i===null||i==="")&&(i=String(u.getYear()).length>3?u.getYear():u.getYear()+1900),(t===null||t==="")&&(t=Number(u.getMonth())+1),t>12&&(t=t-12,i++),(t<1||t==0)&&(t=t+12,i--),p[1]=i/4==Math.floor(i/4)?"29":"28",i==null&&(i=u.getYear()),t==null&&(t=u.getMonth()-1),u=new Date,u.setDate(1),u.setMonth(t-1),u.setYear(i);var y=u.getDay(),nt=w2utils.settings.shortdays,d="";for(c=0,g=nt.length;c<g;c++)d+="<td>"+nt[c]+"</td>";for(e='<div class="w2ui-calendar-title" onclick="event.stopPropagation()">\t<div class="w2ui-calendar-previous" onclick="$().w2field(\'calendar_previous\', \''+t+"/"+i+"')\"> <- </div>\t<div class=\"w2ui-calendar-next\" onclick=\"$().w2field('calendar_next', '"+t+"/"+i+"')\"> -> </div> "+rt[t-1]+", "+i+'</div><table class="w2ui-calendar-days" onclick="event.stopPropagation()" cellspacing="0">\t<tr class="w2ui-day-title">'+d+"</tr>\t<tr>",s=1,f=1;f<43;f++){if(y==0&&f==1){for(v=0;v<6;v++)e+='<td class="w2ui-day-empty">&nbsp;</td>';f+=6}else if(f<y||s>p[t-1]){e+='<td class="w2ui-day-empty">&nbsp;</td>',f%7==0&&(e+="</tr><tr>");continue}o=t+"/"+s+"/"+i,h="",f%7==6&&(h="w2ui-saturday"),f%7==0&&(h="w2ui-sunday"),o==ft&&(h+=" w2ui-today");var ut=s,b="",w="",a="";if(r.colored&&r.colored[o]!=undefined&&(tmp=r.colored[o].split(":"),w="background-color: "+tmp[0]+";",b="color: "+tmp[1]+";"),l=!1,r.start||r.end){var tt=new Date(r.start),it=new Date(r.end),k=new Date(o);(k<tt||k>it)&&(a=" w2ui-blocked-date",l=!0)}r.blocked&&n.inArray(o,r.blocked)!=-1&&(a=" w2ui-blocked-date",l=!0),e+='<td class="'+h+a+'" style="'+b+w+'" id="'+this.name+"_date_"+o+'" date="'+o+'"',l===!1&&(e+="onclick=\"var el = $('#global_calendar_div.w2ui-calendar').data('el'); \t$(el).val('"+w2utils.formatDate(o,r.format)+"').trigger('change').trigger('blur'); \t if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\t if (event.preventDefault) event.preventDefault(); else return false;\""),e+=">"+ut+"</td>",(f%7==0||y==0&&f==1)&&(e+="</tr><tr>"),s++}return e+="</tr></table>"},getColorHTML:function(n){for(var r='<div class="w2ui-color"><table cellspacing="5">',u=[["000000","444444","666666","999999","CCCCCC","EEEEEE","F3F3F3","FFFFFF"],["FF011B","FF9838","FFFD59","01FD55","00FFFE","0424F3","9B24F4","FF21F5"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D1E9","EAD1DC"],["EA9899","F9CB9C","FEE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD"],["E06666","F6B26B","FED966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BA0"],["CC0814","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A54D79"],["99050C","B45F17","BF901F","37761D","124F5C","0A5394","351C75","741B47"],["660205","783F0B","7F6011","274E12","0C343D","063762","20124D","4C1030"]],i,t=0;t<8;t++){for(r+="<tr>",i=0;i<8;i++)r+="<td>\t<div onclick=\"var el = $('#global_color_div').data('el');\t\t\t$(el).val($(this).attr('name')).change(); \t\t\t$('#global_color_div').hide()\" \t\tstyle=\"background-color: #"+u[t][i]+';" name="'+u[t][i]+'">\t\t'+(n==u[t][i]?"&#149;":"&nbsp;")+"\t</div></td>";r+="</tr>",t<2&&(r+='<tr><td style="height: 8px" colspan="8"></td></tr>')}return r+="</table></div>"}}),w2obj.field=t}(jQuery),function($){var w2form=function(n){this.name=null,this.header="",this.box=null,this.url="",this.formURL="",this.formHTML="",this.page=0,this.recid=0,this.fields=[],this.actions={},this.record={},this.original={},this.postData={},this.toolbar={},this.tabs={},this.style="",this.focus=0,this.msgNotJSON=w2utils.lang("Return data is not in JSON format."),this.msgRefresh=w2utils.lang("Refreshing..."),this.msgSaving=w2utils.lang("Saving..."),this.onRequest=null,this.onLoad=null,this.onValidate=null,this.onSubmit=null,this.onSave=null,this.onChange=null,this.onRender=null,this.onRefresh=null,this.onResize=null,this.onDestroy=null,this.onAction=null,this.onToolbar=null,this.onError=null,this.isGenerated=!1,this.last={xhr:null},$.extend(!0,this,w2obj.form,n)};$.fn.w2form=function(n){var s,u,i,r;if(typeof n!="object"&&n){if(w2ui[$(this).attr("name")])return r=w2ui[$(this).attr("name")],r[n].apply(r,Array.prototype.slice.call(arguments,1)),this;console.log("ERROR: Method "+n+" does not exist on jQuery.w2form")}else{if(r=this,!n||typeof n.name=="undefined"){console.log('ERROR: The parameter "name" is required but not supplied in $().w2form().');return}if(typeof w2ui[n.name]!="undefined"){console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+n.name+").");return}if(!w2utils.isAlphaNumeric(n.name)){console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). ');return}var o=n.record,e=n.original,h=n.fields,c=n.toolbar,f=n.tabs,t=new w2form(n);if($.extend(t,{record:{},original:{},fields:[],tabs:{},toolbar:{},handlers:[]}),$.isArray(f)){$.extend(!0,t.tabs,{tabs:[]});for(s in f)u=f[s],typeof u=="object"?t.tabs.tabs.push(u):t.tabs.tabs.push({id:u,caption:u})}else $.extend(!0,t.tabs,f);$.extend(!0,t.toolbar,c);for(i in h)t.fields[i]=$.extend(!0,{},h[i]);for(i in o)t.record[i]=$.isPlainObject(o[i])?$.extend(!0,{},o[i]):o[i];for(i in e)t.original[i]=$.isPlainObject(e[i])?$.extend(!0,{},e[i]):e[i];return r.length>0&&(t.box=r[0]),t.formURL!=""?$.get(t.formURL,function(n){t.formHTML=n,t.isGenerated=!0,($(t.box).length!=0||n.length!=0)&&($(t.box).html(n),t.render(t.box))}):t.formHTML!=""||(t.formHTML=$(this).length!=0&&$.trim($(this).html())!=""?$(this).html():t.generateHTML()),w2ui[t.name]=t,t.formURL==""&&(String(t.formHTML).indexOf("w2ui-page")==-1&&(t.formHTML='<div class="w2ui-page page-0">'+t.formHTML+"</div>"),$(t.box).html(t.formHTML),t.isGenerated=!0,t.render(t.box)),t}},w2form.prototype={get:function(n,t){for(var i in this.fields)if(this.fields[i].name==n)return t===!0?i:this.fields[i];return null},set:function(n,t){for(var i in this.fields)if(this.fields[i].name==n)return $.extend(this.fields[i],t),this.refresh(),!0;return!1},reload:function(n){var t=typeof this.url!="object"?this.url:this.url.get;t&&this.recid!=0?this.request(n):(this.refresh(),typeof n=="function"&&n())},clear:function(){var n,t;this.recid=0,this.record={};for(n in this.fields)t=this.fields[n];$().w2tag(),this.refresh()},error:function(n){var i=this,t=this.trigger({target:this.name,type:"error",message:n,xhr:this.last.xhr});if(t.isCancelled===!0)return typeof callBack=="function"&&callBack(),!1;setTimeout(function(){w2alert(n,"Error")},1),this.trigger($.extend(t,{phase:"after"}))},validate:function(n){var i,e,t,u,r,o,f;typeof n=="undefined"&&(n=!0),i=[];for(e in this.fields){t=this.fields[e],this.record[t.name]==null&&(this.record[t.name]="");switch(t.type){case"int":this.record[t.name]&&!w2utils.isInt(this.record[t.name])&&i.push({field:t,error:w2utils.lang("Not an integer")});break;case"float":this.record[t.name]&&!w2utils.isFloat(this.record[t.name])&&i.push({field:t,error:w2utils.lang("Not a float")});break;case"money":this.record[t.name]&&!w2utils.isMoney(this.record[t.name])&&i.push({field:t,error:w2utils.lang("Not in money format")});break;case"hex":this.record[t.name]&&!w2utils.isHex(this.record[t.name])&&i.push({field:t,error:w2utils.lang("Not a hex number")});break;case"email":this.record[t.name]&&!w2utils.isEmail(this.record[t.name])&&i.push({field:t,error:w2utils.lang("Not a valid email")});break;case"checkbox":this.record[t.name]=this.record[t.name]==!0?1:0;break;case"date":this.record[t.name]&&!w2utils.isDate(this.record[t.name],t.options.format)&&i.push({field:t,error:w2utils.lang("Not a valid date")+": "+t.options.format})}u=this.record[t.name],t.required&&(u===""||$.isArray(u)&&u.length==0)&&i.push({field:t,error:w2utils.lang("Required field")}),t.equalto&&this.record[t.name]!=this.record[t.equalto]&&i.push({field:t,error:w2utils.lang("Field should be equal to ")+t.equalto})}if(r=this.trigger({phase:"before",target:this.name,type:"validate",errors:i}),r.isCancelled===!0)return i;if(n)for(o in r.errors)f=r.errors[o],$(f.field.el).w2tag(f.error,{"class":"w2ui-error"});return this.trigger($.extend(r,{phase:"after"})),i},request:function(postData,callBack){var obj=this,params,eventData,url;if(typeof postData=="function"&&(callBack=postData,postData=null),(typeof postData=="undefined"||postData==null)&&(postData={}),this.url&&(typeof this.url!="object"||this.url.get)){if((this.recid==null||typeof this.recid=="undefined")&&(this.recid=0),params={},params.cmd="get-record",params.name=this.name,params.recid=this.recid,$.extend(params,this.postData),$.extend(params,postData),eventData=this.trigger({phase:"before",type:"request",target:this.name,url:this.url,postData:params}),eventData.isCancelled===!0)return typeof callBack=="function"&&callBack({status:"error",message:"Request aborted."}),!1;if(this.record={},this.original={},this.lock(this.msgRefresh),url=eventData.url,typeof eventData.url=="object"&&eventData.url.get&&(url=eventData.url.get),this.last.xhr)try{this.last.xhr.abort()}catch(e){}this.last.xhr=$.ajax({type:"GET",url:url,data:String($.param(eventData.postData,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"),dataType:"text",complete:function(xhr,status){var eventData,responseText,data;if(obj.unlock(),eventData=obj.trigger({phase:"before",target:obj.name,type:"load",xhr:xhr,status:status}),eventData.isCancelled===!0)return typeof callBack=="function"&&callBack({status:"error",message:"Request aborted."}),!1;if(responseText=obj.last.xhr.responseText,status!="error"){if(typeof responseText!="undefined"&&responseText!=""){if(typeof responseText=="object")data=responseText;else try{eval("data = "+responseText)}catch(e){}typeof data=="undefined"&&(data={status:"error",message:obj.msgNotJSON,responseText:responseText}),data.status=="error"?obj.error(data.message):(obj.record=$.extend({},data.record),obj.original=$.extend({},data.record))}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText);obj.trigger($.extend(eventData,{phase:"after"})),obj.refresh(),typeof callBack=="function"&&callBack(data)}}),this.trigger($.extend(eventData,{phase:"after"}))}},submit:function(n,t){return this.save(n,t)},save:function(postData,callBack){var obj=this,errors;if(typeof postData=="function"&&(callBack=postData,postData=null),errors=obj.validate(!0),errors.length!==0){obj.goto(errors[0].field.page);return}if((typeof postData=="undefined"||postData==null)&&(postData={}),!obj.url||typeof obj.url=="object"&&!obj.url.save){console.log("ERROR: Form cannot be saved because no url is defined.");return}obj.lock(obj.msgSaving+' <span id="'+obj.name+'_progress"></span>'),setTimeout(function(){var params={},f,field,tmp,dt,eventData,url;params.cmd="save-record",params.name=obj.name,params.recid=obj.recid,$.extend(params,obj.postData),$.extend(params,postData),params.record=$.extend(!0,{},obj.record);for(f in obj.fields){field=obj.fields[f];switch(String(field.type).toLowerCase()){case"date":dt=params.record[field.name],(field.options.format.toLowerCase()=="dd/mm/yyyy"||field.options.format.toLowerCase()=="dd-mm-yyyy"||field.options.format.toLowerCase()=="dd.mm.yyyy")&&(tmp=dt.replace(/-/g,"/").replace(/\./g,"/").split("/"),dt=new Date(tmp[2]+"-"+tmp[1]+"-"+tmp[0])),params.record[field.name]=w2utils.formatDate(dt,"yyyy-mm-dd")}}if(eventData=obj.trigger({phase:"before",type:"submit",target:obj.name,url:obj.url,postData:params}),eventData.isCancelled===!0)return typeof callBack=="function"&&callBack({status:"error",message:"Saving aborted."}),!1;if(url=eventData.url,typeof eventData.url=="object"&&eventData.url.save&&(url=eventData.url.save),obj.last.xhr)try{obj.last.xhr.abort()}catch(e){}obj.last.xhr=$.ajax({type:w2utils.settings.RESTfull?obj.recid==0?"POST":"PUT":"POST",url:url,data:String($.param(eventData.postData,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"),dataType:"text",xhr:function(){var n=new window.XMLHttpRequest;return n.upload.addEventListener("progress",function(n){if(n.lengthComputable){var t=Math.round(n.loaded/n.total*100);$("#"+obj.name+"_progress").text(""+t+"%")}},!1),n},complete:function(xhr,status){var eventData,responseText,data;if(obj.unlock(),eventData=obj.trigger({phase:"before",target:obj.name,type:"save",xhr:xhr,status:status}),eventData.isCancelled===!0)return typeof callBack=="function"&&callBack({status:"error",message:"Saving aborted."}),!1;if(responseText=xhr.responseText,status!="error"){if(typeof responseText!="undefined"&&responseText!=""){if(typeof responseText=="object")data=responseText;else try{eval("data = "+responseText)}catch(e){}typeof data=="undefined"&&(data={status:"error",message:obj.msgNotJSON,responseText:responseText}),data.status=="error"?obj.error(data.message):obj.original=$.extend({},obj.record)}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText);obj.trigger($.extend(eventData,{phase:"after"})),obj.refresh(),typeof callBack=="function"&&callBack(data)}}),obj.trigger($.extend(eventData,{phase:"after"}))},50)},lock:function(n,t){var i=$(this.box).find("> div:first-child");w2utils.lock(i,n,t)},unlock:function(){var n=this;setTimeout(function(){w2utils.unlock(n.box)},25)},goto:function(n){typeof n!="undefined"&&(this.page=n),$(this.box).data("auto-size")===!0&&$(this.box).height(0),this.refresh()},generateHTML:function(){var t=[],e,f,n,r,o,i,u;for(e in this.fields)f="",n=this.fields[e],typeof n.html=="undefined"&&(n.html={}),n.html=$.extend(!0,{caption:"",span:6,attr:"",text:"",page:0},n.html),n.html.caption==""&&(n.html.caption=n.name),r='<input name="'+n.name+'" type="text" '+n.html.attr+"/>",n.type=="list"&&(r='<select name="'+n.name+'" '+n.html.attr+"></select>"),n.type=="checkbox"&&(r='<input name="'+n.name+'" type="checkbox" '+n.html.attr+"/>"),n.type=="textarea"&&(r='<textarea name="'+n.name+'" '+n.html.attr+"></textarea>"),f+='\n   <div class="w2ui-label '+(typeof n.html.span!="undefined"?"w2ui-span"+n.html.span:"")+'">'+n.html.caption+':</div>\n   <div class="w2ui-field '+(typeof n.html.span!="undefined"?"w2ui-span"+n.html.span:"")+'">'+r+n.html.text+"</div>",typeof t[n.html.page]=="undefined"&&(t[n.html.page]='<div class="w2ui-page page-'+n.html.page+'">'),t[n.html.page]+=f;for(o in t)t[o]+="\n</div>";if(i="",!$.isEmptyObject(this.actions)){i+='\n<div class="w2ui-buttons">';for(u in this.actions)i+='\n    <input type="button" value="'+u+'" name="'+u+'">';i+="\n</div>"}return t.join("")+i},action:function(n,t){var i=this.trigger({phase:"before",target:n,type:"action",originalEvent:t});if(i.isCancelled===!0)return!1;typeof this.actions[n]=="function"&&this.actions[n].call(this,t),this.trigger($.extend(i,{phase:"after"}))},resize:function(){function o(){s.width($(n.box).width()).height($(n.box).height()),i.css("top",n.header!=""?w2utils.getSize(t,"height"):0),f.css("top",(n.header!=""?w2utils.getSize(t,"height"):0)+(n.toolbar.items.length>0?w2utils.getSize(i,"height"):0)),u.css("top",(n.header!=""?w2utils.getSize(t,"height"):0)+(n.toolbar.items.length>0?w2utils.getSize(i,"height")+5:0)+(n.tabs.tabs.length>0?w2utils.getSize(f,"height")+5:0)),u.css("bottom",r.length>0?w2utils.getSize(r,"height"):0)}var n=this,e=this.trigger({phase:"before",target:this.name,type:"resize"});if(e.isCancelled===!0)return!1;var s=$(this.box).find("> div"),t=$(this.box).find("> div .w2ui-form-header"),i=$(this.box).find("> div .w2ui-form-toolbar"),f=$(this.box).find("> div .w2ui-form-tabs"),u=$(this.box).find("> div .w2ui-page"),h=$(this.box).find("> div .w2ui-page.page-"+this.page),c=$(this.box).find("> div .w2ui-page.page-"+this.page+" > div"),r=$(this.box).find("> div .w2ui-buttons");o(),(parseInt($(this.box).height())==0||$(this.box).data("auto-size")===!0)&&($(this.box).height((t.length>0?w2utils.getSize(t,"height"):0)+(this.tabs.tabs.length>0?w2utils.getSize(f,"height"):0)+(this.toolbar.items.length>0?w2utils.getSize(i,"height"):0)+(u.length>0?w2utils.getSize(c,"height")+w2utils.getSize(h,"+height")+12:0)+(r.length>0?w2utils.getSize(r,"height"):0)),$(this.box).data("auto-size",!0)),o(),n.trigger($.extend(e,{phase:"after"}))},refresh:function(){var i=this,e,f,n,t,u,r;if(this.box&&this.isGenerated&&typeof $(this.box).html()!="undefined"){if($(this.box).find("input, textarea, select").each(function(n,t){var e=typeof $(t).attr("name")!="undefined"?$(t).attr("name"):$(t).attr("id"),f=i.get(e),u,r;if(f&&(u=$(t).parents(".w2ui-page"),u.length>0))for(r=0;r<100;r++)if(u.hasClass("page-"+r)){f.page=r;break}}),e=this.trigger({phase:"before",target:this.name,type:"refresh",page:this.page}),e.isCancelled===!0)return!1;$(this.box).find(".w2ui-page").hide(),$(this.box).find(".w2ui-page.page-"+this.page).show(),$(this.box).find(".w2ui-form-header").html(this.header),typeof this.tabs=="object"&&this.tabs.tabs.length>0?($("#form_"+this.name+"_tabs").show(),this.tabs.active=this.tabs.tabs[this.page].id,this.tabs.refresh()):$("#form_"+this.name+"_tabs").hide(),typeof this.toolbar=="object"&&this.toolbar.items.length>0?($("#form_"+this.name+"_toolbar").show(),this.toolbar.refresh()):$("#form_"+this.name+"_toolbar").hide();for(f in this.fields){n=this.fields[f],n.el=$(this.box).find('[name="'+String(n.name).replace(/\\/g,"\\\\")+'"]')[0],typeof n.el=="undefined"&&console.log('ERROR: Cannot associate field "'+n.name+'" with html control. Make sure html control exists with the same name.'),n.el&&(n.el.id=n.name);$(n.el).off("change").on("change",function(){var r=this.value,s=i.record[this.name]?i.record[this.name]:"",u=i.get(this.name),n,f,t;if((u.type=="enum"||u.type=="upload")&&$(this).data("selected")){var e=$(this).data("selected"),o=i.record[this.name],r=[],s=[];if($.isArray(e))for(n in e)r[n]=$.extend(!0,{},e[n]);if($.isArray(o))for(n in o)s[n]=$.extend(!0,{},o[n])}if(f=i.trigger({phase:"before",target:this.name,type:"change",value_new:r,value_previous:s}),f.isCancelled===!0)return $(this).val(i.record[this.name]),!1;t=this.value,this.type=="checkbox"&&(t=this.checked?!0:!1),this.type=="radio"&&(t=this.checked?!0:!1),u.type=="enum"&&(t=r),u.type=="upload"&&(t=r),i.record[this.name]=t,i.trigger($.extend(f,{phase:"after"}))});n.required?$(n.el).parent().addClass("w2ui-required"):$(n.el).parent().removeClass("w2ui-required")}$(this.box).find("button, input[type=button]").each(function(n,t){$(t).off("click").on("click",function(n){var t=this.value;this.name&&(t=this.name),this.id&&(t=this.id),i.action(t,n)})});for(f in this.fields)if(n=this.fields[f],t=typeof this.record[n.name]!="undefined"?this.record[n.name]:"",n.el)switch(String(n.type).toLowerCase()){case"email":case"text":case"textarea":n.el.value=t;break;case"date":n.options||(n.options={}),n.options.format||(n.options.format=w2utils.settings.date_format),n.el.value=t,this.record[n.name]=t,$(n.el).w2field($.extend({},n.options,{type:"date"}));break;case"int":n.el.value=t,$(n.el).w2field("int");break;case"float":n.el.value=t,$(n.el).w2field("float");break;case"money":n.el.value=t,$(n.el).w2field("money");break;case"hex":n.el.value=t,$(n.el).w2field("hex");break;case"alphanumeric":n.el.value=t,$(n.el).w2field("alphaNumeric");break;case"checkbox":this.record[n.name]==!0||this.record[n.name]==1||this.record[n.name]=="t"?$(n.el).prop("checked",!0):$(n.el).prop("checked",!1);break;case"password":n.el.value=t;break;case"select":case"list":$(n.el).w2field($.extend({},n.options,{type:"list",value:t}));break;case"enum":if(typeof n.options=="undefined"||typeof n.options.url=="undefined"&&typeof n.options.items=="undefined"){console.log("ERROR: (w2form."+i.name+") the field "+n.name+" defined as enum but not field.options.url or field.options.items provided.");break}this.record[n.name]=w2obj.field.cleanItems(t),t=this.record[n.name],$(n.el).w2field($.extend({},n.options,{type:"enum",selected:t}));break;case"upload":$(n.el).w2field($.extend({},n.options,{type:"upload",selected:t}));break;default:console.log('ERROR: field type "'+n.type+'" is not recognized.')}for(u=$(this.box).find(".w2ui-page"),r=0;r<u.length;r++)$(u[r]).find("> *").length>1&&$(u[r]).wrapInner("<div></div>");this.trigger($.extend(e,{phase:"after"})),this.resize()}},render:function(n){function f(){var n=$(t.box).find("input, select, textarea");n.length>t.focus&&n[t.focus].focus()}var t=this,i,u,r;if(typeof n=="object"&&($(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),this.box=n),this.isGenerated){if(i=this.trigger({phase:"before",target:this.name,type:"render",box:typeof n!="undefined"?n:this.box}),i.isCancelled===!0)return!1;if(u="<div>"+(this.header!=""?'<div class="w2ui-form-header">'+this.header+"</div>":"")+'\t<div id="form_'+this.name+'_toolbar" class="w2ui-form-toolbar"></div>\t<div id="form_'+this.name+'_tabs" class="w2ui-form-tabs"></div>'+this.formHTML+"</div>",$(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-form").html(u),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),typeof this.toolbar.render=="undefined"){this.toolbar=$().w2toolbar($.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this}));this.toolbar.on("click",function(n){var i=t.trigger({phase:"before",type:"toolbar",target:n.target,originalEvent:n});if(i.isCancelled===!0)return!1;t.trigger($.extend(i,{phase:"after"}))})}if(typeof this.toolbar=="object"&&typeof this.toolbar.render=="function"&&this.toolbar.render($("#form_"+this.name+"_toolbar")[0]),typeof this.tabs.render=="undefined"){this.tabs=$().w2tabs($.extend({},this.tabs,{name:this.name+"_tabs",owner:this}));this.tabs.on("click",function(n){t.goto(this.get(n.target,!0))})}if(typeof this.tabs=="object"&&typeof this.tabs.render=="function"&&this.tabs.render($("#form_"+this.name+"_tabs")[0]),this.trigger($.extend(i,{phase:"after"})),this.resize(),r=typeof this.url!="object"?this.url:this.url.get,r&&this.recid!=0?this.request():this.refresh(),$(".w2ui-layout").length==0){this.tmp_resize=function(){w2ui[t.name].resize()};$(window).off("resize","body").on("resize","body",this.tmp_resize)}setTimeout(function(){t.resize(),t.refresh()},150),this.focus>=0&&setTimeout(f,500)}},destroy:function(){var n=this.trigger({phase:"before",target:this.name,type:"destroy"});if(n.isCancelled===!0)return!1;typeof this.toolbar=="object"&&this.toolbar.destroy&&this.toolbar.destroy(),typeof this.tabs=="object"&&this.tabs.destroy&&this.tabs.destroy(),$(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),delete w2ui[this.name],this.trigger($.extend(n,{phase:"after"})),$(window).off("resize","body")}},$.extend(w2form.prototype,w2utils.event),w2obj.form=w2form}(jQuery);